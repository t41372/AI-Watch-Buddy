(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{275:(e,t,i)=>{"use strict";i.d(t,{_3:()=>c,kf:()=>x,po:()=>m,N3:()=>p,Xg:()=>g,Ts:()=>y,f:()=>f,Iq:()=>_,WT:()=>d});var r,s=i(7932),a=i(7973),n=i(5943),o=i(2342),l=i(5626);class u{static parseJsonObject(e,t){return Object.keys(e).forEach(i=>{if("boolean"==typeof e[i]){let r=!!e[i];t.put(i,new m(r))}else if("string"==typeof e[i]){let r=String(e[i]);t.put(i,new _(r))}else if("number"==typeof e[i]){let r=Number(e[i]);t.put(i,new g(r))}else e[i]instanceof Array?t.put(i,u.parseJsonArray(e[i])):e[i]instanceof Object?t.put(i,u.parseJsonObject(e[i],new y)):null==e[i]?t.put(i,new f):t.put(i,e[i])}),t}static parseJsonArray(e){let t=new x;return Object.keys(e).forEach(i=>{if("number"==typeof Number(i))if("boolean"==typeof e[i]){let r=!!e[i];t.add(new m(r))}else if("string"==typeof e[i]){let r=String(e[i]);t.add(new _(r))}else if("number"==typeof e[i]){let r=Number(e[i]);t.add(new g(r))}else e[i]instanceof Array?t.add(this.parseJsonArray(e[i])):e[i]instanceof Object?t.add(this.parseJsonObject(e[i],new y)):null==e[i]?t.add(new f):t.add(e[i]);else if(e[i]instanceof Array)t.add(this.parseJsonArray(e[i]));else if(e[i]instanceof Object)t.add(this.parseJsonObject(e[i],new y));else if(null==e[i])t.add(new f);else{let r=Array(e[i]);for(let e=0;e<r.length;e++)t.add(r[e])}}),t}}let h="Error: type mismatch";class d{getRawString(e,t){return this.getString(e,t)}toInt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e}toFloat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e}toBoolean(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e}getSize(){return 0}getArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e}getVector(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o.tG;return e}getMap(e){return e}getValueByIndex(e){return d.errorValue.setErrorNotForClientCall(h)}getValueByString(e){return d.nullValue.setErrorNotForClientCall(h)}getKeys(){return d.dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(e){return!1}isStatic(){return!1}setErrorNotForClientCall(e){return p.errorValue}static staticInitializeNotForClientCall(){m.trueValue=new m(!0),m.falseValue=new m(!1),d.errorValue=new p("ERROR",!0),d.nullValue=new f,d.dummyKeys=new o.tG}static staticReleaseNotForClientCall(){m.trueValue=null,m.falseValue=null,d.errorValue=null,d.nullValue=null,d.dummyKeys=null}constructor(){}}class c{static create(e,t){let i=new c;return i.parseBytes(e,t,i._parseCallback)?i:(c.delete(i),null)}static delete(e){}getRoot(){return this._root}static arrayBufferToString(e){let t=new Uint8Array(e),i="";for(let e=0,r=t.length;e<r;++e)i+="%"+this.pad(t[e].toString(16));return decodeURIComponent(i)}static pad(e){return e.length<2?"0"+e:e}parseBytes(e,t,i){let r=c.arrayBufferToString(e);if(void 0==i?this._root=this.parseValue(r,t,0,[,]):this._root=i(JSON.parse(r),new y),this._error){let e="\0";return e="Json parse error : @line "+(this._lineCount+1)+"\n",this._root=new _(e),(0,l.qP)("{0}",this._root.getRawString()),!1}return null!=this._root||(this._root=new p(new n.F(this._error),!1),!1)}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(e,t,i,r){let a;if(this._error)return null;let n=null,o=i;for(;o<t;o++)switch(e[o]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{let t=[,];return a=(0,s.d7)(e.slice(o),t),r[0]=e.indexOf(t[0]),new g(a)}case'"':return new _(this.parseString(e,t,o+1,r));case"[":return this.parseArray(e,t,o+1,r);case"{":return this.parseObject(e,t,o+1,r);case"n":return o+3<t?(n=new f,r[0]=o+4):this._error="parse null",n;case"t":return o+3<t?(n=m.trueValue,r[0]=o+4):this._error="parse true",n;case"f":return o+4<t?(n=m.falseValue,r[0]=o+5):this._error="illegal ',' position",n;case",":return this._error="illegal ',' position",null;case"]":return r[0]=o,null;case"\n":this._lineCount++}return this._error="illegal end of value",null}parseString(e,t,i,r){if(this._error)return null;if(!e)return this._error="string is null",null;let s=i,a=new n.F(""),o=i;for(;s<t;s++)switch(e[s]){case'"':return r[0]=s+1,a.append(e.slice(o),s-o),a.s;case"//":if(++s-1>o&&a.append(e.slice(o),s-o),o=s+1,s<t)switch(e[s]){case"\\":a.expansion(1,"\\");break;case'"':a.expansion(1,'"');break;case"/":a.expansion(1,"/");break;case"b":a.expansion(1,"\b");break;case"f":a.expansion(1,"\f");break;case"n":a.expansion(1,"\n");break;case"r":a.expansion(1,"\r");break;case"t":a.expansion(1,"	");break;case"u":this._error="parse string/unicord escape not supported"}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(e,t,i,r){if(this._error)return null;if(!e)return this._error="buffer is null",null;let s=new y,a="",n=i,o=[,],l=!1;for(;n<t;n++){e:for(;n<t;n++)switch(e[n]){case'"':if(a=this.parseString(e,t,n+1,o),this._error)return null;n=o[0],l=!0;break e;case"}":return r[0]=n+1,s;case":":this._error="illegal ':' position";break;case"\n":this._lineCount++}if(!l)return this._error="key not found",null;l=!1;t:for(;n<t;n++)switch(e[n]){case":":l=!0,n++;break t;case"}":this._error="illegal '}' position";break;case"\n":this._lineCount++}if(!l)return this._error="':' not found",null;let i=this.parseValue(e,t,n,o);if(this._error)return null;n=o[0],s.put(a,i);i:for(;n<t;n++)switch(e[n]){case",":break i;case"}":return r[0]=n+1,s;case"\n":this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(e,t,i,r){if(this._error)return null;if(!e)return this._error="buffer is null",null;let s=new x,a=i,n=[,];for(;a<t;a++){let i=this.parseValue(e,t,a,n);if(this._error)return null;a=n[0],i&&s.add(i);e:for(;a<t;a++)switch(e[a]){case",":break e;case"]":return r[0]=a+1,s;case"\n":++this._lineCount}}return s=void 0,this._error="illegal end of parseObject",null}constructor(e,t){this._parseCallback=u.parseJsonObject,this._error=null,this._lineCount=0,this._root=null,void 0!=e&&this.parseBytes(e,t,this._parseCallback)}}class g extends d{isFloat(){return!0}getString(e,t){return this._value=parseFloat("\0"),this._stringBuffer="\0",this._stringBuffer}toInt(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],parseInt(this._value.toString())}toFloat(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],this._value}equals(e){if("number"==typeof e&&!Math.round(e))return e==this._value;return!1}constructor(e){super(),this._value=e}}class m extends d{isBool(){return!0}toBoolean(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],this._boolValue}getString(e,t){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(e){return"boolean"==typeof e&&e==this._boolValue}isStatic(){return!0}constructor(e){super(),this._boolValue=e}}class _ extends d{isString(){return!0}getString(e,t){return this._stringBuffer}equals(e){return"string"==typeof e?this._stringBuffer==e:e instanceof n.F&&this._stringBuffer==e.s}constructor(e){super(),"string"==typeof e&&(this._stringBuffer=e),e instanceof n.F&&(this._stringBuffer=e.s)}}class p extends _{isStatic(){return this._isStatic}setErrorNotForClientCall(e){return this._stringBuffer=e,this}isError(){return!0}constructor(e,t){super(e),this._isStatic=t}}class f extends d{isNull(){return!0}getString(e,t){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(e){return this._stringBuffer=e,p.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class x extends d{release(){for(let e=this._array.begin();e.notEqual(this._array.end());e.preIncrement()){let t=e.ptr();t&&!t.isStatic()&&(t=void 0,t=null)}}isArray(){return!0}getValueByIndex(e){if(e<0||this._array.getSize()<=e)return d.errorValue.setErrorNotForClientCall("Error: index out of bounds");let t=this._array.at(e);return null==t?d.nullValue:t}getValueByString(e){return d.errorValue.setErrorNotForClientCall(h)}getString(e,t){for(let e=this._array.begin();e.notEqual(this._array.end());e.increment()){let i=e.ptr();this._stringBuffer+=t+""+i.getString(t+" ")+"\n"}return this._stringBuffer=t+"[\n"+t+"]\n",this._stringBuffer}add(e){this._array.pushBack(e)}getVector(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],this._array}getSize(){return this._array.getSize()}constructor(){super(),this._array=new o.tG}}class y extends d{release(){let e=this._map.begin();for(;e.notEqual(this._map.end());){let t=e.ptr().second;t&&!t.isStatic()&&(t=void 0,t=null),e.preIncrement()}}isMap(){return!0}getValueByString(e){if(e instanceof n.F){let t=this._map.getValue(e.s);return null==t?d.nullValue:t}for(let t=this._map.begin();t.notEqual(this._map.end());t.preIncrement())if(t.ptr().first==e){if(null==t.ptr().second)return d.nullValue;return t.ptr().second}return d.nullValue}getValueByIndex(e){return d.errorValue.setErrorNotForClientCall(h)}getString(e,t){this._stringBuffer=t+"{\n";let i=this._map.begin();for(;i.notEqual(this._map.end());){let e=i.ptr().first,r=i.ptr().second;this._stringBuffer+=t+" "+e+" : "+r.getString(t+"   ")+" \n",i.preIncrement()}return this._stringBuffer+=t+"}\n",this._stringBuffer}getMap(e){return this._map}put(e,t){this._map.setValue(e,t)}getKeys(){if(!this._keys){this._keys=new o.tG;let e=this._map.begin();for(;e.notEqual(this._map.end());){let t=e.ptr().first;this._keys.pushBack(t),e.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}constructor(){super(),this._map=new a.ak}}!function(e){e.CubismJson=c,e.JsonArray=x,e.JsonBoolean=m,e.JsonError=p,e.JsonFloat=g,e.JsonMap=y,e.JsonNullvalue=f,e.JsonString=_,e.Value=d}(r||(r={}))},278:(e,t,i)=>{"use strict";i.d(t,{D:()=>r});class r{static loadFileAsBytes(e,t){fetch(e).then(e=>e.arrayBuffer()).then(e=>t(e,e.byteLength))}static getDeltaTime(){return this.s_deltaTime}static updateTime(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.s_currentFrame=Date.now(),this.s_deltaTime=(this.s_currentFrame-this.s_lastFrame)/1e3,!0===e&&(this.s_lastFrame=this.s_currentFrame)}static printMessage(e){console.log(e)}}r.lastUpdate=Date.now(),r.s_currentFrame=0,r.s_lastFrame=0,r.s_deltaTime=0},962:(e,t,i)=>{"use strict";i.d(t,{n:()=>a});var r,s=i(962);class a{static multiply(e,t,i){let r=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let i=0;i<4;++i)for(let s=0;s<4;++s)for(let a=0;a<4;++a)r[s+4*i]+=e[a+4*i]*t[s+4*a];for(let e=0;e<16;++e)i[e]=r[e]}loadIdentity(){let e=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(e)}setMatrix(e){for(let t=0;t<16;++t)this._tr[t]=e[t]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(e){return this._tr[0]*e+this._tr[12]}transformY(e){return this._tr[5]*e+this._tr[13]}invertTransformX(e){return(e-this._tr[12])/this._tr[0]}invertTransformY(e){return(e-this._tr[13])/this._tr[5]}translateRelative(e,t){let i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]);a.multiply(i,this._tr,this._tr)}translate(e,t){this._tr[12]=e,this._tr[13]=t}translateX(e){this._tr[12]=e}translateY(e){this._tr[13]=e}scaleRelative(e,t){let i=new Float32Array([e,0,0,0,0,t,0,0,0,0,1,0,0,0,0,1]);a.multiply(i,this._tr,this._tr)}scale(e,t){this._tr[0]=e,this._tr[5]=t}multiplyByMatrix(e){a.multiply(e.getArray(),this._tr,this._tr)}clone(){let e=new a;for(let t=0;t<this._tr.length;t++)e._tr[t]=this._tr[t];return e}constructor(){this._tr=new Float32Array(16),this.loadIdentity()}}(r||(r={})).CubismMatrix44=s.n},2342:(e,t,i)=>{"use strict";i.d(t,{lJ:()=>n,tG:()=>a});var r,s=i(2342);class a{at(e){return this._ptr[e]}set(e,t){this._ptr[e]=t}get(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=[];for(let i=e;i<this._size;i++)t.push(this._ptr[i]);return t}pushBack(e){this._size>=this._capacity&&this.prepareCapacity(0==this._capacity?a.DefaultSize:2*this._capacity),this._ptr[this._size++]=e}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(e,t){this._size<e&&this.prepareCapacity(e);for(let i=0;i<e;i++)this._ptr[i]=t;this._size=e}resize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.updateSize(e,t,!0)}updateSize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(this._size<e)if(this.prepareCapacity(e),i)for(let i=this._size;i<e;i++)"function"==typeof t?this._ptr[i]=JSON.parse(JSON.stringify(new t)):this._ptr[i]=t;else for(let i=this._size;i<e;i++)this._ptr[i]=t;else{let t=this._size-e;this._ptr.splice(this._size-t,t)}this._size=e}insert(e,t,i){let r=e._index,s=t._index,a=i._index,n=a-s;this.prepareCapacity(this._size+n);let o=this._size-r;if(o>0)for(let e=0;e<o;e++)this._ptr.splice(r+e,0,null);for(let e=s;e<a;e++,r++)this._ptr[r]=t._vector._ptr[e];this._size=this._size+n}remove(e){return!(e<0)&&!(this._size<=e)&&(this._ptr.splice(e,1),--this._size,!0)}erase(e){let t=e._index;return t<0||this._size<=t?e:(this._ptr.splice(t,1),--this._size,new n(this,t))}prepareCapacity(e){e>this._capacity&&(0==this._capacity?this._ptr=Array(e):this._ptr.length=e,this._capacity=e)}begin(){return 0==this._size?this.end():new n(this,0)}end(){return new n(this,this._size)}getOffset(e){let t=new a;return t._ptr=this.get(e),t._size=this.get(e).length,t._capacity=this.get(e).length,t}constructor(e=0){e<1?(this._ptr=[],this._capacity=0):(this._ptr=Array(e),this._capacity=e),this._size=0}}a.DefaultSize=10;class n{set(e){return this._index=e._index,this._vector=e._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new n(this._vector,this._index++)}decrement(){return new n(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(e){return this._index=e._index,this._vector=e._vector,this}notEqual(e){return this._index!=e._index||this._vector!=e._vector}constructor(e,t){this._vector=void 0!=e?e:null,this._index=void 0!=t?t:0}}!function(e){e.csmVector=s.tG,e.iterator=s.lJ}(r||(r={}))},2793:(e,t,i)=>{"use strict";i.d(t,{U1:()=>l,u3:()=>u});var r,s,a=i(3938);class n{release(){this._autoDelete&&this._motion&&a.D.delete(this._motion)}setFadeOut(e){this._fadeOutSeconds=e,this._isTriggeredFadeOut=!0}startFadeOut(e,t){let i=t+e;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(e){this._startTimeSeconds=e}setFadeInStartTime(e){this._fadeInStartTimeSeconds=e}setEndTime(e){this._endTimeSeconds=e}setIsFinished(e){this._finished=e}setIsStarted(e){this._started=e}isAvailable(){return this._available}setIsAvailable(e){this._available=e}setState(e,t){this._stateTimeSeconds=e,this._stateWeight=t}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(e){this._lastEventCheckSeconds=e}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}getCubismMotion(){return this._motion}constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}}(r||(r={})).CubismMotionQueueEntry=n;var o=i(2342);class l{release(){for(let e=0;e<this._motions.getSize();++e)this._motions.at(e)&&(this._motions.at(e).release(),this._motions.set(e,null));this._motions=null}startMotion(e,t,i){if(null==e)return u;let r=null;for(let e=0;e<this._motions.getSize();++e)null!=(r=this._motions.at(e))&&r.setFadeOut(r._motion.getFadeOutTime());return(r=new n)._autoDelete=t,r._motion=e,this._motions.pushBack(r),r._motionQueueEntryHandle}isFinished(){for(let e=this._motions.begin();e.notEqual(this._motions.end());){let t=e.ptr();if(null==t){e=this._motions.erase(e);continue}if(null==t._motion){t.release(),t=null,e=this._motions.erase(e);continue}if(!t.isFinished())return!1;e.preIncrement()}return!0}isFinishedByHandle(e){for(let t=this._motions.begin();t.notEqual(this._motions.end());t.increment()){let i=t.ptr();if(null!=i&&i._motionQueueEntryHandle==e&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let e=this._motions.begin();e.notEqual(this._motions.end());){let t=e.ptr();if(null==t){e=this._motions.erase(e);continue}t.release(),t=null,e=this._motions.erase(e)}}getCubismMotionQueueEntries(){return this._motions}getCubismMotionQueueEntry(e){for(let t=this._motions.begin();t.notEqual(this._motions.end());t.preIncrement()){let i=t.ptr();if(null!=i&&i._motionQueueEntryHandle==e)return i}return null}setEventCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._eventCallBack=e,this._eventCustomData=t}doUpdateMotion(e,t){let i=!1;for(let r=this._motions.begin();r.notEqual(this._motions.end());){let s=r.ptr();if(null==s){r=this._motions.erase(r);continue}let a=s._motion;if(null==a){s.release(),s=null,r=this._motions.erase(r);continue}a.updateParameters(e,s,t),i=!0;let n=a.getFiredEvent(s.getLastCheckEventSeconds()-s.getStartTime(),t-s.getStartTime());for(let e=0;e<n.getSize();++e)this._eventCallBack(this,n.at(e),this._eventCustomData);s.setLastCheckEventSeconds(t),s.isFinished()?(s.release(),s=null,r=this._motions.erase(r)):(s.isTriggeredFadeOut()&&s.startFadeOut(s.getFadeOutSeconds(),t),r.preIncrement())}return i}constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new o.tG}}let u=-1;!function(e){e.CubismMotionQueueManager=l,e.InvalidMotionQueueEntryHandleValue=u}(s||(s={}))},2887:(e,t,i)=>{"use strict";i.d(t,{w:()=>a});var r,s=i(2887);class a{getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}expand(e,t){this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t}constructor(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}}(r||(r={})).csmRect=s.w},3938:(e,t,i)=>{"use strict";i.d(t,{D:()=>u});var r,s=i(6273),a=i(2342),n=i(5626),o=i(3938),l=i(7932);class u{static delete(e){e.release(),e=null}release(){this._weight=0}updateParameters(e,t,i){if(!t.isAvailable()||t.isFinished())return;this.setupMotionQueueEntry(t,i);let r=this.updateFadeWeight(t,i);this.doUpdateParameters(e,i,r,t),t.getEndTime()>0&&t.getEndTime()<i&&t.setIsFinished(!0)}setupMotionQueueEntry(e,t){if(null==e||e.isStarted()||!e.isAvailable())return;e.setIsStarted(!0),e.setStartTime(t-this._offsetSeconds),e.setFadeInStartTime(t);let i=this.getDuration();0>e.getEndTime()&&e.setEndTime(i<=0?-1:e.getStartTime()+i)}updateFadeWeight(e,t){null==e&&n.Xs.print(l.$b.LogLevel_Error,"motionQueueEntry is null.");let i=this._weight;return i=i*(0==this._fadeInSeconds?1:s.C.getEasingSine((t-e.getFadeInStartTime())/this._fadeInSeconds))*(0==this._fadeOutSeconds||0>e.getEndTime()?1:s.C.getEasingSine((e.getEndTime()-t)/this._fadeOutSeconds)),e.setState(t,i),(0,n.vT)(0<=i&&i<=1),i}setFadeInTime(e){this._fadeInSeconds=e}setFadeOutTime(e){this._fadeOutSeconds=e}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(e){this._weight=e}getWeight(){return this._weight}getDuration(){return -1}getLoopDuration(){return -1}setOffsetTime(e){this._offsetSeconds=e}getFiredEvent(e,t){return this._firedEventValues}isExistModelOpacity(){return!1}getModelOpacityIndex(){return -1}getModelOpacityId(e){return null}getModelOpacityValue(){return 1}constructor(){this.setFinishedMotionHandler=e=>this._onFinishedMotion=e,this.getFinishedMotionHandler=()=>this._onFinishedMotion,this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new a.tG}}(r||(r={})).ACubismMotion=o.D},4242:(e,t,i)=>{"use strict";i.d(t,{r:()=>a});var r,s=i(4242);class a{add(e){let t=new a(0,0);return t.x=this.x+e.x,t.y=this.y+e.y,t}substract(e){let t=new a(0,0);return t.x=this.x-e.x,t.y=this.y-e.y,t}multiply(e){let t=new a(0,0);return t.x=this.x*e.x,t.y=this.y*e.y,t}multiplyByScaler(e){return this.multiply(new a(e,e))}division(e){let t=new a(0,0);return t.x=this.x/e.x,t.y=this.y/e.y,t}divisionByScalar(e){return this.division(new a(e,e))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(e){return Math.sqrt((this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y))}dot(e){return this.x*e.x+this.y*e.y}normalize(){let e=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/e,this.y=this.y/e}isEqual(e){return this.x==e.x&&this.y==e.y}isNotEqual(e){return!this.isEqual(e)}constructor(e,t){this.x=e,this.y=t,this.x=void 0==e?0:e,this.y=void 0==t?0:t}}(r||(r={})).CubismVector2=s.r},4532:(e,t,i)=>{"use strict";i.d(t,{FD:()=>o,kY:()=>u,l8:()=>h,sl:()=>l});var r,s=i(962),a=i(2887),n=i(4532);class o{static create(){return null}static delete(e){}initialize(e){this._model=e}drawModel(){null!=this.getModel()&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(e){this._mvpMatrix4x4.setMatrix(e.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(e,t,i,r){e<0?e=0:e>1&&(e=1),t<0?t=0:t>1&&(t=1),i<0?i=0:i>1&&(i=1),r<0?r=0:r>1&&(r=1),this._modelColor.r=e,this._modelColor.g=t,this._modelColor.b=i,this._modelColor.a=r}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}getModelColorWithOpacity(e){let t=this.getModelColor();return t.a*=e,this.isPremultipliedAlpha()&&(t.r*=t.a,t.g*=t.a,t.b*=t.a),t}setIsPremultipliedAlpha(e){this._isPremultipliedAlpha=e}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(e){this._isCulling=e}isCulling(){return this._isCulling}setAnisotropy(e){this._anisotropy=e}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(e){this._useHighPrecisionMask=e}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new u,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new s.n,this._mvpMatrix4x4.loadIdentity()}}var l=function(e){return e[e.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",e[e.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",e[e.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",e}({});class u{constructor(e=1,t=1,i=1,r=1){this.r=e,this.g=t,this.b=i,this.a=r}}class h{release(){null!=this._layoutBounds&&(this._layoutBounds=null),null!=this._allClippedDrawRect&&(this._allClippedDrawRect=null),null!=this._clippedDrawableIndexList&&(this._clippedDrawableIndexList=null)}addClippedDrawable(e){this._clippedDrawableIndexList.push(e)}constructor(e,t){this._clippingIdList=e,this._clippingIdCount=t,this._allClippedDrawRect=new a.w,this._layoutBounds=new a.w,this._clippedDrawableIndexList=[],this._matrixForMask=new s.n,this._matrixForDraw=new s.n,this._bufferIndex=0}}!function(e){e.CubismBlendMode=n.sl,e.CubismRenderer=n.FD,e.CubismTextureColor=n.kY}(r||(r={}))},5626:(e,t,i)=>{"use strict";let r,s,a,n;i.d(t,{vT:()=>h,Xs:()=>d,XH:()=>r,iA:()=>n,qP:()=>s,E2:()=>a});var o,l=i(7932);let u=(e,t,i)=>{d.print(e,"[CSM]"+(t+"\n"),i)},h=e=>{console.assert(e)};r=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];u(l.$b.LogLevel_Debug,"[D]"+e,i)},s=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];u(l.$b.LogLevel_Info,"[I]"+e,i)},a=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];u(l.$b.LogLevel_Warning,"[W]"+e,i)},n=function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];u(l.$b.LogLevel_Error,"[E]"+e,i)};class d{static print(e,t,i){if(e<l.MN.getLoggingLevel())return;let r=l.MN.coreLogFunction;r&&r(t.replace(/\{(\d+)\}/g,(e,t)=>i[t]))}static dumpBytes(e,t,i){for(let r=0;r<i;r++)r%16==0&&r>0?this.print(e,"\n"):r%8==0&&r>0&&this.print(e,"  "),this.print(e,"{0} ",[255&t[r]]);this.print(e,"\n")}constructor(){}}(o||(o={})).CubismDebug=d},5943:(e,t,i)=>{"use strict";i.d(t,{F:()=>a});var r,s=i(5943);class a{append(e,t){return this.s+=void 0!==t?e.substr(0,t):e,this}expansion(e,t){for(let i=0;i<e;i++)this.append(t);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(e){return this.s<e.s}isGreat(e){return this.s>e.s}isEqual(e){return this.s==e}isEmpty(){return 0==this.s.length}constructor(e){this.s=e}}(r||(r={})).csmString=s.F},6273:(e,t,i)=>{"use strict";i.d(t,{C:()=>n});var r,s=i(4242),a=i(6273);class n{static range(e,t,i){return e<t?e=t:e>i&&(e=i),e}static sin(e){return Math.sin(e)}static cos(e){return Math.cos(e)}static abs(e){return Math.abs(e)}static sqrt(e){return Math.sqrt(e)}static cbrt(e){let t;if(0===e)return e;let i=e,r=i<0;return r&&(i=-i),i===1/0?t=1/0:(t=Math.exp(Math.log(i)/3),t=(i/(t*t)+2*t)/3),r?-t:t}static getEasingSine(e){return e<0?0:e>1?1:.5-.5*this.cos(e*Math.PI)}static max(e,t){return e>t?e:t}static min(e,t){return e>t?t:e}static degreesToRadian(e){return e/180*Math.PI}static radianToDegrees(e){return 180*e/Math.PI}static directionToRadian(e,t){let i=Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x);for(;i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;return i}static directionToDegrees(e,t){let i=this.directionToRadian(e,t),r=this.radianToDegrees(i);return t.x-e.x>0&&(r=-r),r}static radianToDirection(e){let t=new s.r;return t.x=this.sin(e),t.y=this.cos(e),t}static quadraticEquation(e,t,i){return this.abs(e)<n.Epsilon?this.abs(t)<n.Epsilon?-i:-i/t:-(t+this.sqrt(t*t-4*e*i))/(2*e)}static cardanoAlgorithmForBezier(e,t,i,r){if(this.sqrt(e)<n.Epsilon)return this.range(this.quadraticEquation(t,i,r),0,1);let s=t/e,a=i/e,o=(3*a-s*s)/3,l=o/3,u=(2*s*s*s-9*s*a+r/e*27)/27,h=u/2,d=h*h+l*l*l;if(d<0){let e=-o/3,t=this.sqrt(e*e*e),i=Math.acos(this.range(-u/(2*t),-1,1)),r=2*this.cbrt(t),a=r*this.cos(i/3)-s/3;if(.51>this.abs(a-.5))return this.range(a,0,1);let n=r*this.cos((i+2*Math.PI)/3)-s/3;if(.51>this.abs(n-.5))return this.range(n,0,1);let l=r*this.cos((i+4*Math.PI)/3)-s/3;return this.range(l,0,1)}if(0==d){let e,t=2*(e=h<0?this.cbrt(-h):-this.cbrt(h))-s/3;return .51>this.abs(t-.5)?this.range(t,0,1):this.range(-e-s/3,0,1)}let c=this.sqrt(d),g=this.cbrt(c-h),m=this.cbrt(c+h);return this.range(g-m-s/3,0,1)}static mod(e,t){if(!isFinite(e)||0===t||isNaN(e)||isNaN(t))return console.warn("divided: ".concat(e,", divisor: ").concat(t," mod() returns 'NaN'.")),NaN;let i=Math.abs(e),r=Math.abs(t),s=i-Math.floor(i/r)*r;return s*Math.sign(e)}constructor(){}}n.Epsilon=1e-5,(r||(r={})).CubismMath=a.C},6339:(e,t,i)=>{"use strict";i.d(t,{VY:()=>x,qO:()=>f});var r,s=i(7932),a=i(7126),n=i(9988),o=i(278),l=i(2342),u=i(8385);class h{release(){for(let e=this._textures.begin();e.notEqual(this._textures.end());e.preIncrement())u.gl.deleteTexture(e.ptr().id);this._textures=null}createTextureFromPngFile(e,t,i){for(let r=this._textures.begin();r.notEqual(this._textures.end());r.preIncrement())if(r.ptr().fileName==e&&r.ptr().usePremultply==t){r.ptr().img=new Image,r.ptr().img.addEventListener("load",()=>i(r.ptr()),{passive:!0}),r.ptr().img.src=e;return}let r=new Image;r.crossOrigin="anonymous",r.addEventListener("load",()=>{let s=u.gl.createTexture();u.gl.bindTexture(u.gl.TEXTURE_2D,s),u.gl.texParameteri(u.gl.TEXTURE_2D,u.gl.TEXTURE_MIN_FILTER,u.gl.LINEAR_MIPMAP_LINEAR),u.gl.texParameteri(u.gl.TEXTURE_2D,u.gl.TEXTURE_MAG_FILTER,u.gl.LINEAR),t&&u.gl.pixelStorei(u.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),u.gl.texImage2D(u.gl.TEXTURE_2D,0,u.gl.RGBA,u.gl.RGBA,u.gl.UNSIGNED_BYTE,r),u.gl.generateMipmap(u.gl.TEXTURE_2D),u.gl.bindTexture(u.gl.TEXTURE_2D,null);let a=new d;null!=a&&(a.fileName=e,a.width=r.width,a.height=r.height,a.id=s,a.img=r,a.usePremultply=t,this._textures.pushBack(a)),i(a)},{passive:!0}),r.src=e}releaseTextures(){for(let e=0;e<this._textures.getSize();e++)this._textures.set(e,null);this._textures.clear()}releaseTextureByTexture(e){for(let t=0;t<this._textures.getSize();t++)if(this._textures.at(t).id==e){this._textures.set(t,null),this._textures.remove(t);break}}releaseTextureByFilePath(e){for(let t=0;t<this._textures.getSize();t++)if(this._textures.at(t).fileName==e){this._textures.set(t,null),this._textures.remove(t);break}}constructor(){this._textures=new l.tG}}class d{constructor(){this.id=null,this.width=0,this.height=0}}var c=i(962);class g extends c.n{adjustTranslate(e,t){this._tr[0]*this._maxLeft+(this._tr[12]+e)>this._screenLeft&&(e=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+e)<this._screenRight&&(e=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+t)<this._screenTop&&(t=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+t)>this._screenBottom&&(t=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);let i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]);c.n.multiply(i,this._tr,this._tr)}adjustScale(e,t,i){let r=this.getMaxScale(),s=this.getMinScale(),a=i*this._tr[0];a<s?this._tr[0]>0&&(i=s/this._tr[0]):a>r&&this._tr[0]>0&&(i=r/this._tr[0]);let n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,t,0,1]),o=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),l=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-e,-t,0,1]);c.n.multiply(l,this._tr,this._tr),c.n.multiply(o,this._tr,this._tr),c.n.multiply(n,this._tr,this._tr)}setScreenRect(e,t,i,r){this._screenLeft=e,this._screenRight=t,this._screenBottom=i,this._screenTop=r}setMaxScreenRect(e,t,i,r){this._maxLeft=e,this._maxRight=t,this._maxTop=r,this._maxBottom=i}setMaxScale(e){this._maxScale=e}setMinScale(e){this._minScale=e}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}constructor(){super(),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}}(r||(r={})).CubismViewMatrix=g;class m{getCenterX(){return this._lastX}getCenterY(){return this._lastY}getDeltaX(){return this._deltaX}getDeltaY(){return this._deltaY}getStartX(){return this._startX}getStartY(){return this._startY}getScale(){return this._scale}getX(){return this._lastX}getY(){return this._lastY}getX1(){return this._lastX1}getY1(){return this._lastY1}getX2(){return this._lastX2}getY2(){return this._lastY2}isSingleTouch(){return this._touchSingle}isFlickAvailable(){return this._flipAvailable}disableFlick(){this._flipAvailable=!1}touchesBegan(e,t){this._lastX=e,this._lastY=t,this._startX=e,this._startY=t,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0}touchesMoved(e,t){this._lastX=e,this._lastY=t,this._lastTouchDistance=-1,this._touchSingle=!0}getFlickDistance(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)}calculateDistance(e,t,i,r){return Math.sqrt((e-i)*(e-i)+(t-r)*(t-r))}calculateMovingAmount(e,t){if(e>0!=t>0)return 0;let i=Math.abs(e),r=Math.abs(t);return(e>0?1:-1)*(i<r?i:r)}constructor(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}}class _{initialize(){let{width:e,height:t}=u.Ji,i=e/t,r=-i,s=a.ViewLogicalLeft,n=a.ViewLogicalRight;if(this._viewMatrix.setScreenRect(r,i,s,n),this._viewMatrix.scale(a.ViewScale,a.ViewScale),this._deviceToScreen.loadIdentity(),e>t){let t=Math.abs(i-r);this._deviceToScreen.scaleRelative(t/e,-t/e)}else{let e=Math.abs(n-s);this._deviceToScreen.scaleRelative(e/t,-e/t)}this._deviceToScreen.translateRelative(-(.5*e),-(.5*t)),this._viewMatrix.setMaxScale(a.ViewMaxScale),this._viewMatrix.setMinScale(a.ViewMinScale),this._viewMatrix.setMaxScreenRect(a.ViewLogicalMaxLeft,a.ViewLogicalMaxRight,a.ViewLogicalMaxBottom,a.ViewLogicalMaxTop)}release(){this._viewMatrix=null,this._touchManager=null,this._deviceToScreen=null,this._back.release(),this._back=null,u.gl.deleteProgram(this._programId),this._programId=null}render(){u.gl.useProgram(this._programId),this._back&&this._back.render(this._programId),u.gl.flush();let e=n.V.getInstance();e.setViewMatrix(this._viewMatrix),e.onUpdate()}initializeSprite(){u.Ji.width,u.Ji.height,x.getInstance().getTextureManager(),a.ResourcesPath;a.BackImageName,null==this._programId&&(this._programId=x.getInstance().createShader())}onTouchesBegan(e,t){this._touchManager.touchesBegan(e*window.devicePixelRatio,t*window.devicePixelRatio)}onTouchesMoved(e,t){let i=this.transformViewX(this._touchManager.getX()),r=this.transformViewY(this._touchManager.getY());this._touchManager.touchesMoved(e*window.devicePixelRatio,t*window.devicePixelRatio),n.V.getInstance().onDrag(i,r)}onTouchesEnded(e,t){let i=n.V.getInstance();i.onDrag(0,0);{let e=this._deviceToScreen.transformX(this._touchManager.getX()),t=this._deviceToScreen.transformY(this._touchManager.getY());a.DebugTouchLogEnable&&o.D.printMessage("[APP]touchesEnded x: ".concat(e," y: ").concat(t)),i.onTap(e,t)}}transformViewX(e){let t=this._deviceToScreen.transformX(e);return this._viewMatrix.invertTransformX(t)}transformViewY(e){let t=this._deviceToScreen.transformY(e);return this._viewMatrix.invertTransformY(t)}transformScreenX(e){return this._deviceToScreen.transformX(e)}transformScreenY(e){return this._deviceToScreen.transformY(e)}constructor(){this._programId=null,this._back=null,this._touchManager=new m,this._deviceToScreen=new c.n,this._viewMatrix=new g}}let p=null,f=null;class x{static getInstance(){return null==p&&(p=new x),p}static releaseInstance(){null!=p&&p.release(),p=null}initialize(){return"auto"===a.CanvasSize?this._resizeCanvas():(u.Ji.width=a.CanvasSize.width,u.Ji.height=a.CanvasSize.height),f||(f=u.gl.getParameter(u.gl.FRAMEBUFFER_BINDING)),u.gl.enable(u.gl.BLEND),u.gl.blendFunc(u.gl.SRC_ALPHA,u.gl.ONE_MINUS_SRC_ALPHA),"ontouchend"in u.Ji?(u.Ji.addEventListener("touchstart",S,{passive:!0}),u.Ji.addEventListener("touchmove",C,{passive:!0}),u.Ji.addEventListener("touchend",w,{passive:!0}),u.Ji.addEventListener("touchcancel",M,{passive:!0})):(u.Ji.addEventListener("mousedown",y,{passive:!0}),u.Ji.addEventListener("mousemove",b,{passive:!0}),u.Ji.addEventListener("mouseup",v,{passive:!0})),this._view.initialize(),this.initializeCubism(),!0}onResize(){if(this._resizeCanvas(),this._view){this._view.initialize(),this._view.initializeSprite();let e=n.V.getInstance();if(e){let t=e.getModel(0);if(t){let e=u.Ji.width,i=u.Ji.height;e>0&&i>0&&t.setPosition&&t.setPosition(e/2,i/2)}}}}release(){this._textureManager.release(),this._textureManager=null,this._view.release(),this._view=null,n.V.releaseInstance(),s.MN.dispose()}run(){let e=()=>{if(null!=p){if(a.ENABLE_LIMITED_FRAME_RATE&&(o.D.updateTime(!1),o.D.getDeltaTime()<1/a.LIMITED_FRAME_RATE))return void requestAnimationFrame(e);o.D.updateTime(!0),u.gl.clearColor(0,0,0,1),u.gl.enable(u.gl.DEPTH_TEST),u.gl.depthFunc(u.gl.LEQUAL),u.gl.clear(u.gl.DEPTH_BUFFER_BIT),u.gl.clearDepth(1),u.gl.enable(u.gl.BLEND),u.gl.blendFunc(u.gl.SRC_ALPHA,u.gl.ONE_MINUS_SRC_ALPHA),this._view.render(),requestAnimationFrame(e)}};e()}createShader(){let e=u.gl.createShader(u.gl.VERTEX_SHADER);if(null==e)return o.D.printMessage("failed to create vertexShader"),null;u.gl.shaderSource(e,"precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}"),u.gl.compileShader(e);let t=u.gl.createShader(u.gl.FRAGMENT_SHADER);if(null==t)return o.D.printMessage("failed to create fragmentShader"),null;u.gl.shaderSource(t,"precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}"),u.gl.compileShader(t);let i=u.gl.createProgram();return u.gl.attachShader(i,e),u.gl.attachShader(i,t),u.gl.deleteShader(e),u.gl.deleteShader(t),u.gl.linkProgram(i),u.gl.useProgram(i),i}getView(){return this._view}getTextureManager(){return this._textureManager}initializeCubism(){this._cubismOption.logFunction=o.D.printMessage,this._cubismOption.loggingLevel=a.CubismLoggingLevel,s.MN.startUp(this._cubismOption),s.MN.initialize(),n.V.getInstance(),o.D.updateTime(),this._view.initializeSprite()}_resizeCanvas(){u.Ji.width=u.Ji.clientWidth*window.devicePixelRatio,u.Ji.height=u.Ji.clientHeight*window.devicePixelRatio,u.gl.viewport(0,0,u.gl.drawingBufferWidth,u.gl.drawingBufferHeight)}constructor(){this._captured=!1,this._mouseX=0,this._mouseY=0,this._isEnd=!1,this._cubismOption=new s.c$,this._view=new _,this._textureManager=new h}}function y(e){if(!x.getInstance()._view)return void o.D.printMessage("view notfound");x.getInstance()._captured=!0;let t=e.pageX,i=e.pageY;x.getInstance()._view.onTouchesBegan(t,i)}function b(e){if(!x.getInstance()._captured)return;if(!x.getInstance()._view)return void o.D.printMessage("view notfound");let t=e.target.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top;x.getInstance()._view.onTouchesMoved(i,r)}function v(e){if(x.getInstance()._captured=!1,!x.getInstance()._view)return void o.D.printMessage("view notfound");let t=e.target.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top;x.getInstance()._view.onTouchesEnded(i,r)}function S(e){if(!x.getInstance()._view)return void o.D.printMessage("view notfound");x.getInstance()._captured=!0;let t=e.changedTouches[0].pageX,i=e.changedTouches[0].pageY;x.getInstance()._view.onTouchesBegan(t,i)}function C(e){if(!x.getInstance()._captured)return;if(!x.getInstance()._view)return void o.D.printMessage("view notfound");let t=e.target.getBoundingClientRect(),i=e.changedTouches[0].clientX-t.left,r=e.changedTouches[0].clientY-t.top;x.getInstance()._view.onTouchesMoved(i,r)}function w(e){if(x.getInstance()._captured=!1,!x.getInstance()._view)return void o.D.printMessage("view notfound");let t=e.target.getBoundingClientRect(),i=e.changedTouches[0].clientX-t.left,r=e.changedTouches[0].clientY-t.top;x.getInstance()._view.onTouchesEnded(i,r)}function M(e){if(x.getInstance()._captured=!1,!x.getInstance()._view)return void o.D.printMessage("view notfound");let t=e.target.getBoundingClientRect(),i=e.changedTouches[0].clientX-t.left,r=e.changedTouches[0].clientY-t.top;x.getInstance()._view.onTouchesEnded(i,r)}},6563:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LAppAdapter:()=>h,s_adapter_instance:()=>u});var r=i(9988),s=i(7742),a=i(7126),n=i(278),o=i(2793),l=i(7932);let u=null;class h{static getInstance(){return null==u&&(u=new h),u}getMgr(){return r.V.getInstance()}getModel(){return this.getMgr().getModel(0)}getIdManager(){return l.MN.getIdManager()}getMotionGroups(){var e,t,i;let r=[];for(let s=0;s<(null==(e=this.getModel())?void 0:e._modelSetting.getMotionGroupCount());s++)r.push(null!=(i=null==(t=this.getModel())?void 0:t._modelSetting.getMotionGroupName(s))?i:"");return r}getMotionCount(e){var t,i;return null!=(i=null==(t=this.getModel())?void 0:t._modelSetting.getMotionCount(e))?i:0}startMotion(e,t,i,r){var s,a;return null!=(a=null==(s=this.getModel())?void 0:s.startMotion(e,t,i,r))?a:o.u3}getExpressionCount(){var e,t;return null!=(t=null==(e=this.getModel())?void 0:e._expressions.getSize())?t:0}getExpressionName(e){var t,i,r;return null!=(r=null==(i=this.getModel())||null==(t=i._modelSetting)?void 0:t.getExpressionName(e))?r:""}setExpression(e){var t;null==(t=this.getModel())||t.setExpression(e)}nextChara(){this.getMgr().nextScene()}setChara(e,t){var i;let r=(e.endsWith("/")?e:e+"/")+t+"/";a.DebugLogEnable&&n.D.printMessage("[APP]model Dir: ".concat(r)),this.getMgr().releaseAllModel(),this.getMgr()._models.pushBack(new s.$),null==(i=this.getMgr()._models.at(0))||i.loadAssets(r,t+".model3.json")}getModelPosition(){let e=this.getModel();if(e&&e._modelMatrix){let t=e._modelMatrix.getArray();return{x:t[12],y:t[13]}}return{x:0,y:0}}setModelPosition(e,t){let i=this.getModel();if(i&&i._modelMatrix){let r=[...i._modelMatrix.getArray()];r[12]=e,r[13]=t,i._modelMatrix.setMatrix(r)}}}},7126:(e,t,i)=>{"use strict";i.r(t),i.d(t,{BackImageName:()=>S,CanvasSize:()=>s,CubismLoggingLevel:()=>L,CurrentKScale:()=>n,DebugLogEnable:()=>F,DebugTouchLogEnable:()=>A,ENABLE_LIMITED_FRAME_RATE:()=>j,GearImageName:()=>C,HitAreaNameBody:()=>I,HitAreaNameHead:()=>B,LIMITED_FRAME_RATE:()=>O,MOCConsistencyValidationEnable:()=>T,ModelDir:()=>x,ModelDirSize:()=>v,ModelFileNames:()=>y,MotionGroupIdle:()=>M,MotionGroupTapBody:()=>P,PowerImageName:()=>w,PriorityForce:()=>k,PriorityIdle:()=>V,PriorityNone:()=>E,PriorityNormal:()=>R,RenderTargetHeight:()=>N,RenderTargetWidth:()=>D,ResourcesPath:()=>f,ViewLogicalBottom:()=>d,ViewLogicalLeft:()=>u,ViewLogicalMaxBottom:()=>_,ViewLogicalMaxLeft:()=>g,ViewLogicalMaxRight:()=>m,ViewLogicalMaxTop:()=>p,ViewLogicalRight:()=>h,ViewLogicalTop:()=>c,ViewMaxScale:()=>o,ViewMinScale:()=>l,ViewScale:()=>a,updateModelConfig:()=>b});var r=i(7932);let s="auto",a=1,n=1,o=2,l=.8,u=-1,h=1,d=-1,c=1,g=-2,m=2,_=-2,p=2,f="",x=[],y=[];function b(e,t,i,r){console.log("Updating model config:",{resourcePath:e,modelDirectory:t,modelFileName:i,kScale:r}),f=e,x=[t],y=[i],void 0!==r&&(n=r),v=x.length}let v=x.length,S="back_class_normal.png",C="icon_gear.png",w="CloseNormal.png",M="Idle",P="TapBody",B="Head",I="Body",E=0,V=1,R=2,k=3,T=!0,F=!1,A=!1,L=r.$b.LogLevel_Verbose,D=1900,N=1e3,j=!0,O=60},7315:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>L});var r=i(5155),s=i(2115),a=i(1538);let n=()=>{let e=(0,s.useCallback)((e,t,i)=>{try{if("string"==typeof e)t.setExpression(e);else if("number"==typeof e){let i=t.getExpressionName(e);i&&t.setExpression(i)}i&&console.log(i)}catch(e){console.error("Failed to set expression:",e)}},[]),t=(0,s.useCallback)((t,i)=>{if(t)try{let r=t.getModel();if(!r||!r._modelSetting)return void console.log("Model or model settings not loaded yet, skipping expression reset");if((null==i?void 0:i.defaultEmotion)!==void 0)e(i.defaultEmotion,t,"Reset expression to default: ".concat(i.defaultEmotion));else if(t.getExpressionCount()>0){let i=t.getExpressionName(0);i&&e(i,t)}}catch(e){console.log("Failed to reset expression:",e)}},[e]);return{setExpression:e,resetExpression:t}};var o=i(7126);let l=()=>{let{setExpression:e}=n(),t=(0,s.useRef)(null),i=(0,s.useRef)(null),r=(0,s.useCallback)(()=>{if(t.current){console.log("Stopping current audio and lip sync");let e=t.current;e.pause(),e.src="",e.load();let r=i.current;if(r&&r._wavFileHandler)try{r._wavFileHandler.releasePcmData(),console.log("Called _wavFileHandler.releasePcmData()"),r._wavFileHandler._lastRms=0,r._wavFileHandler._sampleOffset=0,r._wavFileHandler._userTimeSeconds=0,console.log("Also reset _lastRms, _sampleOffset, _userTimeSeconds as fallback")}catch(e){console.error("Error stopping/resetting wavFileHandler:",e)}else r?console.warn("Current model does not have _wavFileHandler to stop/reset."):console.log("No associated model found to stop lip sync.");t.current=null,i.current=null}else console.log("No current audio playing to stop.")},[]);return{addAudioTask:async s=>{console.log("Playing audio with expressions: ".concat(s.expressions)),await new Promise(a=>{let{audioBase64:n,expressions:l}=s;try{if(!n||""===n.trim()||n.trim().length<10){console.log("No valid audio data provided (".concat((null==n?void 0:n.length)||0," chars), skipping audio playback")),a();return}if(!/^[A-Za-z0-9+/]*={0,2}$/.test(n.trim())){console.error("Invalid base64 audio data format"),a();return}if(r(),n){var u,h,d,c;let r="data:audio/wav;base64,".concat(n);if(!r||"data:audio/wav;base64,"===r){console.error("Invalid audio data URL generated"),a();return}let s=null==(u=(h=window).getLive2DManager)?void 0:u.call(h);if(!s){console.error("Live2D manager not found"),a();return}let g=s.getModel(0);if(!g){console.error("Live2D model not found at index 0"),a();return}console.log("Found model for audio playback"),i.current=g,g._wavFileHandler?console.log("Model has _wavFileHandler available"):console.warn("Model does not have _wavFileHandler for lip sync");let m=null==(d=(c=window).getLAppAdapter)?void 0:d.call(c);m&&(null==l?void 0:l[0])!==void 0&&e(l[0],m,"Set expression to: ".concat(l[0])),o&&o.PriorityNormal?(console.log("Starting random 'Talk' motion"),g.startRandomMotion("Talk",o.PriorityNormal)):console.warn("LAppDefine.PriorityNormal not found - cannot start talk motion");let _=new Audio;t.current=_;let p=!1,f=!1,x=()=>{!f&&(f=!0,console.log("Cleaning up audio playback"),t.current===_&&(t.current=null,i.current=null),p||(p=!0,a()))};if(_.addEventListener("canplaythrough",()=>{if(t.current!==_||f){console.warn("Audio playback cancelled due to new audio or cleanup"),x();return}if(console.log("Starting audio playback with lip sync"),_.play().catch(e=>{console.error("Audio play error:",e),x()}),g._wavFileHandler&&!f){if(!g._wavFileHandler._initialized){console.log("Applying enhanced lip sync"),g._wavFileHandler._initialized=!0;let e=g._wavFileHandler.update.bind(g._wavFileHandler);g._wavFileHandler.update=function(t){let i=e(t);return this._lastRms=Math.min(2,2*this._lastRms),i}}t.current!==_||f?console.warn("WavFileHandler start skipped - audio was stopped or cleaned up"):g._wavFileHandler.start(r)}}),_.addEventListener("ended",()=>{f||(console.log("Audio playback completed"),x())}),_.addEventListener("error",e=>{var i,r,s,a;if(t.current!==_||f)return void console.log("Ignoring error from stopped/cleaned audio");console.error("Audio playback error:",e);let n=e.target;switch(console.error("Audio error code:",null==(i=n.error)?void 0:i.code),console.error("Audio error message:",null==(r=n.error)?void 0:r.message),console.error("Audio src:",(null==(s=n.src)?void 0:s.substring(0,50))+"..."),console.error("Audio readyState:",n.readyState),console.error("Audio networkState:",n.networkState),null==(a=n.error)?void 0:a.code){case 1:console.error("Audio playback was aborted");break;case 2:console.error("Network error occurred while loading audio");break;case 3:console.error("Audio decoding error - invalid format");break;case 4:console.error("Audio source not supported or empty");break;default:console.error("Unknown audio error")}x()}),r&&r.length>22&&"data:audio/wav;base64,"!==r&&!r.endsWith("base64,"))console.log("Setting audio source, data URL length:",r.length),_.src=r,_.load();else{console.error("Cannot set audio source: invalid or empty audioDataUrl:",(null==r?void 0:r.substring(0,50))+"..."),x();return}}else a()}catch(e){console.error("Audio playback setup error:",e),t.current=null,i.current=null,a()}})},stopCurrentAudioAndLipSync:r}};var u=i(6339),h=i(8385),d=i(9988);function c(){if(console.log("Initializing Live2D with resourcePath:",o.ResourcesPath),console.log("Model directories:",o.ModelDir),u.VY.getInstance()&&d.V.releaseInstance(),!h.sJ.getInstance()||!u.VY.getInstance().initialize())return void console.error("Failed to initialize Live2D");if(u.VY.getInstance().run(),window.getLive2DManager=()=>d.V.getInstance(),!window.getLAppAdapter){console.log("Setting up getLAppAdapter function");let{LAppAdapter:e}=i(6563);window.getLAppAdapter=()=>e.getInstance()}}window.addEventListener("beforeunload",()=>u.VY.releaseInstance(),{passive:!0}),window.addEventListener("resize",()=>{"auto"===o.CanvasSize&&u.VY.getInstance().onResize()},{passive:!0}),window.initializeLive2D=c;let g=(0,s.memo)(()=>{let{modelInfo:e}=(0,a.w)(),t=(0,s.useRef)(null),{canvasRef:i}=(e=>{let{containerRef:t,modelInfo:i,showSidebar:r}=e,a=(0,s.useRef)(null),n=(0,s.useRef)(null),o=(0,s.useRef)(!1),l=(null==i?void 0:i.kScale)||1,h=(0,s.useRef)(l),c=(0,s.useRef)(l),g=(0,s.useRef)(null),m=(0,s.useRef)(!1),_=(0,s.useRef)(!1),p=(0,s.useRef)({width:0,height:0}),f=(0,s.useRef)(r);(0,s.useEffect)(()=>{let e=(null==i?void 0:i.kScale)||1;h.current=e,c.current=e,_.current=!1,g.current&&(cancelAnimationFrame(g.current),m.current=!1);let t=requestAnimationFrame(()=>{v()});return()=>cancelAnimationFrame(t)},[null==i?void 0:i.url,null==i?void 0:i.kScale]);let x=(0,s.useCallback)(()=>{let e=Math.max(.1,Math.min(5,c.current)),t=h.current,i=t+(e-t)*.3;(e=>{try{let t=d.V.getInstance();if(!t)return;let i=t.getModel(0);if(!i)return;i._modelMatrix.scale(e,e)}catch(e){console.debug("Model not ready for scaling yet")}})(i),h.current=i,g.current=requestAnimationFrame(x)},[]),y=(0,s.useCallback)(e=>{if(e.preventDefault(),!(null==i?void 0:i.scrollToResize))return;let t=e.deltaY>0?-1:1;c.current=Math.max(.1,Math.min(5,h.current+.03*t)),m.current||(m.current=!0,g.current=requestAnimationFrame(x))},[null==i?void 0:i.scrollToResize,x]),b=(0,s.useCallback)(()=>{n.current&&(o.current=!0,null!==a.current&&(cancelAnimationFrame(a.current),a.current=null))},[]),v=(0,s.useCallback)(()=>{let e=n.current;if(e){o.current||b();try{var i;let{width:s,height:a}=(null==(i=t.current)?void 0:i.getBoundingClientRect())||{width:0,height:0};s>0&&a>0&&(s*=.85,a*=.85);let n=p.current,l=f.current!==r;if(!(Math.abs(n.width-s)>1||Math.abs(n.height-a)>1||l)&&_.current){o.current=!1;return}if(p.current={width:s,height:a},f.current=r,0===s||0===a){console.warn("[Resize] Width or Height is zero, skipping canvas/delegate update."),o.current=!1;return}let h=window.devicePixelRatio||1;e.width=Math.round(s*h),e.height=Math.round(a*h),e.style.width="".concat(s,"px"),e.style.height="".concat(a,"px");let d=u.VY.getInstance();d?d.onResize():console.warn("[Resize] LAppDelegate instance not found."),o.current=!1}catch(e){o.current=!1}}},[t,null==i?void 0:i.kScale,null==i?void 0:i.initialXshift,null==i?void 0:i.initialYshift,r,b,n]);return(0,s.useEffect)(()=>{f.current!==r&&(null!==a.current&&cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{v(),a.current=null}))},[r,v]),(0,s.useEffect)(()=>{let e=n.current;if(e)return e.addEventListener("wheel",y,{passive:!1}),()=>{e.removeEventListener("wheel",y)}},[y,n]),(0,s.useEffect)(()=>()=>{g.current&&(cancelAnimationFrame(g.current),g.current=void 0),null!==a.current&&(cancelAnimationFrame(a.current),a.current=null)},[]),(0,s.useEffect)(()=>{let e=t.current;if(!e)return;null!==a.current&&cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{v(),a.current=null});let i=new ResizeObserver(()=>{o.current||(null!==a.current&&cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{v(),a.current=null}))});return i.observe(e),()=>{null!==a.current&&(cancelAnimationFrame(a.current),a.current=null),i.disconnect()}},[t,v]),(0,s.useEffect)(()=>{let e=()=>{o.current||(null!==a.current&&cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{v(),a.current=null}))};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),null!==a.current&&(cancelAnimationFrame(a.current),a.current=null)}},[v]),{canvasRef:n,handleResize:v}})({containerRef:t,modelInfo:e,showSidebar:!1});return(e=>{let{modelInfo:t,canvasRef:i}=e,[r,a]=(0,s.useState)(!1),[n,l]=(0,s.useState)({x:0,y:0});(0,s.useRef)({x:0,y:0}),(0,s.useRef)({x:0,y:0});let u=(0,s.useRef)({x:0,y:0}),h=(0,s.useRef)(null);(0,s.useRef)(0),(0,s.useRef)({x:0,y:0});let d=(0,s.useRef)(!1);(0,s.useEffect)(()=>{var e,i;let r=null==t?void 0:t.url,s=null==(e=window.LAppDefine)?void 0:e.CurrentKScale,a=(null==t?void 0:t.kScale)!==void 0?Number(t.kScale):void 0;if(r&&(r!==h.current||void 0!==s&&void 0!==a&&s!==a)){h.current=r;try{let{baseUrl:e,modelDir:s,modelFileName:a}=function(e){try{let t=new URL(e),{pathname:i}=t,r=i.lastIndexOf("/");if(-1===r)throw Error("Invalid model URL format");let s=i.substring(r+1).replace(".model3.json",""),a=i.lastIndexOf("/",r-1);if(-1===a)throw Error("Invalid model URL format");let n=i.substring(a+1,r);return{baseUrl:"".concat(t.protocol,"//").concat(t.host).concat(i.substring(0,a+1)),modelDir:n,modelFileName:s}}catch(e){throw console.error("Error parsing model URL:",e),e}}(r);e&&s&&((0,o.updateModelConfig)(e,s,a,Number(t.kScale)),(null==(i=window.LAppLive2DManager)?void 0:i.releaseInstance)&&window.LAppLive2DManager.releaseInstance(),c())}catch(e){console.error("Error processing model URL:",e)}}},[null==t?void 0:t.url,null==t?void 0:t.kScale]);let g=(0,s.useCallback)(()=>{var e,t;let i=null==(e=(t=window).getLAppAdapter)?void 0:e.call(t);if(i){let e=i.getModel();if(e&&e._modelMatrix){let t=e._modelMatrix.getArray();return{x:t[12],y:t[13]}}}return{x:0,y:0}},[]);(0,s.useCallback)((e,t)=>{var i,r;let s=null==(i=(r=window).getLAppAdapter)?void 0:i.call(r);if(s){let i=s.getModel();if(i&&i._modelMatrix){let r=[...i._modelMatrix.getArray()];r[12]=e,r[13]=t,i._modelMatrix.setMatrix(r),u.current={x:e,y:t}}}},[]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{let e=g();u.current=e,l(e)},500);return()=>clearTimeout(e)},[null==t?void 0:t.url,g]);let m=(0,s.useCallback)(()=>{let e=document.getElementById("canvas");if(!e)return{width:1,height:1,scale:1};let{width:t}=e,{height:i}=e,r=t/e.clientWidth;return{width:t,height:i,scale:r}},[]);(0,s.useCallback)((e,t)=>{let{width:i,height:r,scale:s}=m();return{x:e*s/i*2-1,y:-(t*s/r*2)+1}},[m]),(0,s.useCallback)(e=>{},[]),(0,s.useCallback)(e=>{},[]),(0,s.useCallback)(e=>{r&&a(!1),d.current&&(d.current=!1)},[r]),(0,s.useCallback)(e=>{r&&(console.log("[Drag] Mouse leave - stopping drag"),a(!1)),d.current&&(d.current=!1)},[r])})({modelInfo:e,canvasRef:i}),l(),(0,r.jsx)("div",{ref:t,id:"live2d-internal-wrapper",style:{width:"100%",height:"100%",pointerEvents:"auto",overflow:"hidden",position:"relative"},onContextMenu:e=>{e.preventDefault(),console.log("[ContextMenu] Right-click detected")},children:(0,r.jsx)("canvas",{id:"canvas",ref:i,style:{width:"100%",height:"100%",pointerEvents:"auto",display:"block"}})})});var m=i(6149);let _=(0,s.forwardRef)((e,t)=>{let{src:i,className:a="",isSessionReady:n=!1,onCurrentTimeChange:o}=e,l=(0,s.useRef)(null),[u,h]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!1),g=(0,s.useRef)(null);(0,s.useImperativeHandle)(t,()=>({pause:()=>{l.current&&(l.current.pause(),p(e=>({...e,playing:!1})))},resume:()=>{l.current&&n&&(l.current.play(),p(e=>({...e,playing:!0})))},seek:e=>{l.current&&(l.current.currentTime=e)},getCurrentTime:()=>{var e;return(null==(e=l.current)?void 0:e.currentTime)||0},getDuration:()=>{var e;return(null==(e=l.current)?void 0:e.duration)||0},showPauseOverlay:()=>{h(!0)},hidePauseOverlay:()=>{h(!1)},showSpeakingOverlay:()=>{c(!0)},hideSpeakingOverlay:()=>{c(!1)},animateSeek:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;if(!l.current)return;let i=l.current.currentTime,r=Date.now();return g.current&&cancelAnimationFrame(g.current),new Promise(s=>{let a=()=>{let n=Math.min((Date.now()-r)/t,1),o=i+(e-i)*(n<.5?2*n*n:-1+(4-2*n)*n);if(l.current){l.current.currentTime=o;let e=l.current.duration||0;e>0&&p(t=>({...t,played:o/e,playedSeconds:o}))}n<1?g.current=requestAnimationFrame(a):(g.current=null,s())};a()})},setVolume:e=>{let t=Math.max(0,Math.min(1,e));p(e=>({...e,volume:t})),console.log("Video volume set to: ".concat(t))},getVolume:()=>_.volume}),[n]);let[_,p]=(0,s.useState)({src:i||void 0,pip:!1,playing:!1,controls:!0,light:!1,volume:1,muted:!1,played:0,loaded:0,duration:0,playbackRate:1,loop:!1,seeking:!1,loadedSeconds:0,playedSeconds:0}),f=(0,s.useCallback)(e=>{e&&(l.current=e,console.log(e))},[]);return i?(0,r.jsx)("div",{className:"".concat(a," bg-white rounded-lg shadow-lg overflow-hidden"),children:(0,r.jsxs)("div",{className:"relative bg-black",style:{aspectRatio:"16/9"},children:[(0,r.jsx)(m.A,{ref:f,className:"react-player",style:{width:"100%",height:"100%",aspectRatio:"16/9"},src:i,pip:_.pip,playing:_.playing&&n,controls:_.controls,light:_.light,loop:_.loop,playbackRate:_.playbackRate,volume:_.volume,muted:_.muted,onLoadStart:()=>console.log("onLoadStart"),onPlay:()=>{console.log("onPlay"),p(e=>({...e,playing:!0}))},onPause:()=>{console.log("onPause"),p(e=>({...e,playing:!1}))},onSeeking:e=>console.log("onSeeking",e),onSeeked:e=>console.log("onSeeked",e),onEnded:()=>{console.log("onEnded"),p(e=>({...e,playing:e.loop}))},onError:e=>console.log("onError",e),onTimeUpdate:()=>{let e=l.current;e&&!_.seeking&&(console.log("onTimeUpdate",e.currentTime),e.duration&&(null==o||o(e.currentTime),p(t=>({...t,playedSeconds:e.currentTime,played:e.currentTime/e.duration}))))},onProgress:()=>{var e;let t=l.current;t&&!_.seeking&&(null==(e=t.buffered)?void 0:e.length)&&(console.log("onProgress"),p(e=>{var i,r,s,a;return{...e,loadedSeconds:null==(r=t.buffered)?void 0:r.end((null==(i=t.buffered)?void 0:i.length)-1),loaded:(null==(a=t.buffered)?void 0:a.end((null==(s=t.buffered)?void 0:s.length)-1))/t.duration}}))},onDurationChange:()=>{let e=l.current;e&&(console.log("onDurationChange",e.duration),p(t=>({...t,duration:e.duration})))}}),!n&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-75 flex items-center justify-center z-10",children:(0,r.jsxs)("div",{className:"text-center text-white",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-sm text-gray-300 mt-2",children:"Connecting to AI companion..."})]})}),u&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-20 transition-all duration-300",children:(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)("div",{className:"bg-white bg-opacity-20 rounded-full p-8 backdrop-blur-md animate-pulse",children:(0,r.jsx)("svg",{className:"w-16 h-16 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})})})})}),d&&(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent flex items-end justify-center z-20 transition-all duration-300",children:(0,r.jsxs)("div",{className:"relative pb-16 w-full max-w-2xl px-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-4",children:[(0,r.jsx)("div",{className:"bg-white rounded-full p-1",children:(0,r.jsxs)("svg",{className:"w-6 h-6 text-blue-600 animate-pulse",fill:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),(0,r.jsx)("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})}),(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsx)("div",{className:"w-1 h-4 bg-white rounded-full animate-pulse",style:{animationDelay:"0ms"}}),(0,r.jsx)("div",{className:"w-1 h-6 bg-white rounded-full animate-pulse",style:{animationDelay:"150ms"}}),(0,r.jsx)("div",{className:"w-1 h-5 bg-white rounded-full animate-pulse",style:{animationDelay:"300ms"}}),(0,r.jsx)("div",{className:"w-1 h-7 bg-white rounded-full animate-pulse",style:{animationDelay:"450ms"}}),(0,r.jsx)("div",{className:"w-1 h-4 bg-white rounded-full animate-pulse",style:{animationDelay:"600ms"}})]})]}),(0,r.jsx)("p",{className:"text-white text-center text-sm animate-fade-in",children:"AI is speaking..."})]})})]})}):(0,r.jsx)("div",{className:"".concat(a," bg-gray-100 rounded-lg p-8 text-center"),children:(0,r.jsx)("p",{className:"text-gray-500",children:"No video selected"})})});_.displayName="VideoPlayerWithControls";let p=e=>{let{initialPosition:t={x:0,y:0},onPositionChange:i,handleRef:r}=e,[a,n]=(0,s.useState)(!1),o=(0,s.useRef)(t),l=(0,s.useRef)({x:0,y:0}),u=(0,s.useCallback)(e=>{let t=e.target;"INPUT"===t.tagName||"TEXTAREA"===t.tagName||"BUTTON"===t.tagName||t.isContentEditable||(n(!0),l.current={x:e.clientX-o.current.x,y:e.clientY-o.current.y},e.preventDefault(),e.stopPropagation())},[]),h=(0,s.useCallback)(e=>{if(!a)return;let t=e.clientX-l.current.x,r=e.clientY-l.current.y;o.current={x:t,y:r},i&&i({x:t,y:r})},[a,i]),d=(0,s.useCallback)(()=>{n(!1)},[]);return{isDragging:a,listeners:{onMouseDown:u,onMouseMove:h,onMouseUp:d,onMouseLeave:d}}};var f=i(424);let x=(0,s.createContext)(void 0);function y(){let e=(0,s.useContext)(x);if(void 0===e)throw Error("useWebSocketContext must be used within a WebSocketProvider");return e}let b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{threshold:t=30,sendMessage:i}=e,[r,a]=(0,s.useState)([]),[n,o]=(0,s.useState)(new Set),[l,u]=(0,s.useState)(!1),[h,d]=(0,s.useState)(!1),c=r.findIndex(e=>!n.has(e.id)),g=r.length>0?Math.max(...r.map(e=>e.trigger_timestamp)):0,m=(0,s.useCallback)(e=>{0!==e.length&&(a(t=>{let i=new Set(t.map(e=>e.id)),r=e.filter(e=>!i.has(e.id));if(0===r.length)return console.log("All actions already exist in queue, skipping duplicates"),t;let s=[...t,...r].sort((e,t)=>{var i,r;if(e.trigger_timestamp!==t.trigger_timestamp)return e.trigger_timestamp-t.trigger_timestamp;let s={EXPRESSION:0,PAUSE:1,SEEK:2,REPLAY_SEGMENT:3,SPEAK:4,END_REACTION:5};return(null!=(i=s[e.action_type])?i:99)-(null!=(r=s[t.action_type])?r:99)});return console.log("Added ".concat(r.length," new actions to queue (").concat(e.length-r.length," duplicates skipped). New queue size: ").concat(s.length)),s}),d(!1))},[]),_=(0,s.useCallback)(e=>{if(0===e.length)return;let t=new Set(e);a(i=>{let r=i.filter(e=>!t.has(e.id));return console.log("Removed ".concat(e.length," actions from queue. New queue size: ").concat(r.length)),r})},[]),p=(0,s.useCallback)(()=>{a([]),o(new Set),u(!1),d(!1)},[]),f=(0,s.useCallback)(()=>{o(new Set),u(!1),d(!1)},[]),x=(0,s.useCallback)(e=>r.filter(t=>!n.has(t.id)&&t.trigger_timestamp<=e),[r,n]),y=(0,s.useCallback)(e=>{o(t=>{let i=new Set(t);return i.add(e),i})},[]),b=(0,s.useCallback)(e=>{if(h||!i)return;let r=g-e;r<=t&&r>0&&(console.log("Requesting more actions: current=".concat(e,", latest=").concat(g,", threshold=").concat(t)),d(!0),i({type:"trigger-load-next"}))},[g,t,h,i]);return{actionQueue:r,currentActionIndex:c,isExecuting:l,latestTriggerTime:g,addActions:m,clearQueue:p,resetQueue:f,getNextActions:x,removeActions:_,markActionExecuted:y,checkThreshold:b}};var v=i(7817);let S=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{videoPlayerControl:t,onActionExecuted:i,onExecutionError:r}=e,{addAudioTask:o,stopCurrentAudioAndLipSync:u}=l(),{setExpression:h}=n(),{modelInfo:d}=(0,a.w)(),{addMessage:c}=(0,v.Y)(),{generalSettings:g}=(0,f.t)(),[m,_]=(0,s.useState)(!1),p=(0,s.useRef)(1),x=(0,s.useCallback)(async e=>{if(!e.emotion_expressions)return void console.warn("EXPRESSION action missing emotion_expressions");console.log("Setting Live2D expression: ".concat(e.emotion_expressions," (").concat(e.comment,")"));try{var t,i;let r=null==(t=(i=window).getLAppAdapter)?void 0:t.call(i);if(!r)return void console.error("Live2D adapter not available for expression");let s=null==d?void 0:d.emotionMap;if(!s)return void console.warn("No emotion map available in model info");let a=s[e.emotion_expressions];if(void 0===a)return void console.warn('Emotion "'.concat(e.emotion_expressions,'" not found in emotion map'));h(a,r,"Set expression to: ".concat(e.emotion_expressions," (index: ").concat(a,")")),console.log("Successfully set Live2D expression: ".concat(e.emotion_expressions))}catch(e){console.error("Failed to execute expression action:",e)}},[h,d]),y=(0,s.useCallback)(async e=>{if(!t)return void console.warn("No video player control available for PAUSE action");let i=e.duration_seconds||1;console.log("Pausing video for ".concat(i,"s for action: ").concat(e.comment)),t.showPauseOverlay(),t.pause(),await new Promise(e=>setTimeout(e,1e3*i)),t.hidePauseOverlay(),t.resume(),console.log("Resumed video after ".concat(i,"s pause"))},[t]),b=(0,s.useCallback)(async e=>{if(!e.text)return void console.warn("SPEAK action missing text content");let i=!1!==e.pause_video;console.log('AI speaking: "'.concat(e.text,'" (pause_video: ').concat(i,")")),c({type:"ai",content:e.text}),u();let r=!1,s=0;if(t&&g.reduceVideoVolumeOnSpeech){p.current=t.getVolume();let e=p.current*(g.videoVolumeReductionPercent/100);t.setVolume(e),console.log("Reduced video volume from ".concat(p.current," to ").concat(e," (").concat(g.videoVolumeReductionPercent,"%)"))}if(t&&t.showSpeakingOverlay(),i&&t&&(s=t.getCurrentTime(),r=!0,t.pause()),e.audio&&e.audio.trim().length>10)try{console.log("Playing AI audio with ".concat(e.audio.length," chars of base64 data")),await o({audioBase64:e.audio,volumes:[],sliceLength:.1,expressions:null}),console.log("Audio playback with lip sync completed")}catch(t){console.error("Failed to play audio with lip sync:",t),console.log('Fallback text display: "'.concat(e.text,'"')),await new Promise(e=>setTimeout(e,2e3))}else{var a;console.log('Text-only speech: "'.concat(e.text,'" (no audio data: ').concat((null==(a=e.audio)?void 0:a.length)||0," chars)")),await new Promise(e=>setTimeout(e,2e3))}if(t&&t.hideSpeakingOverlay(),t&&g.reduceVideoVolumeOnSpeech&&(t.setVolume(p.current),console.log("Restored video volume to ".concat(p.current))),i&&t&&r){let i=s+(e.duration_seconds||0),r=t.getCurrentTime();Math.abs(r-i)>.1&&console.log("Video time mismatch after speech. Expected: ".concat(i,"s, Actual: ").concat(r,"s")),console.log("Resuming video playback after speech"),t.resume()}},[o,u,t,c,g]),S=(0,s.useCallback)(async e=>{if(!t)return void console.warn("No video player control available for SEEK action");if(void 0===e.target_timestamp)return void console.warn("SEEK action missing target_timestamp");let i=t.getDuration(),r=Math.max(0,Math.min(e.target_timestamp,i)),s=t.getCurrentTime(),a=Math.max(500,Math.min(2e3,30*Math.abs(r-s)));console.log("Animating seek from ".concat(s,"s to ").concat(r,"s over ").concat(a,"ms")),await t.animateSeek(r,a),"RESUME_PLAYBACK"===(e.post_seek_behavior||"STAY_PAUSED")?(console.log("Resuming playback after seek"),t.resume()):console.log("Staying paused after seek")},[t]),C=(0,s.useCallback)(async e=>{if(!t)return void console.warn("No video player control available for REPLAY_SEGMENT action");if(void 0===e.start_timestamp||void 0===e.end_timestamp)return void console.warn("REPLAY_SEGMENT action missing start_timestamp or end_timestamp");let i=t.getDuration(),r=Math.max(0,Math.min(e.start_timestamp,i)),s=Math.max(r,Math.min(e.end_timestamp,i)),a=t.getCurrentTime();console.log("Replaying segment from ".concat(r,"s to ").concat(s,"s (original position: ").concat(a,"s)"));let n=Math.max(500,Math.min(1500,30*Math.abs(a-r)));await t.animateSeek(r,n),t.resume();let o=s-r;if(await new Promise(e=>setTimeout(e,1e3*o)),"RESUME_FROM_ORIGINAL"===(e.post_replay_behavior||"RESUME_FROM_ORIGINAL")){console.log("Returning to original position: ".concat(a,"s"));let e=Math.max(500,Math.min(1500,30*Math.abs(s-a)));await t.animateSeek(a,e),t.resume()}else console.log("Staying at end of segment: ".concat(s,"s")),await t.animateSeek(s,300),t.pause()},[t]),w=(0,s.useCallback)(async e=>{console.log("End reaction reached: ".concat(e.comment)),u(),t&&t.pause(),console.log("Reaction sequence ended, waiting for next trigger")},[t,u]),M=(0,s.useCallback)(async e=>{console.log("Executing action: ".concat(e.action_type," at ").concat(e.trigger_timestamp,"s"),e);try{switch(e.action_type){case"PAUSE":await y(e);break;case"SPEAK":await b(e);break;case"SEEK":await S(e);break;case"REPLAY_SEGMENT":await C(e);break;case"END_REACTION":await w(e);break;case"EXPRESSION":await x(e);break;default:console.warn("Unknown action type: ".concat(e.action_type))}console.log("Successfully executed action: ".concat(e.id)),null==i||i(e)}catch(t){console.error("Failed to execute action ".concat(e.id,":"),t),null==r||r(t,e),null==i||i(e)}},[t,i,r,x,y,b,S,C,w]),P=(0,s.useCallback)(async e=>{if(0!==e.length){_(!0);try{console.log("Executing ".concat(e.length," actions in sequence"));let t=[...e].sort((e,t)=>{var i,r;let s={EXPRESSION:0,PAUSE:1,SEEK:2,REPLAY_SEGMENT:3,SPEAK:4,END_REACTION:5},a=null!=(i=s[e.action_type])?i:99,n=null!=(r=s[t.action_type])?r:99;return a-n});for(let e of t)await M(e),t.indexOf(e)<t.length-1&&await new Promise(e=>setTimeout(e,10))}finally{_(!1)}}},[M]);return{executeAction:M,executeActions:P,isExecuting:m}},C=e=>{let{videoSrc:t,onUrlSubmit:i,className:a="",position:n,onPositionChange:o,sessionConfig:l,onVideoTimeUpdate:u}=e,[h,d]=(0,s.useState)(t||""),[c,g]=(0,s.useState)(t||"");(0,s.useEffect)(()=>{t&&(g(t),d(t))},[t]);let[m,x]=(0,s.useState)(0),v=(0,s.useRef)(null),C=(0,s.useRef)(null),w=(0,s.useRef)(null),M=(0,s.useRef)(new Set),{generalSettings:P}=(0,f.t)(),{listeners:B}=p({initialPosition:n,onPositionChange:o,handleRef:C}),{status:I,sessionId:E,error:V,createSession:R,resetSession:k}=(()=>{let{generalSettings:e}=(0,f.t)(),[t,i]=(0,s.useState)("idle"),[r,a]=(0,s.useState)(null),[n,o]=(0,s.useState)(null);return{status:t,sessionId:r,error:n,createSession:(0,s.useCallback)(async t=>{try{i("creating"),o(null),console.log("Creating session with request:",t),console.log("Request JSON:",JSON.stringify(t,null,2));let n=await fetch("".concat(e.baseUrl,"/api/v1/sessions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)if(422===n.status){var r,s;let e=await n.json();console.log("422 Error details:",e);let t={error:(null==(r=e.detail)?void 0:r.error)||"VALIDATION_ERROR",message:(null==(s=e.detail)?void 0:s.message)||JSON.stringify(e)};return o(t),i("error"),null}else{let e=await n.text();console.log("".concat(n.status," Error:"),e);let t={error:"HTTP_ERROR",message:"Server responded with status ".concat(n.status,": ").concat(e)};return o(t),i("error"),null}let l=await n.json();if(!l.session_id)return o({error:"INVALID_RESPONSE",message:"Server response missing session_id"}),i("error"),null;return a(l.session_id),i("created"),console.log("Session created successfully:",l.session_id),l.session_id}catch(e){return console.error("Failed to create session:",e),o({error:"NETWORK_ERROR",message:e instanceof Error?e.message:"Network error occurred"}),i("error"),null}},[]),resetSession:(0,s.useCallback)(()=>{i("idle"),a(null),o(null)},[])}})(),{status:T,sendMessage:F,error:A,connect:L,sessionStatus:D,processingError:N,isSessionReady:j,receivedActions:O,clearReceivedActions:z,clearError:U,resetHandler:X}=y(),{actionQueue:Y,currentActionIndex:G,isExecuting:H,latestTriggerTime:W,addActions:q,clearQueue:J,resetQueue:K,getNextActions:Z,removeActions:Q,markActionExecuted:$,checkThreshold:ee}=b({threshold:30,sendMessage:F}),{executeActions:et,isExecuting:ei}=S({videoPlayerControl:{pause:()=>{var e;(null==(e=w.current)?void 0:e.pause)&&w.current.pause()},resume:()=>{var e;(null==(e=w.current)?void 0:e.resume)&&w.current.resume()},seek:e=>{var t;(null==(t=w.current)?void 0:t.seek)&&w.current.seek(e)},getCurrentTime:()=>{var e;return(null==(e=w.current)?void 0:e.getCurrentTime())||0},getDuration:()=>{var e;return(null==(e=w.current)?void 0:e.getDuration())||0},showPauseOverlay:()=>{var e;(null==(e=w.current)?void 0:e.showPauseOverlay)&&w.current.showPauseOverlay()},hidePauseOverlay:()=>{var e;(null==(e=w.current)?void 0:e.hidePauseOverlay)&&w.current.hidePauseOverlay()},showSpeakingOverlay:()=>{var e;(null==(e=w.current)?void 0:e.showSpeakingOverlay)&&w.current.showSpeakingOverlay()},hideSpeakingOverlay:()=>{var e;(null==(e=w.current)?void 0:e.hideSpeakingOverlay)&&w.current.hideSpeakingOverlay()},animateSeek:async(e,t)=>{var i;if(null==(i=w.current)?void 0:i.animateSeek)return w.current.animateSeek(e,t)},setVolume:e=>{var t;(null==(t=w.current)?void 0:t.setVolume)&&w.current.setVolume(e)},getVolume:()=>{var e;return(null==(e=w.current)?void 0:e.getVolume())||1}},onActionExecuted:e=>{$(e.id),M.current.delete(e.id),console.log("Action executed and marked: ".concat(e.id))},onExecutionError:(e,t)=>{console.error("Action execution failed for ".concat(t.id,":"),e),M.current.delete(t.id)}}),er=(0,s.useCallback)(e=>{e.preventDefault(),h.trim()&&(null==i||i(h))},[h,i]);(0,s.useEffect)(()=>{(async()=>{if(t&&l&&0!==Object.keys(l).length)try{let e={video_url:t,start_time:l.startTime||0,end_time:l.endTime,text:l.userRequirements||"You are a helpful AI companion watching videos with the user.",character_id:"placeholder",user_id:"placeholder"};console.log("Creating session for URL:",t);let i=await R(e);i&&(console.log("Session created successfully:",i),setTimeout(()=>{L(i)},100))}catch(e){console.error("Failed to create session:",e)}})()},[t,l,R,L]),(0,s.useEffect)(()=>{"error"===I&&V&&(console.error("Session creation failed:",V),alert("Failed to create session: ".concat(V.message)))},[I,V]),(0,s.useEffect)(()=>{N&&(console.error("Video processing error:",N),alert("Video processing failed: ".concat(N.message)))},[N]),(0,s.useEffect)(()=>{console.log("Session states:",{sessionCreateStatus:I,sessionId:E,wsStatus:T,isSessionReady:j,currentUrl:c||"none",videoSrc:t||"none"})},[I,E,T,j,c,t]);let es=(0,s.useCallback)(e=>{let t=Z(e);if(t.length>0){let i=t.filter(e=>!M.current.has(e.id)||(console.log("Action ".concat(e.id," is already executing, skipping")),!1));i.length>0&&(console.log("Found ".concat(i.length," actions to execute at time ").concat(e,"s")),i.forEach(e=>{M.current.add(e.id)}),Q(i.map(e=>e.id)),et(i))}},[Z,Q,et]);(0,s.useEffect)(()=>{O.length>0&&(console.log("Adding ".concat(O.length," actions to queue")),q(O),z(),es(m))},[O,q,z,es,m]),(0,s.useEffect)(()=>{"creating"===I&&(J(),X())},[I,J,X]);let ea=(0,s.useCallback)(e=>{x(e),null==u||u(e),ee(e),es(e)},[ee,es,u]),en=e=>e&&(e.includes("youtube.com")||e.includes("youtu.be")||e.includes("bilibili.com")||e.includes(".mp4")||e.includes(".webm")||e.includes(".ogg"));return(0,r.jsxs)("div",{className:"".concat(a," bg-white rounded-lg shadow-2xl overflow-hidden border border-gray-200"),style:{position:"absolute",left:n.x,top:n.y,zIndex:10},...B,children:[(0,r.jsxs)("div",{ref:C,className:"bg-[#f1f3f4] border-b border-[#dadce0] cursor-move",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-2 py-1.5 h-9",children:[(0,r.jsx)("div",{className:"flex items-center space-x-2",children:(0,r.jsxs)("div",{className:"flex space-x-1.5 ml-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-[#ff5f56] rounded-full hover:bg-[#ff6259] transition-colors"}),(0,r.jsx)("div",{className:"w-3 h-3 bg-[#ffbd2e] rounded-full hover:bg-[#ffbe33] transition-colors"}),(0,r.jsx)("div",{className:"w-3 h-3 bg-[#27ca3f] rounded-full hover:bg-[#29cc42] transition-colors"})]})}),(0,r.jsx)("div",{className:"text-[13px] text-[#5f6368] font-normal tracking-[0.25px]",children:"Chrome"}),(0,r.jsx)("div",{className:"w-16"})]}),(0,r.jsxs)("div",{className:"flex items-end px-2 h-8",children:[(0,r.jsxs)("div",{className:"relative bg-white h-8 min-w-[200px] max-w-[240px] flex items-center px-4 mr-1",style:{clipPath:"polygon(8px 0%, calc(100% - 8px) 0%, 100% 100%, 0% 100%)",borderTop:"1px solid #dadce0",borderLeft:"1px solid #dadce0",borderRight:"1px solid #dadce0"},children:[(0,r.jsx)("svg",{className:"w-4 h-4 text-[#5f6368] mr-2 flex-shrink-0",viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),(0,r.jsx)("span",{className:"text-[13px] text-[#202124] truncate flex-1 font-normal",children:en(c)?"Video Player":"New Tab"}),(0,r.jsx)("button",{className:"w-4 h-4 ml-2 rounded-full hover:bg-[#f1f3f4] flex items-center justify-center flex-shrink-0",children:(0,r.jsx)("svg",{className:"w-3 h-3 text-[#5f6368]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsx)("button",{className:"w-7 h-7 ml-1 rounded-t-md hover:bg-[#e8eaed] flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-4 h-4 text-[#5f6368]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),(0,r.jsx)("div",{className:"flex-1"})]}),(0,r.jsx)("div",{className:"px-3 pb-2",children:(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("button",{className:"w-8 h-8 rounded-full hover:bg-[#e8eaed] flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)("svg",{className:"w-4 h-4 text-[#5f6368]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,r.jsx)("button",{className:"w-8 h-8 rounded-full hover:bg-[#e8eaed] flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",children:(0,r.jsx)("svg",{className:"w-4 h-4 text-[#5f6368]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,r.jsx)("button",{className:"w-8 h-8 rounded-full hover:bg-[#e8eaed] flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-4 h-4 text-[#5f6368]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),(0,r.jsx)("form",{onSubmit:er,className:"flex-1 mx-2",children:(0,r.jsxs)("div",{className:"flex items-center bg-white border border-[#dadce0] rounded-full px-4 py-1.5 hover:shadow-sm focus-within:shadow-md focus-within:border-[#4285f4] transition-all h-9 group",children:[(0,r.jsx)("svg",{className:"w-4 h-4 text-[#34a853] mr-2 flex-shrink-0",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M18,8a2,2 0 0,1 2,2v8a2,2 0 0,1 -2,2H6a2,2 0 0,1 -2,-2V10a2,2 0 0,1 2,-2h1V6a5,5 0 0,1 10,0v2h1m-6,9a2,2 0 0,1 -2,-2a2,2 0 0,1 2,-2a2,2 0 0,1 2,2a2,2 0 0,1 -2,2z"})}),(0,r.jsx)("input",{ref:v,type:"text",value:h,onChange:e=>d(e.target.value),onKeyPress:e=>{"Enter"===e.key&&er(e)},placeholder:"Search Google or type a URL",className:"flex-1 outline-none text-[14px] text-[#202124] placeholder-[#5f6368] font-normal"}),en(h)&&(0,r.jsx)("svg",{className:"w-4 h-4 text-[#1a73e8] ml-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m-6-8h8a2 2 0 012 2v8a2 2 0 01-2 2H8a2 2 0 01-2-2V6a2 2 0 012-2z"})})]})}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)("button",{className:"w-8 h-8 rounded-full hover:bg-[#e8eaed] flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-4 h-4 text-[#5f6368]",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})}),(0,r.jsx)("button",{className:"w-8 h-8 rounded-full bg-[#1a73e8] text-white flex items-center justify-center text-[12px] font-medium",children:"U"}),(0,r.jsx)("button",{className:"w-8 h-8 rounded-full hover:bg-[#e8eaed] flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-4 h-4 text-[#5f6368]",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})})]})]})})]}),(0,r.jsx)("div",{className:"h-[600px] bg-white overflow-hidden",children:en(c)?(0,r.jsx)(_,{ref:w,src:c,className:"w-full h-full",isSessionReady:j,onCurrentTimeChange:ea}):(0,r.jsx)("div",{className:"h-full bg-white flex flex-col items-center justify-center p-8",children:(0,r.jsxs)("div",{className:"text-center space-y-6 w-full -mt-16",children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("svg",{className:"w-64 h-20 mx-auto",viewBox:"0 0 272 92",fill:"none",children:[(0,r.jsx)("path",{d:"M115.75 47.18c0 12.77-9.99 22.18-22.25 22.18s-22.25-9.41-22.25-22.18C71.25 34.32 81.24 25 93.5 25s22.25 9.32 22.25 22.18zm-9.74 0c0-7.98-5.79-13.44-12.51-13.44S80.99 39.2 80.99 47.18c0 7.9 5.79 13.44 12.51 13.44s12.51-5.55 12.51-13.44z",fill:"#EA4335"}),(0,r.jsx)("path",{d:"M163.75 47.18c0 12.77-9.99 22.18-22.25 22.18s-22.25-9.41-22.25-22.18c0-12.85 9.99-22.18 22.25-22.18s22.25 9.32 22.25 22.18zm-9.74 0c0-7.98-5.79-13.44-12.51-13.44s-12.51 5.46-12.51 13.44c0 7.9 5.79 13.44 12.51 13.44s12.51-5.55 12.51-13.44z",fill:"#FBBC05"}),(0,r.jsx)("path",{d:"M209.75 26.34v39.82c0 16.38-9.66 23.07-21.08 23.07-10.75 0-17.22-7.19-19.66-13.07l8.48-3.53c1.51 3.61 5.21 7.87 11.17 7.87 7.31 0 11.84-4.51 11.84-13v-3.19h-.34c-2.18 2.69-6.38 5.04-11.68 5.04-11.09 0-21.25-9.66-21.25-22.09 0-12.52 10.16-22.26 21.25-22.26 5.29 0 9.49 2.35 11.68 4.96h.34v-3.61h9.25zm-8.56 20.92c0-7.81-5.21-13.52-11.84-13.52-6.72 0-12.35 5.71-12.35 13.52 0 7.73 5.63 13.36 12.35 13.36 6.63 0 11.84-5.63 11.84-13.36z",fill:"#34A853"}),(0,r.jsx)("path",{d:"M225 3v65h-9.5V3h9.5z",fill:"#EA4335"}),(0,r.jsx)("path",{d:"M262.02 54.48l7.56 5.04c-2.44 3.61-8.32 9.83-18.48 9.83-12.6 0-22.01-9.74-22.01-22.18 0-13.19 9.49-22.18 20.92-22.18 11.51 0 17.14 9.16 18.98 14.11l1.01 2.52-29.65 12.28c2.27 4.45 5.8 6.72 10.75 6.72 4.96 0 8.4-2.44 10.92-6.14zm-23.27-7.98l19.82-8.23c-1.09-2.77-4.37-4.7-8.23-4.7-4.95 0-11.84 4.37-11.59 12.93z",fill:"#FBBC05"}),(0,r.jsx)("path",{d:"M35.29 41.41V32H67c.31 1.64.47 3.58.47 5.68 0 7.06-1.93 15.79-8.15 22.01-6.05 6.3-13.78 9.66-24.02 9.66C16.32 69.35.36 53.89.36 34.91.36 15.93 16.32.47 35.3.47c10.5 0 17.98 4.12 23.6 9.49l-6.64 6.64c-4.03-3.78-9.49-6.72-16.97-6.72-13.86 0-24.7 11.17-24.7 25.03 0 13.86 10.84 25.03 24.7 25.03 8.99 0 14.11-3.61 17.39-6.89 2.66-2.66 4.41-6.46 5.1-11.65l-22.49.01z",fill:"#4285F4"})]})}),(0,r.jsx)("div",{className:"w-full max-w-xl mx-auto",children:(0,r.jsx)("div",{className:"relative",children:(0,r.jsxs)("div",{className:"flex items-center bg-white border border-[#dfe1e5] rounded-full px-5 py-3 hover:shadow-md focus-within:shadow-md transition-shadow",children:[(0,r.jsx)("svg",{className:"w-4 h-4 text-[#9aa0a6] mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,r.jsx)("input",{type:"text",placeholder:"Search Google or type a URL",className:"flex-1 outline-none text-[16px] text-[#202124] placeholder-[#9aa0a6]"})]})})})]})})})]})};var w=i(8366),M=i(7630),P=i(4333);function B(e){let{message:t}=e;return(0,r.jsx)("div",{className:"mb-3 animate-in slide-in-from-bottom duration-200 hover:bg-white/5 p-2 rounded-lg transition-colors",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(e=>{switch(e){case"ai":return(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-xs font-bold shrink-0",children:"AI"});case"user":return(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white text-xs font-bold shrink-0",children:"U"});case"system":return(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-yellow-500 flex items-center justify-center text-white text-xs font-bold shrink-0",children:"S"});default:return(0,r.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-500 flex items-center justify-center text-white text-xs font-bold shrink-0",children:"?"})}})(t.type),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-baseline gap-2 mb-1",children:[(0,r.jsx)("span",{className:"text-sm font-medium ".concat((e=>{switch(e){case"ai":return"text-blue-300";case"user":return"text-green-300";case"system":return"text-yellow-300";default:return"text-gray-300"}})(t.type)),children:(e=>{switch(e){case"ai":return"AI Companion";case"user":return"You";case"system":return"System";default:return"Unknown"}})(t.type)}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:new Date(t.timestamp).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})})]}),(0,r.jsx)("p",{className:"text-sm leading-relaxed break-words text-gray-200",children:t.content})]})]})})}function I(e){let{onVideoControl:t,videoCurrentTime:i,actionQueue:a,clearQueue:n}=e,{state:o,isRecording:l,toggleRecording:u,error:h,setAudioDataCallback:d}=(0,w.S)(),{sendMessage:c,status:g}=y();return(0,s.useEffect)(()=>{console.log("\uD83C\uDFAF Setting up audio data callback"),d(e=>{if(console.log("\uD83C\uDFB5 Audio data callback triggered!",{audioSize:e.byteLength,wsStatus:g,timestamp:new Date().toISOString()}),"connected"===g){console.log("✅ WebSocket connected - processing audio input..."),t&&(t("pause"),console.log("⏸️ Video paused for user input"));let r=new Uint8Array(e);if(0===e.byteLength)return void console.warn("Empty audio data received, skipping...");let s=btoa(String.fromCharCode.apply(null,Array.from(r)));if(!s||0===s.length)return void console.warn("Failed to generate base64 audio, skipping...");console.log("\uD83D\uDCFC Generated audio data:",e.byteLength,"bytes,",s.length,"base64 chars");let o={id:"user_speak_".concat(Date.now()),action_type:"SPEAK",trigger_timestamp:i||0,comment:"User voice input",audio:s,pause_video:!0},l=a?[...a]:[];c({type:"trigger-conversation",data:{user_action_list:[o],pending_action_list:l}}),n&&n(),console.log("\uD83D\uDCE4 Sent trigger-conversation with user audio input"),console.log("\uD83D\uDCE6 Sent pending actions:",l.length)}else console.warn("❌ WebSocket not connected!",{currentStatus:g,audioSize:e.byteLength,message:"Audio data ready but cannot send - WebSocket not connected"})})},[d,g,c,t,i,a,n]),(0,r.jsx)("div",{className:"relative flex items-center",children:(0,r.jsx)("button",{onClick:u,className:"p-2 rounded-lg transition-all duration-200 hover:scale-105 ".concat(l?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"," flex items-center justify-center"),title:h||("disabled"===o?"Microphone access denied":"error"===o?"Microphone error":l?"Recording - Click to stop":"Click to start recording"),children:l?(0,r.jsx)(M.A,{className:"w-4 h-4"}):(0,r.jsxs)("div",{className:"relative w-4 h-4",children:[(0,r.jsx)(P.A,{className:"w-4 h-4"}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-5 h-0.5 bg-current transform rotate-45"})})]})})})}function E(e){let{className:t="",position:i,onPositionChange:a,videoCurrentTime:n}=e,{messages:o,addMessage:l,isVisible:u}=(0,v.Y)(),[h,d]=(0,s.useState)(""),[c,g]=(0,s.useState)(!0),m=(0,s.useRef)(null),_=(0,s.useRef)(null),{sendMessage:f,status:x,error:S}=y(),{actionQueue:C,clearQueue:w}=b({sendMessage:f}),{listeners:M}=p({initialPosition:i||{x:50,y:100},onPositionChange:a}),P=(0,s.useCallback)(e=>{g("play"===e),console.log("\uD83C\uDFA5 Video ".concat(e,"d"))},[]),E=(0,s.useCallback)(e=>{if(!f)return;P("pause");let t=[...C];f({type:"trigger-conversation",data:{user_action_list:[{id:"user_text_".concat(Date.now()),action_type:"SPEAK",trigger_timestamp:n||0,comment:"User text input",text:e,pause_video:!0}],pending_action_list:t}}),w(),console.log("\uD83D\uDCE4 Sent trigger-conversation with user text input:",e),console.log("\uD83D\uDCE6 Sent pending actions:",t.length)},[f,P,n,C,w]);(0,s.useEffect)(()=>{let e=document.createElement("style");return e.textContent="\n      .chat-scrollbar::-webkit-scrollbar {\n        width: 6px;\n      }\n      .chat-scrollbar::-webkit-scrollbar-track {\n        background: transparent;\n      }\n      .chat-scrollbar::-webkit-scrollbar-thumb {\n        background: rgba(75, 85, 99, 0.5);\n        border-radius: 3px;\n      }\n      .chat-scrollbar::-webkit-scrollbar-thumb:hover {\n        background: rgba(75, 85, 99, 0.7);\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),(0,s.useEffect)(()=>{var e;null==(e=m.current)||e.scrollIntoView({behavior:"smooth"})},[o]);let V=e=>{if(e.preventDefault(),h.trim()){var t;l({type:"user",content:h.trim()}),E(h.trim()),d(""),null==(t=_.current)||t.focus()}};return u?(0,r.jsxs)("div",{className:"\n        fixed flex flex-col\n        w-80 h-96\n        bg-black/70 backdrop-blur-sm\n        border border-gray-600/50\n        rounded-lg overflow-hidden\n        shadow-2xl\n        ".concat(t,"\n      "),style:{left:(null==i?void 0:i.x)||50,top:(null==i?void 0:i.y)||100,zIndex:30},...M,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-black/50 border-b border-gray-600/50 cursor-move",children:[(0,r.jsx)("h3",{className:"text-white font-medium text-sm",children:"Chat"}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("connected"===x?"bg-green-400":"connecting"===x?"bg-yellow-400":"error"===x?"bg-red-400":"bg-gray-500")}),(0,r.jsx)("span",{className:"text-xs text-gray-400 capitalize",children:x})]}),(0,r.jsx)("div",{className:"flex items-center gap-1",children:(0,r.jsxs)("span",{className:"text-xs text-gray-400",children:[o.length," msgs"]})})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto px-2 py-1 chat-scrollbar",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(75, 85, 99, 0.5) transparent"},children:0===o.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 text-sm",children:[(0,r.jsx)("svg",{className:"w-12 h-12 mb-2 opacity-50",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z",clipRule:"evenodd"})}),(0,r.jsx)("p",{children:"No messages yet..."}),(0,r.jsx)("p",{className:"text-xs mt-1 opacity-70",children:"Start a conversation!"})]}):(0,r.jsxs)(r.Fragment,{children:[o.map(e=>(0,r.jsx)(B,{message:e},e.id)),(0,r.jsx)("div",{ref:m})]})}),(0,r.jsxs)("div",{className:"p-3 bg-black/50 border-t border-gray-600/50",children:[(0,r.jsxs)("form",{onSubmit:V,className:"flex gap-2 items-center",children:[(0,r.jsx)("input",{ref:_,type:"text",value:h,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),V(e))},placeholder:"Type a message...",className:"flex-1 px-3 py-2 bg-gray-800/80 border border-gray-600/50 rounded-lg text-white text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent",maxLength:500}),(0,r.jsx)(I,{onVideoControl:P,videoCurrentTime:n,actionQueue:C,clearQueue:w})]}),h.length>400&&(0,r.jsxs)("div",{className:"text-xs text-gray-400 mt-1 text-right",children:[h.length,"/500"]})]})]}):null}let V=e=>{var t,i,a;let{isOpen:n,videoUrl:o,onClose:l,onConfirm:u}=e,[h,d]=(0,s.useState)({startTime:0,endTime:void 0,userRequirements:"",additionalFiles:[]}),c=e=>e.includes("youtube.com")||e.includes("youtu.be")?(0,r.jsx)("div",{className:"w-4 h-4 bg-[#ff0000] rounded-sm flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M21.582 6.186c-.23-1.12-1.11-2.005-2.23-2.23C17.25 3.5 12 3.5 12 3.5s-5.25 0-7.352.456c-1.12.225-2.005 1.11-2.23 2.23C2 8.289 2 12.001 2 12.001s0 3.712.418 5.814c.225 1.12 1.11 2.005 2.23 2.23C6.75 20.5 12 20.5 12 20.5s5.25 0 7.352-.455c1.12-.225 2.005-1.11 2.23-2.23C22 15.712 22 12.001 22 12.001s0-3.712-.418-5.815zM10 15.5v-7l6 3.5-6 3.5z"})})}):e.includes("bilibili.com")?(0,r.jsx)("div",{className:"w-4 h-4 bg-[#00aeec] rounded-sm flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-[8px] text-white font-bold",children:"B"})}):(0,r.jsx)("div",{className:"w-4 h-4 bg-[#5f6368] rounded-sm flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})});return n?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-[2px] flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl max-w-lg w-full mx-4 overflow-hidden border border-[#dadce0]",children:[(0,r.jsx)("div",{className:"border-b border-[#e8eaed] p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[c(o),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h2",{className:"text-[16px] font-normal text-[#202124] leading-6",children:"Configure Video Settings"}),(0,r.jsx)("p",{className:"text-[13px] text-[#5f6368] mt-0.5 break-all",children:o})]})]})}),(0,r.jsxs)("div",{className:"p-6 space-y-5",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-[14px] font-medium text-[#202124] mb-3",children:"Video Information"}),(0,r.jsx)("div",{className:"bg-[#f8f9fa] border border-[#e8eaed] rounded-lg p-3",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[c(o),(0,r.jsx)("span",{className:"text-[14px] text-[#202124] font-normal",children:(e=>e.includes("youtube.com")||e.includes("youtu.be")?"YouTube Video":e.includes("bilibili.com")?"Bilibili Video":e.includes(".mp4")||e.includes(".webm")?"Video File":"Video")(o)})]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-[14px] font-medium text-[#202124] mb-3",children:"Time Range"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-[13px] text-[#5f6368] mb-2",children:"Start time (seconds)"}),(0,r.jsx)("input",{type:"number",min:"0",value:null!=(t=null==h?void 0:h.startTime)?t:0,onChange:e=>d(t=>({...t,startTime:Number(e.target.value)})),className:"w-full px-3 py-2 text-[14px] border border-[#dadce0] rounded-md focus:outline-none focus:ring-2 focus:ring-[#1a73e8] focus:ring-opacity-20 focus:border-[#1a73e8] transition-colors",placeholder:"0"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-[13px] text-[#5f6368] mb-2",children:"End time (seconds)"}),(0,r.jsx)("input",{type:"number",min:"0",value:null!=(i=null==h?void 0:h.endTime)?i:"",onChange:e=>d(t=>({...t,endTime:e.target.value?Number(e.target.value):void 0})),className:"w-full px-3 py-2 text-[14px] border border-[#dadce0] rounded-md focus:outline-none focus:ring-2 focus:ring-[#1a73e8] focus:ring-opacity-20 focus:border-[#1a73e8] transition-colors",placeholder:"End of video"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-[14px] font-medium text-[#202124] mb-3",children:"AI Companion Settings"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-[13px] text-[#5f6368] mb-2",children:"Instructions for your AI companion"}),(0,r.jsx)("textarea",{value:null!=(a=null==h?void 0:h.userRequirements)?a:"",onChange:e=>d(t=>({...t,userRequirements:e.target.value})),placeholder:"Describe how you'd like your AI companion to interact with this video. For example: 'Act as a movie critic and provide analysis', 'Explain technical concepts for beginners', 'Be enthusiastic and engaging'...",rows:4,className:"w-full px-3 py-2 text-[14px] border border-[#dadce0] rounded-md focus:outline-none focus:ring-2 focus:ring-[#1a73e8] focus:ring-opacity-20 focus:border-[#1a73e8] transition-colors resize-none"}),(0,r.jsx)("p",{className:"mt-2 text-[12px] text-[#5f6368]",children:"Optional: Provide context or specific instructions for personalized interaction"})]})]})]}),(0,r.jsxs)("div",{className:"bg-[#f8f9fa] border-t border-[#e8eaed] px-6 py-4 flex items-center justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:l,className:"px-4 py-2 text-[14px] text-[#1a73e8] font-medium hover:bg-[#e8f0fe] rounded-md transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>{u(h),l()},className:"px-6 py-2 bg-[#1a73e8] text-white text-[14px] font-medium rounded-md hover:bg-[#1557b0] transition-colors shadow-sm",children:"Start Watching"})]})]})}):null};var R=i(9137),k=i.n(R);let T=e=>{let{isOpen:t,onClose:i}=e,[a,n]=(0,s.useState)("general"),{generalSettings:o,backgroundSettings:l,updateGeneralSettings:u,updateBackgroundSettings:h,saveSettings:d}=(0,f.t)(),c={baseUrl:"http://127.0.0.1:8000",websocketBaseUrl:"ws://127.0.0.1:8000/ws",reduceVideoVolumeOnSpeech:!0,videoVolumeReductionPercent:50},g={type:"image",imageUrl:"",imageFile:null,imageScale:1,imagePositionX:50,imagePositionY:50,imageMode:"cover"},[m,_]=(0,s.useState)({...c,...o}),[p,x]=(0,s.useState)({...g,...l}),y=(0,s.useRef)(null);(0,s.useEffect)(()=>{_({...c,...o}),x({...g,...l})},[o,l]);let b=e=>{var t;let i=null==(t=e.target.files)?void 0:t[0];if(i&&i.type.startsWith("image/")){let e=new FileReader;e.onload=e=>{var t;let r=null==(t=e.target)?void 0:t.result;x(e=>({...e,type:"image",imageFile:i,imageUrl:r,imageScale:1,imagePositionX:50,imagePositionY:50,imageMode:"cover"}))},e.readAsDataURL(i)}};return t?(0,r.jsxs)("div",{className:"jsx-435806a591b5dbd9 fixed inset-0 bg-black/50 backdrop-blur-[2px] flex items-center justify-center z-50 p-4",children:[(0,r.jsxs)("div",{className:"jsx-435806a591b5dbd9 bg-white rounded-lg shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden border border-[#dadce0]",children:[(0,r.jsx)("div",{className:"jsx-435806a591b5dbd9 border-b border-[#e8eaed] p-4",children:(0,r.jsxs)("div",{className:"jsx-435806a591b5dbd9 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"jsx-435806a591b5dbd9 flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"jsx-435806a591b5dbd9 w-4 h-4 bg-[#5f6368] rounded-sm flex items-center justify-center",children:(0,r.jsxs)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-435806a591b5dbd9 w-2.5 h-2.5 text-white",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z",className:"jsx-435806a591b5dbd9"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z",className:"jsx-435806a591b5dbd9"})]})}),(0,r.jsx)("h2",{className:"jsx-435806a591b5dbd9 text-[16px] font-normal text-[#202124] leading-6",children:"Settings"})]}),(0,r.jsx)("button",{onClick:i,className:"jsx-435806a591b5dbd9 w-8 h-8 rounded-full hover:bg-[#f8f9fa] flex items-center justify-center transition-colors",children:(0,r.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-435806a591b5dbd9 w-4 h-4 text-[#5f6368]",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12",className:"jsx-435806a591b5dbd9"})})})]})}),(0,r.jsx)("div",{className:"jsx-435806a591b5dbd9 border-b border-[#e8eaed] px-4",children:(0,r.jsx)("div",{className:"jsx-435806a591b5dbd9 flex space-x-0",children:[{key:"general",label:"General",icon:"⚙️"},{key:"background",label:"Background",icon:"\uD83D\uDDBC️"},{key:"user",label:"User",icon:"\uD83D\uDC64"},{key:"character",label:"Character",icon:"\uD83C\uDFAD"}].map(e=>(0,r.jsxs)("button",{onClick:()=>n(e.key),className:"jsx-435806a591b5dbd9 "+"px-4 py-3 text-[14px] font-medium border-b-2 transition-colors ".concat(a===e.key?"border-[#1a73e8] text-[#1a73e8]":"border-transparent text-[#5f6368] hover:text-[#202124]"),children:[(0,r.jsx)("span",{className:"jsx-435806a591b5dbd9 mr-2",children:e.icon}),e.label]},e.key))})}),(0,r.jsx)("div",{className:"jsx-435806a591b5dbd9 overflow-y-auto max-h-[calc(90vh-200px)]",children:(0,r.jsx)("div",{className:"jsx-435806a591b5dbd9 p-6",children:(()=>{var e,t,i,s,n,o,l,u,h,d,c,g,f;switch(a){case"general":return(0,r.jsxs)("div",{className:"space-y-5",children:[(0,r.jsxs)("div",{className:"border-b border-[#e8eaed] pb-5",children:[(0,r.jsx)("h3",{className:"text-[14px] font-medium text-[#202124] mb-4",children:"Audio Settings"}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-[13px] font-medium text-[#202124]",children:"Reduce video volume when AI speaks"}),(0,r.jsx)("p",{className:"text-[12px] text-[#5f6368] mt-1",children:"Automatically lower video volume during AI speech for better clarity"})]}),(0,r.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:null==(e=null==m?void 0:m.reduceVideoVolumeOnSpeech)||e,onChange:e=>_(t=>({...t,reduceVideoVolumeOnSpeech:e.target.checked})),className:"sr-only peer"}),(0,r.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),(null==m?void 0:m.reduceVideoVolumeOnSpeech)&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-[13px] font-medium text-[#202124] mb-2",children:["Volume reduction: ",null!=(t=null==m?void 0:m.videoVolumeReductionPercent)?t:50,"%"]}),(0,r.jsx)("input",{type:"range",min:"10",max:"90",step:"5",value:null!=(i=null==m?void 0:m.videoVolumeReductionPercent)?i:50,onChange:e=>_(t=>({...t,videoVolumeReductionPercent:parseInt(e.target.value)})),className:"w-full h-2 bg-[#e8eaed] rounded-lg appearance-none cursor-pointer slider"}),(0,r.jsxs)("div",{className:"flex justify-between text-[11px] text-[#5f6368] mt-1",children:[(0,r.jsx)("span",{children:"10%"}),(0,r.jsx)("span",{children:"50%"}),(0,r.jsx)("span",{children:"90%"})]}),(0,r.jsxs)("p",{className:"text-[12px] text-[#5f6368] mt-2",children:["Video volume will be reduced to ",null!=(s=null==m?void 0:m.videoVolumeReductionPercent)?s:50,"% of original volume"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-[14px] font-medium text-[#202124] mb-4",children:"Server Settings"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-[13px] font-medium text-[#202124] mb-2",children:"Base URL"}),(0,r.jsx)("input",{type:"url",value:null!=(n=null==m?void 0:m.baseUrl)?n:"",onChange:e=>_(t=>({...t,baseUrl:e.target.value})),placeholder:"http://127.0.0.1:8000",className:"w-full px-3 py-2 text-[14px] border border-[#dadce0] rounded-md focus:outline-none focus:ring-2 focus:ring-[#1a73e8] focus:ring-opacity-20 focus:border-[#1a73e8] transition-colors"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-[13px] font-medium text-[#202124] mb-2",children:"WebSocket Base URL"}),(0,r.jsx)("input",{type:"url",value:null!=(o=null==m?void 0:m.websocketBaseUrl)?o:"",onChange:e=>_(t=>({...t,websocketBaseUrl:e.target.value})),placeholder:"ws://127.0.0.1:8000/ws",className:"w-full px-3 py-2 text-[14px] border border-[#dadce0] rounded-md focus:outline-none focus:ring-2 focus:ring-[#1a73e8] focus:ring-opacity-20 focus:border-[#1a73e8] transition-colors"})]})]})]})]});case"user":return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[(0,r.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDC64"}),(0,r.jsx)("h3",{className:"text-[14px] font-medium text-[#202124] mb-2",children:"User Settings"}),(0,r.jsx)("p",{className:"text-[13px] text-[#5f6368]",children:"User configuration options will be available here"})]});case"background":return(0,r.jsxs)("div",{className:"space-y-5",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-[13px] font-medium text-[#202124] mb-2",children:"Image URL"}),(0,r.jsx)("input",{type:"url",value:null!=(l=null==p?void 0:p.imageUrl)?l:"",onChange:e=>{var t;return t=e.target.value,void x(e=>({...e,type:"image",imageUrl:t,imageFile:null,imageScale:1,imagePositionX:50,imagePositionY:50,imageMode:"cover"}))},placeholder:"https://example.com/image.jpg",className:"w-full px-3 py-2 text-[14px] border border-[#dadce0] rounded-md focus:outline-none focus:ring-2 focus:ring-[#1a73e8] focus:ring-opacity-20 focus:border-[#1a73e8] transition-colors"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-[13px] font-medium text-[#202124] mb-2",children:"Or upload local image"}),(0,r.jsx)("input",{ref:y,type:"file",accept:"image/*",onChange:b,className:"hidden"}),(0,r.jsxs)("button",{onClick:()=>{var e;return null==(e=y.current)?void 0:e.click()},className:"w-full px-4 py-3 border-2 border-dashed border-[#dadce0] rounded-lg text-[14px] text-[#5f6368] hover:border-[#1a73e8] hover:text-[#1a73e8] transition-colors",children:[(0,r.jsx)("svg",{className:"w-5 h-5 mx-auto mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Click to select image file"]}),(null==p?void 0:p.imageFile)&&(0,r.jsxs)("p",{className:"mt-2 text-[12px] text-[#5f6368]",children:["Selected: ",p.imageFile.name]})]}),(null==p?void 0:p.imageUrl)&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-[13px] font-medium text-[#202124] mb-2",children:"Display Mode"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,r.jsx)("button",{onClick:()=>x(e=>({...e,imageMode:"cover"})),className:"px-3 py-2 text-[12px] border rounded-md transition-colors ".concat((null==p?void 0:p.imageMode)==="cover"?"border-[#1a73e8] bg-[#e8f0fe] text-[#1a73e8]":"border-[#dadce0] hover:bg-[#f8f9fa] text-[#202124]"),children:"Cover"}),(0,r.jsx)("button",{onClick:()=>x(e=>({...e,imageMode:"contain"})),className:"px-3 py-2 text-[12px] border rounded-md transition-colors ".concat((null==p?void 0:p.imageMode)==="contain"?"border-[#1a73e8] bg-[#e8f0fe] text-[#1a73e8]":"border-[#dadce0] hover:bg-[#f8f9fa] text-[#202124]"),children:"Contain"}),(0,r.jsx)("button",{onClick:()=>x(e=>({...e,imageMode:"fill"})),className:"px-3 py-2 text-[12px] border rounded-md transition-colors ".concat((null==p?void 0:p.imageMode)==="fill"?"border-[#1a73e8] bg-[#e8f0fe] text-[#1a73e8]":"border-[#dadce0] hover:bg-[#f8f9fa] text-[#202124]"),children:"Fill"})]})]}),(null==p?void 0:p.imageMode)==="cover"&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-[13px] font-medium text-[#202124] mb-2",children:["Scale: ",Math.round((null!=(u=null==p?void 0:p.imageScale)?u:1)*100),"%"]}),(0,r.jsx)("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:null!=(h=null==p?void 0:p.imageScale)?h:1,onChange:e=>x(t=>({...t,imageScale:parseFloat(e.target.value)})),className:"w-full h-2 bg-[#e8eaed] rounded-lg appearance-none cursor-pointer slider"}),(0,r.jsxs)("div",{className:"flex justify-between text-[11px] text-[#5f6368] mt-1",children:[(0,r.jsx)("span",{children:"50%"}),(0,r.jsx)("span",{children:"300%"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-[13px] font-medium text-[#202124] mb-2",children:["Horizontal: ",null!=(d=null==p?void 0:p.imagePositionX)?d:50,"%"]}),(0,r.jsx)("input",{type:"range",min:"0",max:"100",value:null!=(c=null==p?void 0:p.imagePositionX)?c:50,onChange:e=>x(t=>({...t,imagePositionX:parseInt(e.target.value)})),className:"w-full h-2 bg-[#e8eaed] rounded-lg appearance-none cursor-pointer slider"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-[13px] font-medium text-[#202124] mb-2",children:["Vertical: ",null!=(g=null==p?void 0:p.imagePositionY)?g:50,"%"]}),(0,r.jsx)("input",{type:"range",min:"0",max:"100",value:null!=(f=null==p?void 0:p.imagePositionY)?f:50,onChange:e=>x(t=>({...t,imagePositionY:parseInt(e.target.value)})),className:"w-full h-2 bg-[#e8eaed] rounded-lg appearance-none cursor-pointer slider"})]})]}),(0,r.jsx)("button",{onClick:()=>x(e=>({...e,imageScale:1,imagePositionX:50,imagePositionY:50,imageMode:"cover"})),className:"w-full px-3 py-2 text-[13px] text-[#5f6368] border border-[#dadce0] rounded-md hover:bg-[#f8f9fa] transition-colors",children:"Reset adjustments"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-[13px] font-medium text-[#202124] mb-2",children:"Preview"}),(0,r.jsx)("div",{className:"w-full h-32 bg-[#f8f9fa] border border-[#e8eaed] rounded-lg overflow-hidden",style:(()=>{var e,t,i;if(!(null==p?void 0:p.imageUrl))return{};let r="cover",s="".concat(null!=(e=null==p?void 0:p.imagePositionX)?e:50,"% ").concat(null!=(t=null==p?void 0:p.imagePositionY)?t:50,"%");switch(null==p?void 0:p.imageMode){case"contain":r="contain";break;case"fill":r="100% 100%";break;default:r="".concat((null!=(i=null==p?void 0:p.imageScale)?i:1)*100,"%")}return{backgroundImage:"url(".concat(null==p?void 0:p.imageUrl,")"),backgroundSize:r,backgroundPosition:s,backgroundRepeat:"no-repeat"}})(),children:!(null==p?void 0:p.imageUrl)&&(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center text-[#5f6368] text-[12px]",children:"Image preview"})})]})]})]});case"character":return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[(0,r.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFAD"}),(0,r.jsx)("h3",{className:"text-[14px] font-medium text-[#202124] mb-2",children:"Character Settings"}),(0,r.jsx)("p",{className:"text-[13px] text-[#5f6368]",children:"Character configuration options will be available here"})]});default:return null}})()})}),(0,r.jsxs)("div",{className:"jsx-435806a591b5dbd9 bg-[#f8f9fa] border-t border-[#e8eaed] px-6 py-4 flex items-center justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:i,className:"jsx-435806a591b5dbd9 px-4 py-2 text-[14px] text-[#1a73e8] font-medium hover:bg-[#e8f0fe] rounded-md transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>{u(m),h(p),d(),i()},className:"jsx-435806a591b5dbd9 px-6 py-2 bg-[#1a73e8] text-white text-[14px] font-medium rounded-md hover:bg-[#1557b0] transition-colors shadow-sm",children:"Apply Settings"})]})]}),(0,r.jsx)(k(),{id:"435806a591b5dbd9",children:".slider.jsx-435806a591b5dbd9::-webkit-slider-thumb{appearance:none;height:16px;width:16px;border-radius:50%;background:#1a73e8;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.2)}.slider.jsx-435806a591b5dbd9::-moz-range-thumb{height:16px;width:16px;border-radius:50%;background:#1a73e8;cursor:pointer;border:none;box-shadow:0 2px 4px rgba(0,0,0,.2)}"})]}):null};function F(e){let{children:t,url:i="ws://127.0.0.1:8000/ws"}=e,[a,o]=(0,s.useState)("disconnected"),[l,u]=(0,s.useState)(null),[h,d]=(0,s.useState)("idle"),[c,g]=(0,s.useState)(null),[m,_]=(0,s.useState)([]),p=(0,s.useRef)(null),f=(0,s.useRef)(null),y=(0,s.useRef)(0),b=(0,s.useRef)(null),{addMessage:S}=(0,v.Y)(),{setExpression:C}=n(),w=(0,s.useCallback)(()=>{_([])},[]),M=(0,s.useCallback)(()=>{g(null),"error"===h&&d("idle")},[h]),P=(0,s.useCallback)(()=>{d("idle"),g(null),_([])},[]),B="ready"===h,I=(0,s.useCallback)(e=>e&&"string"==typeof e.action_type&&["SPEAK","PAUSE","SEEK","REPLAY_SEGMENT","END_REACTION","EXPRESSION"].includes(e.action_type)&&"string"==typeof e.id&&"number"==typeof e.trigger_timestamp&&"string"==typeof e.comment,[]),E=(0,s.useCallback)(e=>{try{let t=JSON.parse(e.data);switch(console.log("\uD83D\uDCE8 Received WebSocket message:",t),t.type){case"session_ready":console.log("✅ Session is ready! Setting status to ready"),d("ready"),g(null),S({type:"system",content:"Session ready! You can start chatting."});break;case"processing_error":console.error("Processing error received:",t),console.error("Full error details:",JSON.stringify(t,null,2));let i={error_code:t.error_code||"UNKNOWN_ERROR",message:t.message||"An unknown error occurred"};g(i),d("error"),S({type:"system",content:"Processing Error: ".concat(i.message)});break;case"ai_action":if(console.log("Received AI action message:",t),t.action&&I(t.action)){let e=t.action,i={action_type:e.action_type,id:e.id,trigger_timestamp:e.trigger_timestamp,comment:e.comment,text:e.text,audio:e.audio,pause_video:e.pause_video,duration_seconds:e.duration_seconds,target_timestamp:e.target_timestamp,post_seek_behavior:e.post_seek_behavior,start_timestamp:e.start_timestamp,end_timestamp:e.end_timestamp,post_replay_behavior:e.post_replay_behavior,emotion_expressions:e.emotion_expressions};_(e=>{let t=e.findIndex(e=>e.id===i.id);return -1!==t?(console.log("Action with ID ".concat(i.id," already exists, skipping duplicate")),e):[...e,i].sort((e,t)=>e.trigger_timestamp-t.trigger_timestamp)}),"SPEAK"!==i.action_type&&V(i)}else console.warn("Received invalid ai_action message:",t);break;case"error":console.error("❌ Server error:",t),u(t.message||"Server error occurred"),S({type:"system",content:"Server Error: ".concat(t.message||"Unknown server error")});break;case"audio_received":console.log("✅ Audio processing acknowledged by server");break;default:console.log("Unhandled message type:",t.type)}}catch(t){console.error("Failed to parse WebSocket message:",e.data,t),u("Invalid message format received")}},[S,I]),V=(0,s.useCallback)(e=>{switch(e.action_type){case"EXPRESSION":if(e.emotion_expressions){var t,i;let r=null==(t=(i=window).getLAppAdapter)?void 0:t.call(i);r&&C(e.emotion_expressions,r,"Set expression to: ".concat(e.emotion_expressions))}break;case"PAUSE":console.log("⏸️ AI pausing for ".concat(e.duration_seconds,"s"));break;case"SEEK":console.log("⏩ AI seeking to ".concat(e.target_timestamp,"s"));break;case"REPLAY_SEGMENT":console.log("\uD83D\uDD04 AI replaying segment ".concat(e.start_timestamp,"s - ").concat(e.end_timestamp,"s"));break;case"END_REACTION":console.log("\uD83C\uDFC1 AI ended reaction");break;default:console.warn("⚠️ Unknown AI action type:",e.action_type)}},[C]),R=(0,s.useCallback)(e=>{var t;if((null==(t=p.current)?void 0:t.readyState)===WebSocket.OPEN)try{p.current.send(JSON.stringify(e)),console.log("\uD83D\uDCE4 Sent WebSocket message:",e)}catch(e){console.error("Failed to send WebSocket message:",e),u("Failed to send message")}else console.warn("WebSocket is not connected. Cannot send message:",e),u("WebSocket not connected")},[]),k=(0,s.useCallback)(e=>{var t;let r="".concat(i,"/").concat(e);if(e&&(null==(t=p.current)?void 0:t.readyState)!==WebSocket.OPEN){b.current=e;try{u(null),o("connecting"),console.log("\uD83D\uDD17 Connecting to WebSocket:",r),p.current=new WebSocket(r),p.current.onopen=()=>{console.log("\uD83D\uDD17 WebSocket connected to:",r),o("connected"),y.current=0},p.current.onmessage=E,p.current.onclose=e=>{if(console.log("❌ WebSocket disconnected:",e.code,e.reason),o("disconnected"),y.current<5){y.current++;let e=Math.min(1e3*Math.pow(2,y.current),3e4);console.log("\uD83D\uDD04 Attempting to reconnect in ".concat(e,"ms (attempt ").concat(y.current,"/5)")),f.current=setTimeout(()=>{b.current&&k(b.current)},e)}else u("Connection lost. Max reconnection attempts reached.")},p.current.onerror=e=>{console.error("\uD83D\uDEA8 WebSocket error:",e),o("error"),u("Connection error occurred")}}catch(e){console.error("Failed to create WebSocket connection:",e),o("error"),u("Failed to create connection")}}},[i,E]),T=(0,s.useCallback)(()=>{f.current&&(clearTimeout(f.current),f.current=null),p.current&&(p.current.close(),p.current=null),o("disconnected"),d("idle"),g(null),_([]),y.current=0},[]);(0,s.useEffect)(()=>{console.log("\uD83D\uDCCA Message handler session status changed:",h,"isReady:",B)},[h,B]),(0,s.useEffect)(()=>()=>{T()},[]);let F=(0,s.useMemo)(()=>({status:a,sendMessage:R,error:l,connect:k,disconnect:T,sessionStatus:h,processingError:c,isSessionReady:B,receivedActions:m,clearReceivedActions:w,clearError:M,resetHandler:P}),[a,R,l,k,T,h,c,B,m,w,M,P]);return(0,r.jsx)(x.Provider,{value:F,children:t})}var A=i(6563);function L(){console.log("HomePage component is rendering!");let[e,t]=(0,s.useState)({x:100,y:100}),[i,a]=(0,s.useState)({x:800,y:150}),[n,o]=(0,s.useState)({x:50,y:250}),l=(0,s.useRef)(null),{listeners:u}=p({initialPosition:i,onPositionChange:a}),[h,d]=(0,s.useState)(""),[c,m]=(0,s.useState)(!1),[_,x]=(0,s.useState)(!1),[y,b]=(0,s.useState)(""),[S,w]=(0,s.useState)({}),[M,P]=(0,s.useState)(0),{backgroundSettings:B}=(0,f.t)(),{addMessage:I}=(0,v.Y)();return(0,s.useEffect)(()=>{{window.getLAppAdapter=()=>A.LAppAdapter.getInstance();let e=sessionStorage.getItem("watchingVideoUrl");e&&(d(e),sessionStorage.removeItem("watchingVideoUrl"))}},[I]),(0,s.useEffect)(()=>{let e=()=>{let e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{let e={documentOverflow:document.documentElement.style.overflow,bodyOverflow:document.body.style.overflow,documentHeight:document.documentElement.style.height,bodyHeight:document.body.style.height,documentPosition:document.documentElement.style.position,bodyPosition:document.body.style.position,documentWidth:document.documentElement.style.width,bodyWidth:document.body.style.width};return document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",document.documentElement.style.height="100%",document.body.style.height="100%",document.documentElement.style.position="fixed",document.body.style.position="fixed",document.documentElement.style.width="100%",document.body.style.width="100%",()=>{document.documentElement.style.overflow=e.documentOverflow,document.body.style.overflow=e.bodyOverflow,document.documentElement.style.height=e.documentHeight,document.body.style.height=e.bodyHeight,document.documentElement.style.position=e.documentPosition,document.body.style.position=e.bodyPosition,document.documentElement.style.width=e.documentWidth,document.body.style.width=e.bodyWidth}},[]),(0,r.jsx)(F,{children:(0,r.jsxs)("div",{className:"w-screen h-screen overflow-hidden relative",style:(()=>{if("image"!==B.type||!B.imageUrl)return{background:"linear-gradient(135deg, #0f172a 0%, #0f172add 100%)"};{let e="cover",t="".concat(B.imagePositionX,"% ").concat(B.imagePositionY,"%");switch(B.imageMode){case"contain":e="contain";break;case"fill":e="100% 100%";break;default:e="".concat(100*B.imageScale,"%")}return{backgroundImage:"url(".concat(B.imageUrl,")"),backgroundSize:e,backgroundPosition:t,backgroundRepeat:"no-repeat"}}})(),children:[(0,r.jsx)("div",{className:"absolute inset-0 opacity-30",children:(0,r.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-black/10 via-transparent to-black/10"})}),(0,r.jsx)("div",{className:"absolute top-6 left-6 z-30",children:(0,r.jsx)("button",{onClick:()=>x(!0),className:"bg-white/90 backdrop-blur-sm rounded-full p-3 shadow-lg border border-white/20 hover:bg-white/95 transition-all duration-200 hover:scale-105",title:"Settings",children:(0,r.jsxs)("svg",{className:"w-5 h-5 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})}),(0,r.jsxs)("div",{className:"relative w-full h-full",children:[(0,r.jsx)(C,{videoSrc:h,onUrlSubmit:e=>{b(e),m(!0)},className:"w-full max-w-5xl",position:e,onPositionChange:t,sessionConfig:S,onVideoTimeUpdate:P}),(0,r.jsx)("div",{ref:l,style:{position:"absolute",left:i.x,top:i.y,width:"34rem",height:"100%",zIndex:20,cursor:"move"},...u,children:(0,r.jsx)(g,{})}),(0,r.jsx)(E,{position:n,onPositionChange:o,videoCurrentTime:M})]}),(0,r.jsx)(V,{isOpen:c,videoUrl:y,onClose:()=>{m(!1),b("")},onConfirm:e=>{console.log("Video configuration:",e),d(y),w({startTime:e.startTime,endTime:e.endTime,userRequirements:e.userRequirements}),m(!1)}}),(0,r.jsx)(T,{isOpen:_,onClose:()=>x(!1)})]})})}},7742:(e,t,i)=>{"use strict";let r,s,a;i.d(t,{$:()=>t4});let n=Object.freeze({HitAreaPrefix:"HitArea",HitAreaHead:"Head",HitAreaBody:"Body",PartsIdCore:"Parts01Core",PartsArmPrefix:"Parts01Arm_",PartsArmLPrefix:"Parts01ArmL_",PartsArmRPrefix:"Parts01ArmR_",ParamAngleX:"ParamAngleX",ParamAngleY:"ParamAngleY",ParamAngleZ:"ParamAngleZ",ParamEyeLOpen:"ParamEyeLOpen",ParamEyeLSmile:"ParamEyeLSmile",ParamEyeROpen:"ParamEyeROpen",ParamEyeRSmile:"ParamEyeRSmile",ParamEyeBallX:"ParamEyeBallX",ParamEyeBallY:"ParamEyeBallY",ParamEyeBallForm:"ParamEyeBallForm",ParamBrowLY:"ParamBrowLY",ParamBrowRY:"ParamBrowRY",ParamBrowLX:"ParamBrowLX",ParamBrowRX:"ParamBrowRX",ParamBrowLAngle:"ParamBrowLAngle",ParamBrowRAngle:"ParamBrowRAngle",ParamBrowLForm:"ParamBrowLForm",ParamBrowRForm:"ParamBrowRForm",ParamMouthForm:"ParamMouthForm",ParamMouthOpenY:"ParamMouthOpenY",ParamCheek:"ParamCheek",ParamBodyAngleX:"ParamBodyAngleX",ParamBodyAngleY:"ParamBodyAngleY",ParamBodyAngleZ:"ParamBodyAngleZ",ParamBreath:"ParamBreath",ParamArmLA:"ParamArmLA",ParamArmRA:"ParamArmRA",ParamArmLB:"ParamArmLB",ParamArmRB:"ParamArmRB",ParamHandL:"ParamHandL",ParamHandR:"ParamHandR",ParamHairFront:"ParamHairFront",ParamHairSide:"ParamHairSide",ParamHairBack:"ParamHairBack",ParamHairFluffy:"ParamHairFluffy",ParamShoulderY:"ParamShoulderY",ParamBustX:"ParamBustX",ParamBustY:"ParamBustY",ParamBaseX:"ParamBaseX",ParamBaseY:"ParamBaseY",ParamNONE:"NONE:"});!function(e){e.HitAreaBody=n.HitAreaBody,e.HitAreaHead=n.HitAreaHead,e.HitAreaPrefix=n.HitAreaPrefix,e.ParamAngleX=n.ParamAngleX,e.ParamAngleY=n.ParamAngleY,e.ParamAngleZ=n.ParamAngleZ,e.ParamArmLA=n.ParamArmLA,e.ParamArmLB=n.ParamArmLB,e.ParamArmRA=n.ParamArmRA,e.ParamArmRB=n.ParamArmRB,e.ParamBaseX=n.ParamBaseX,e.ParamBaseY=n.ParamBaseY,e.ParamBodyAngleX=n.ParamBodyAngleX,e.ParamBodyAngleY=n.ParamBodyAngleY,e.ParamBodyAngleZ=n.ParamBodyAngleZ,e.ParamBreath=n.ParamBreath,e.ParamBrowLAngle=n.ParamBrowLAngle,e.ParamBrowLForm=n.ParamBrowLForm,e.ParamBrowLX=n.ParamBrowLX,e.ParamBrowLY=n.ParamBrowLY,e.ParamBrowRAngle=n.ParamBrowRAngle,e.ParamBrowRForm=n.ParamBrowRForm,e.ParamBrowRX=n.ParamBrowRX,e.ParamBrowRY=n.ParamBrowRY,e.ParamBustX=n.ParamBustX,e.ParamBustY=n.ParamBustY,e.ParamCheek=n.ParamCheek,e.ParamEyeBallForm=n.ParamEyeBallForm,e.ParamEyeBallX=n.ParamEyeBallX,e.ParamEyeBallY=n.ParamEyeBallY,e.ParamEyeLOpen=n.ParamEyeLOpen,e.ParamEyeLSmile=n.ParamEyeLSmile,e.ParamEyeROpen=n.ParamEyeROpen,e.ParamEyeRSmile=n.ParamEyeRSmile,e.ParamHairBack=n.ParamHairBack,e.ParamHairFluffy=n.ParamHairFluffy,e.ParamHairFront=n.ParamHairFront,e.ParamHairSide=n.ParamHairSide,e.ParamHandL=n.ParamHandL,e.ParamHandR=n.ParamHandR,e.ParamMouthForm=n.ParamMouthForm,e.ParamMouthOpenY=n.ParamMouthOpenY,e.ParamNONE=n.ParamNONE,e.ParamShoulderY=n.ParamShoulderY,e.PartsArmLPrefix=n.PartsArmLPrefix,e.PartsArmPrefix=n.PartsArmPrefix,e.PartsArmRPrefix=n.PartsArmRPrefix,e.PartsIdCore=n.PartsIdCore}(l||(l={}));class o{}(u||(u={})).ICubismModelSetting=o;var l,u,h,d,c,g,m,_,p,f,x,y,b,v,S,C,w,M,P,B,I,E,V,R,k=i(7932),T=i(2342),F=i(275);let A="FileReferences",L="UserData",D="Name",N="File",j="Sound",O="FadeInTime",z="FadeOutTime",U="LipSync",X="EyeBlink";var Y=function(e){return e[e.FrequestNode_Groups=0]="FrequestNode_Groups",e[e.FrequestNode_Moc=1]="FrequestNode_Moc",e[e.FrequestNode_Motions=2]="FrequestNode_Motions",e[e.FrequestNode_Expressions=3]="FrequestNode_Expressions",e[e.FrequestNode_Textures=4]="FrequestNode_Textures",e[e.FrequestNode_Physics=5]="FrequestNode_Physics",e[e.FrequestNode_Pose=6]="FrequestNode_Pose",e[e.FrequestNode_HitAreas=7]="FrequestNode_HitAreas",e}(Y||{});class G extends o{release(){F._3.delete(this._json),this._jsonValue=null}getJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(1).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(4).getSize():0}getTextureDirectory(){let e=this._jsonValue.at(4).getValueByIndex(0).getRawString().split("/"),t=e.length-1,i="";for(let r=0;r<t;r++)i+=e[r],r<t-1&&(i+="/");return i}getTextureFileName(e){return this._jsonValue.at(4).getValueByIndex(e).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(7).getSize():0}getHitAreaId(e){return k.MN.getIdManager().getId(this._jsonValue.at(7).getValueByIndex(e).getValueByString("Id").getRawString())}getHitAreaName(e){return this._jsonValue.at(7).getValueByIndex(e).getValueByString(D).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(5).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(6).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(3).getSize():0}getExpressionName(e){return this._jsonValue.at(3).getValueByIndex(e).getValueByString(D).getRawString()}getExpressionFileName(e){return this._jsonValue.at(3).getValueByIndex(e).getValueByString(N).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().getSize():0}getMotionGroupName(e){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().at(e):null}getMotionCount(e){return this.isExistMotionGroupName(e)?this._jsonValue.at(2).getValueByString(e).getSize():0}getMotionFileName(e,t){return this.isExistMotionGroupName(e)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(N).getRawString():""}getMotionSoundFileName(e,t){return this.isExistMotionSoundFile(e,t)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(j).getRawString():""}getMotionFadeInTimeValue(e,t){return this.isExistMotionFadeIn(e,t)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(O).toFloat():-1}getMotionFadeOutTimeValue(e,t){return this.isExistMotionFadeOut(e,t)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(z).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this.getJson().getRoot().getValueByString(A).getValueByString(L).getRawString():""}getLayoutMap(e){let t=this.getJson().getRoot().getValueByString("Layout").getMap();if(null==t)return!1;let i=!1;for(let r=t.begin();r.notEqual(t.end());r.preIncrement())e.setValue(r.ptr().first,r.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let e=0;for(let t=0;t<this._jsonValue.at(0).getSize();t++){let i=this._jsonValue.at(0).getValueByIndex(t);if(!(i.isNull()||i.isError())&&i.getValueByString(D).getRawString()==X){e=i.getValueByString("Ids").getVector().getSize();break}}return e}getEyeBlinkParameterId(e){if(!this.isExistEyeBlinkParameters())return null;for(let t=0;t<this._jsonValue.at(0).getSize();t++){let i=this._jsonValue.at(0).getValueByIndex(t);if(!(i.isNull()||i.isError())&&i.getValueByString(D).getRawString()==X)return k.MN.getIdManager().getId(i.getValueByString("Ids").getValueByIndex(e).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let e=0;for(let t=0;t<this._jsonValue.at(0).getSize();t++){let i=this._jsonValue.at(0).getValueByIndex(t);if(!(i.isNull()||i.isError())&&i.getValueByString(D).getRawString()==U){e=i.getValueByString("Ids").getVector().getSize();break}}return e}getLipSyncParameterId(e){if(!this.isExistLipSyncParameters())return null;for(let t=0;t<this._jsonValue.at(0).getSize();t++){let i=this._jsonValue.at(0).getValueByIndex(t);if(!(i.isNull()||i.isError())&&i.getValueByString(D).getRawString()==U)return k.MN.getIdManager().getId(i.getValueByString("Ids").getValueByIndex(e).getRawString())}return null}isExistModelFile(){let e=this._jsonValue.at(1);return!e.isNull()&&!e.isError()}isExistTextureFiles(){let e=this._jsonValue.at(4);return!e.isNull()&&!e.isError()}isExistHitAreas(){let e=this._jsonValue.at(7);return!e.isNull()&&!e.isError()}isExistPhysicsFile(){let e=this._jsonValue.at(5);return!e.isNull()&&!e.isError()}isExistPoseFile(){let e=this._jsonValue.at(6);return!e.isNull()&&!e.isError()}isExistExpressionFile(){let e=this._jsonValue.at(3);return!e.isNull()&&!e.isError()}isExistMotionGroups(){let e=this._jsonValue.at(2);return!e.isNull()&&!e.isError()}isExistMotionGroupName(e){let t=this._jsonValue.at(2).getValueByString(e);return!t.isNull()&&!t.isError()}isExistMotionSoundFile(e,t){let i=this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(j);return!i.isNull()&&!i.isError()}isExistMotionFadeIn(e,t){let i=this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(O);return!i.isNull()&&!i.isError()}isExistMotionFadeOut(e,t){let i=this._jsonValue.at(2).getValueByString(e).getValueByIndex(t).getValueByString(z);return!i.isNull()&&!i.isError()}isExistUserDataFile(){let e=this.getJson().getRoot().getValueByString(A).getValueByString(L);return!e.isNull()&&!e.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let e=0;e<this._jsonValue.at(0).getSize();++e)if(this._jsonValue.at(0).getValueByIndex(e).getValueByString(D).getRawString()==X)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let e=0;e<this._jsonValue.at(0).getSize();++e)if(this._jsonValue.at(0).getValueByIndex(e).getValueByString(D).getRawString()==U)return!0;return!1}constructor(e,t){super(),this._json=F._3.create(e,t),this.getJson()&&(this._jsonValue=new T.tG,this._jsonValue.pushBack(this.getJson().getRoot().getValueByString("Groups")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(A).getValueByString("Moc")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(A).getValueByString("Motions")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(A).getValueByString("Expressions")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(A).getValueByString("Textures")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(A).getValueByString("Physics")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString(A).getValueByString("Pose")),this._jsonValue.pushBack(this.getJson().getRoot().getValueByString("HitAreas")))}}(h||(h={})).CubismModelSettingJson=G;class H{static create(){return new H}static delete(e){null!=e&&(e=null)}setParameters(e){this._breathParameters=e}getParameters(){return this._breathParameters}updateParameters(e,t){this._currentTime+=t;let i=2*this._currentTime*3.14159;for(let t=0;t<this._breathParameters.getSize();++t){let r=this._breathParameters.at(t);e.addParameterValueById(r.parameterId,r.offset+r.peak*Math.sin(i/r.cycle),r.weight)}}constructor(){this._currentTime=0}}class W{constructor(e,t,i,r,s){this.parameterId=void 0==e?null:e,this.offset=void 0==t?0:t,this.peak=void 0==i?0:i,this.cycle=void 0==r?0:r,this.weight=void 0==s?0:s}}!function(e){e.BreathParameterData=W,e.CubismBreath=H}(d||(d={}));class q{static create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new q(e)}static delete(e){null!=e&&(e=null)}setBlinkingInterval(e){this._blinkingIntervalSeconds=e}setBlinkingSetting(e,t,i){this._closingSeconds=e,this._closedSeconds=t,this._openingSeconds=i}setParameterIds(e){this._parameterIds=e}getParameterIds(){return this._parameterIds}updateParameters(e,t){let i;this._userTimeSeconds+=t;let r=0;switch(this._blinkingState){case 2:(r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds)>=1&&(r=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-r;break;case 3:(r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds)>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case 4:(r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds)>=1&&(r=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=r;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1}q.CloseIfZero||(i=-i);for(let t=0;t<this._parameterIds.getSize();++t)e.setParameterValueById(this._parameterIds.at(t),i)}determinNextBlinkingTiming(){let e=Math.random();return this._userTimeSeconds+e*(2*this._blinkingIntervalSeconds-1)}constructor(e){if(this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new T.tG,null==e)return;for(let t=0;t<e.getEyeBlinkParameterCount();++t)this._parameterIds.pushBack(e.getEyeBlinkParameterId(t))}}q.CloseIfZero=!0;var J=function(e){return e[e.EyeState_First=0]="EyeState_First",e[e.EyeState_Interval=1]="EyeState_Interval",e[e.EyeState_Closing=2]="EyeState_Closing",e[e.EyeState_Closed=3]="EyeState_Closed",e[e.EyeState_Opening=4]="EyeState_Opening",e}({});!function(e){e.CubismEyeBlink=q,e.EyeState=J}(c||(c={}));let K="FadeInTime",Z="Link";class Q{static create(e,t){let i=F._3.create(e,t);if(!i)return null;let r=new Q,s=i.getRoot();!s.getValueByString(K).isNull()&&(r._fadeTimeSeconds=s.getValueByString(K).toFloat(.5),r._fadeTimeSeconds<=0&&(r._fadeTimeSeconds=.5));let a=s.getValueByString("Groups"),n=a.getSize();for(let e=0;e<n;++e){let t=a.getValueByIndex(e),i=t.getSize(),s=0;for(let e=0;e<i;++e){let i=t.getValueByIndex(e),a=new $;if(a.partId=k.MN.getIdManager().getId(i.getValueByString("Id").getRawString()),!i.getValueByString(Z).isNull()){let e=i.getValueByString(Z),t=e.getSize();for(let i=0;i<t;++i){let t=new $;t.partId=k.MN.getIdManager().getId(e.getValueByIndex(i).getString()),a.link.pushBack(t)}}r._partGroups.pushBack(a.clone()),++s}r._partGroupCounts.pushBack(s)}return F._3.delete(i),r}static delete(e){null!=e&&(e=null)}updateParameters(e,t){e!=this._lastModel&&this.reset(e),this._lastModel=e,t<0&&(t=0);let i=0;for(let r=0;r<this._partGroupCounts.getSize();r++){let s=this._partGroupCounts.at(r);this.doFade(e,t,i,s),i+=s}this.copyPartOpacities(e)}reset(e){let t=0;for(let i=0;i<this._partGroupCounts.getSize();++i){let r=this._partGroupCounts.at(i);for(let i=t;i<t+r;++i){this._partGroups.at(i).initialize(e);let r=this._partGroups.at(i).partIndex,s=this._partGroups.at(i).parameterIndex;if(!(r<0)){e.setPartOpacityByIndex(r,+(i==t)),e.setParameterValueByIndex(s,+(i==t));for(let t=0;t<this._partGroups.at(i).link.getSize();++t)this._partGroups.at(i).link.at(t).initialize(e)}}t+=r}}copyPartOpacities(e){for(let t=0;t<this._partGroups.getSize();++t){let i=this._partGroups.at(t);if(0==i.link.getSize())continue;let r=this._partGroups.at(t).partIndex,s=e.getPartOpacityByIndex(r);for(let t=0;t<i.link.getSize();++t){let r=i.link.at(t).partIndex;r<0||e.setPartOpacityByIndex(r,s)}}}doFade(e,t,i,r){let s=-1,a=1;for(let n=i;n<i+r;++n){let i=this._partGroups.at(n).partIndex,r=this._partGroups.at(n).parameterIndex;if(e.getParameterValueByIndex(r)>.001){if(s>=0)break;s=n,(a=e.getPartOpacityByIndex(i)+t/this._fadeTimeSeconds)>1&&(a=1)}}s<0&&(s=0,a=1);for(let t=i;t<i+r;++t){let i=this._partGroups.at(t).partIndex;if(s==t)e.setPartOpacityByIndex(i,a);else{let t,r=e.getPartOpacityByIndex(i);(1-(t=a<.5?-.5*a/.5+1:(1-a)*.5/.5))*(1-a)>.15&&(t=1-.15/(1-a)),r>t&&(r=t),e.setPartOpacityByIndex(i,r)}}}constructor(){this._fadeTimeSeconds=.5,this._lastModel=null,this._partGroups=new T.tG,this._partGroupCounts=new T.tG}}class ${assignment(e){this.partId=e.partId;for(let t=e.link.begin();t.notEqual(e.link.end());t.preIncrement())this.link.pushBack(t.ptr().clone());return this}initialize(e){this.parameterIndex=e.getParameterIndex(this.partId),this.partIndex=e.getPartIndex(this.partId),e.setParameterValueByIndex(this.parameterIndex,1)}clone(){let e=new $;e.partId=this.partId,e.parameterIndex=this.parameterIndex,e.partIndex=this.partIndex,e.link=new T.tG;for(let t=this.link.begin();t.notEqual(this.link.end());t.increment())e.link.pushBack(t.ptr().clone());return e}constructor(e){if(this.parameterIndex=0,this.partIndex=0,this.link=new T.tG,void 0!=e){this.partId=e.partId;for(let t=e.link.begin();t.notEqual(e.link.end());t.preIncrement())this.link.pushBack(t.ptr().clone())}}}!function(e){e.CubismPose=Q,e.PartData=$}(g||(g={}));var ee=i(962);class et extends ee.n{setWidth(e){let t=e/this._width;this.scale(t,t)}setHeight(e){let t=e/this._height;this.scale(t,t)}setPosition(e,t){this.translate(e,t)}setCenterPosition(e,t){this.centerX(e),this.centerY(t)}top(e){this.setY(e)}bottom(e){let t=this._height*this.getScaleY();this.translateY(e-t)}left(e){this.setX(e)}right(e){let t=this._width*this.getScaleX();this.translateX(e-t)}centerX(e){let t=this._width*this.getScaleX();this.translateX(e-t/2)}setX(e){this.translateX(e)}centerY(e){let t=this._height*this.getScaleY();this.translateY(e-t/2)}setY(e){this.translateY(e)}setupFromLayout(e){for(let t=e.begin();t.notEqual(e.end());t.preIncrement()){let e=t.ptr().first,i=t.ptr().second;"width"==e?this.setWidth(i):"height"==e&&this.setHeight(i)}for(let t=e.begin();t.notEqual(e.end());t.preIncrement()){let e=t.ptr().first,i=t.ptr().second;"x"==e?this.setX(i):"y"==e?this.setY(i):"center_x"==e?this.centerX(i):"center_y"==e?this.centerY(i):"top"==e?this.top(i):"bottom"==e?this.bottom(i):"left"==e?this.left(i):"right"==e&&this.right(i)}}constructor(e,t){super(),this._width=void 0!==e?e:0,this._height=void 0!==t?t:0,this.setHeight(2)}}(m||(m={})).CubismModelMatrix=et;var ei=i(6273);class er{update(e){this._userTimeSeconds+=e;if(0==this._lastTimeSeconds){this._lastTimeSeconds=this._userTimeSeconds;return}let t=(this._userTimeSeconds-this._lastTimeSeconds)*30;this._lastTimeSeconds=this._userTimeSeconds;let i=.13333333333333333*t/4.5,r=this._faceTargetX-this._faceX,s=this._faceTargetY-this._faceY;if(.01>=ei.C.abs(r)&&.01>=ei.C.abs(s))return;let a=ei.C.sqrt(r*r+s*s),n=.13333333333333333*r/a,o=.13333333333333333*s/a,l=n-this._faceVX,u=o-this._faceVY,h=ei.C.sqrt(l*l+u*u);(h<-i||h>i)&&(l*=i/h,u*=i/h),this._faceVX+=l,this._faceVY+=u;{let e=.5*(ei.C.sqrt(i*i+16*i*a-8*i*a)-i),t=ei.C.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);t>e&&(this._faceVX*=e/t,this._faceVY*=e/t)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(e,t){this._faceTargetX=e,this._faceTargetY=t}constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}}(_||(_={})).CubismTargetPoint=er;var es=i(3938);let ea="Parameters",en="Blend";class eo extends es.D{static create(e,t){let i=new eo;return i.parse(e,t),i}doUpdateParameters(e,t,i,r){for(let t=0;t<this._parameters.getSize();++t){let r=this._parameters.at(t);switch(r.blendType){case 0:e.addParameterValueById(r.parameterId,r.value,i);break;case 1:e.multiplyParameterValueById(r.parameterId,r.value,i);break;case 2:e.setParameterValueById(r.parameterId,r.value,i)}}}calculateExpressionParameters(e,t,i,r,s,a){if(null!=i&&null!=r&&i.isAvailable()){this._fadeWeight=this.updateFadeWeight(i,t);for(let t=0;t<r.getSize();++t){let i,n,o,l=r.at(t);if(null==l.parameterId)continue;let u=l.overwriteValue=e.getParameterValueById(l.parameterId),h=this.getExpressionParameters(),d=-1;for(let e=0;e<h.getSize();++e)if(l.parameterId==h.at(e).parameterId){d=e;break}if(d<0){0==s?(l.additiveValue=eo.DefaultAdditiveValue,l.multiplyValue=eo.DefaultMultiplyValue,l.overwriteValue=u):(l.additiveValue=this.calculateValue(l.additiveValue,eo.DefaultAdditiveValue,a),l.multiplyValue=this.calculateValue(l.multiplyValue,eo.DefaultMultiplyValue,a),l.overwriteValue=this.calculateValue(l.overwriteValue,u,a));continue}let c=h.at(d).value;switch(h.at(d).blendType){case 0:i=c,n=eo.DefaultMultiplyValue,o=u;break;case 1:i=eo.DefaultAdditiveValue,n=c,o=u;break;case 2:i=eo.DefaultAdditiveValue,n=eo.DefaultMultiplyValue,o=c;break;default:return}0==s?(l.additiveValue=i,l.multiplyValue=n,l.overwriteValue=o):(l.additiveValue=l.additiveValue*(1-a)+i*a,l.multiplyValue=l.multiplyValue*(1-a)+n*a,l.overwriteValue=l.overwriteValue*(1-a)+o*a)}}}getExpressionParameters(){return this._parameters}getFadeWeight(){return this._fadeWeight}parse(e,t){let i=F._3.create(e,t);if(!i)return;let r=i.getRoot();this.setFadeInTime(r.getValueByString("FadeInTime").toFloat(1)),this.setFadeOutTime(r.getValueByString("FadeOutTime").toFloat(1));let s=r.getValueByString(ea).getSize();this._parameters.prepareCapacity(s);for(let e=0;e<s;++e){let t,i=r.getValueByString(ea).getValueByIndex(e),s=k.MN.getIdManager().getId(i.getValueByString("Id").getRawString()),a=i.getValueByString("Value").toFloat();t=i.getValueByString(en).isNull()||"Add"==i.getValueByString(en).getString()?0:"Multiply"==i.getValueByString(en).getString()?1:2*("Overwrite"==i.getValueByString(en).getString());let n=new eu;n.parameterId=s,n.blendType=t,n.value=a,this._parameters.pushBack(n)}F._3.delete(i)}calculateValue(e,t,i){return e*(1-i)+t*i}constructor(){super(),this._parameters=new T.tG,this._fadeWeight=0}}eo.DefaultAdditiveValue=0,eo.DefaultMultiplyValue=1;var el=function(e){return e[e.Additive=0]="Additive",e[e.Multiply=1]="Multiply",e[e.Overwrite=2]="Overwrite",e}({});class eu{}!function(e){e.CubismExpressionMotion=eo,e.ExpressionBlendType=el,e.ExpressionParameter=eu}(p||(p={}));var eh=i(2793);class ed{}class ec extends eh.U1{release(){this._expressionParameterValues&&((0,k.jz)(this._expressionParameterValues),this._expressionParameterValues=null),this._fadeWeights&&((0,k.jz)(this._fadeWeights),this._fadeWeights=null)}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}getFadeWeight(e){return this._fadeWeights.at(e)}setReservePriority(e){this._reservePriority=e}startMotionPriority(e,t,i){return i==this.getReservePriority()&&this.setReservePriority(0),this._currentPriority=i,this._fadeWeights.pushBack(0),this.startMotion(e,t)}updateMotion(e,t){this._userTimeSeconds+=t;let i=!1,r=this.getCubismMotionQueueEntries(),s=0,a=0;for(let t=this._motions.begin();t.notEqual(this._motions.end());){let n=t.ptr();if(null==n){t=r.erase(t);continue}let o=n.getCubismMotion();if(null==o){(0,k.jz)(n),t=r.erase(t);continue}let l=o.getExpressionParameters();if(n.isAvailable())for(let t=0;t<l.getSize();++t){if(null==l.at(t).parameterId)continue;let i=-1;for(let e=0;e<this._expressionParameterValues.getSize();++e)if(this._expressionParameterValues.at(e).parameterId==l.at(t).parameterId){i=e;break}if(i>=0)continue;let r=new ed;r.parameterId=l.at(t).parameterId,r.additiveValue=eo.DefaultAdditiveValue,r.multiplyValue=eo.DefaultMultiplyValue,r.overwriteValue=e.getParameterValueById(r.parameterId),this._expressionParameterValues.pushBack(r)}o.setupMotionQueueEntry(n,this._userTimeSeconds),this._fadeWeights.set(a,o.updateFadeWeight(n,this._userTimeSeconds)),o.calculateExpressionParameters(e,this._userTimeSeconds,n,this._expressionParameterValues,a,this._fadeWeights.at(a)),s+=0==o.getFadeInTime()?1:ei.C.getEasingSine((this._userTimeSeconds-n.getFadeInStartTime())/o.getFadeInTime()),i=!0,n.isTriggeredFadeOut()&&n.startFadeOut(n.getFadeOutSeconds(),this._userTimeSeconds),t.preIncrement(),++a}if(r.getSize()>1&&(r.at(r.getSize()-1).getCubismMotion(),this._fadeWeights.at(this._fadeWeights.getSize()-1)>=1))for(let e=r.getSize()-2;e>=0;--e){let t=r.at(e);(0,k.jz)(t),r.remove(e),this._fadeWeights.remove(e)}s>1&&(s=1);for(let t=0;t<this._expressionParameterValues.getSize();++t){let i=this._expressionParameterValues.at(t);e.setParameterValueById(i.parameterId,(i.overwriteValue+i.additiveValue)*i.multiplyValue,s),i.additiveValue=eo.DefaultAdditiveValue,i.multiplyValue=eo.DefaultMultiplyValue}return i}constructor(){super(),this._currentPriority=0,this._reservePriority=0,this._expressionParameterValues=new T.tG,this._fadeWeights=new T.tG}}(f||(f={})).CubismExpressionMotionManager=ec;var eg=i(5943),em=i(5626),e_=function(e){return e[e.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",e[e.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",e[e.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",e}({}),ep=function(e){return e[e.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",e[e.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",e[e.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",e[e.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",e}({});class ef{constructor(){this.time=0,this.value=0}}class ex{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class ey{constructor(){this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class eb{constructor(){this.fireTime=0}}class ev{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new T.tG,this.segments=new T.tG,this.points=new T.tG,this.events=new T.tG}}!function(e){e.CubismMotionCurve=ey,e.CubismMotionCurveTarget=e_,e.CubismMotionData=ev,e.CubismMotionEvent=eb,e.CubismMotionPoint=ef,e.CubismMotionSegment=ex,e.CubismMotionSegmentType=ep}(x||(x={}));let eS="Meta",eC="Curves",ew="FadeInTime",eM="FadeOutTime",eP="Segments",eB="UserData";class eI{release(){F._3.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(eS).getValueByString("Duration").toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(eS).getValueByString("Loop").toBoolean()}getEvaluationOptionFlag(e){return 0==e&&this._json.getRoot().getValueByString(eS).getValueByString("AreBeziersRestricted").toBoolean()}getMotionCurveCount(){return this._json.getRoot().getValueByString(eS).getValueByString("CurveCount").toInt()}getMotionFps(){return this._json.getRoot().getValueByString(eS).getValueByString("Fps").toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(eS).getValueByString("TotalSegmentCount").toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(eS).getValueByString("TotalPointCount").toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(eS).getValueByString(ew).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(eS).getValueByString(eM).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(eS).getValueByString(ew).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(eS).getValueByString(eM).toFloat()}getMotionCurveTarget(e){return this._json.getRoot().getValueByString(eC).getValueByIndex(e).getValueByString("Target").getRawString()}getMotionCurveId(e){return k.MN.getIdManager().getId(this._json.getRoot().getValueByString(eC).getValueByIndex(e).getValueByString("Id").getRawString())}isExistMotionCurveFadeInTime(e){return!this._json.getRoot().getValueByString(eC).getValueByIndex(e).getValueByString(ew).isNull()}isExistMotionCurveFadeOutTime(e){return!this._json.getRoot().getValueByString(eC).getValueByIndex(e).getValueByString(eM).isNull()}getMotionCurveFadeInTime(e){return this._json.getRoot().getValueByString(eC).getValueByIndex(e).getValueByString(ew).toFloat()}getMotionCurveFadeOutTime(e){return this._json.getRoot().getValueByString(eC).getValueByIndex(e).getValueByString(eM).toFloat()}getMotionCurveSegmentCount(e){return this._json.getRoot().getValueByString(eC).getValueByIndex(e).getValueByString(eP).getVector().getSize()}getMotionCurveSegment(e,t){return this._json.getRoot().getValueByString(eC).getValueByIndex(e).getValueByString(eP).getValueByIndex(t).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(eS).getValueByString("UserDataCount").toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(eS).getValueByString("TotalUserDataSize").toInt()}getEventTime(e){return this._json.getRoot().getValueByString(eB).getValueByIndex(e).getValueByString("Time").toFloat()}getEventValue(e){return new eg.F(this._json.getRoot().getValueByString(eB).getValueByIndex(e).getValueByString("Value").getRawString())}constructor(e,t){this._json=F._3.create(e,t)}}var eE=function(e){return e[e.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",e}({});(y||(y={})).CubismMotionJson=eI;let eV="Opacity";function eR(e,t,i){let r=new ef;return r.time=e.time+(t.time-e.time)*i,r.value=e.value+(t.value-e.value)*i,r}function ek(e,t){let i=(t-e[0].time)/(e[1].time-e[0].time);return i<0&&(i=0),e[0].value+(e[1].value-e[0].value)*i}function eT(e,t){let i=(t-e[0].time)/(e[3].time-e[0].time);i<0&&(i=0);let r=eR(e[0],e[1],i),s=eR(e[1],e[2],i),a=eR(e[2],e[3],i),n=eR(r,s,i),o=eR(s,a,i);return eR(n,o,i).value}function eF(e,t){let i=e[0].time,r=e[3].time,s=e[1].time,a=e[2].time,n=ei.C.cardanoAlgorithmForBezier(r-3*a+3*s-i,3*a-6*s+3*i,3*s-3*i,i-t),o=eR(e[0],e[1],n),l=eR(e[1],e[2],n),u=eR(e[2],e[3],n),h=eR(o,l,n),d=eR(l,u,n);return eR(h,d,n).value}function eA(e,t){return e[0].value}function eL(e,t){return e[1].value}function eD(e,t,i){let r=e.curves.at(t),s=-1,a=r.baseSegmentIndex+r.segmentCount,n=0;for(let t=r.baseSegmentIndex;t<a;++t)if(n=e.segments.at(t).basePointIndex+(e.segments.at(t).segmentType==ep.CubismMotionSegmentType_Bezier?3:1),e.points.at(n).time>i){s=t;break}if(-1==s)return e.points.at(n).value;let o=e.segments.at(s);return o.evaluate(e.points.get(o.basePointIndex),i)}class eN extends es.D{static create(e,t,i){let r=new eN;return r.parse(e,t),r._sourceFrameRate=r._motionData.fps,r._loopDurationSeconds=r._motionData.duration,r._onFinishedMotion=i,r}doUpdateParameters(e,t,i,r){let s,a,n;null==this._modelCurveIdEyeBlink&&(this._modelCurveIdEyeBlink=k.MN.getIdManager().getId("EyeBlink")),null==this._modelCurveIdLipSync&&(this._modelCurveIdLipSync=k.MN.getIdManager().getId("LipSync")),null==this._modelCurveIdOpacity&&(this._modelCurveIdOpacity=k.MN.getIdManager().getId(eV));let o=t-r.getStartTime();o<0&&(o=0);let l=Number.MAX_VALUE,u=Number.MAX_VALUE,h=0,d=0;this._eyeBlinkParameterIds.getSize()>64&&(0,em.XH)("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>64&&(0,em.XH)("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());let c=this._fadeInSeconds<=0?1:ei.C.getEasingSine((t-r.getFadeInStartTime())/this._fadeInSeconds),g=this._fadeOutSeconds<=0||0>r.getEndTime()?1:ei.C.getEasingSine((r.getEndTime()-t)/this._fadeOutSeconds),m=o;if(this._isLoop)for(;m>this._motionData.duration;)m-=this._motionData.duration;let _=this._motionData.curves;for(a=0;a<this._motionData.curveCount&&_.at(a).type==e_.CubismMotionCurveTarget_Model;++a)s=eD(this._motionData,a,m),_.at(a).id==this._modelCurveIdEyeBlink?u=s:_.at(a).id==this._modelCurveIdLipSync?l=s:_.at(a).id==this._modelCurveIdOpacity&&(this._modelOpacity=s,e.setModelOapcity(this.getModelOpacityValue()));for(;a<this._motionData.curveCount&&_.at(a).type==e_.CubismMotionCurveTarget_Parameter;++a){let o;if(-1==(n=e.getParameterIndex(_.at(a).id)))continue;let p=e.getParameterValueByIndex(n);if(s=eD(this._motionData,a,m),u!=Number.MAX_VALUE){for(let e=0;e<this._eyeBlinkParameterIds.getSize()&&e<64;++e)if(this._eyeBlinkParameterIds.at(e)==_.at(a).id){s*=u,d|=1<<e;break}}if(l!=Number.MAX_VALUE){for(let e=0;e<this._lipSyncParameterIds.getSize()&&e<64;++e)if(this._lipSyncParameterIds.at(e)==_.at(a).id){s+=l,h|=1<<e;break}}if(_.at(a).fadeInTime<0&&_.at(a).fadeOutTime<0)o=p+(s-p)*i;else{let e,i;e=_.at(a).fadeInTime<0?c:0==_.at(a).fadeInTime?1:ei.C.getEasingSine((t-r.getFadeInStartTime())/_.at(a).fadeInTime),i=_.at(a).fadeOutTime<0?g:0==_.at(a).fadeOutTime||0>r.getEndTime()?1:ei.C.getEasingSine((r.getEndTime()-t)/_.at(a).fadeOutTime),o=p+(s-p)*(this._weight*e*i)}e.setParameterValueByIndex(n,o,1)}if(u!=Number.MAX_VALUE)for(let t=0;t<this._eyeBlinkParameterIds.getSize()&&t<64;++t){let r=e.getParameterValueById(this._eyeBlinkParameterIds.at(t));if(d>>t&1)continue;let s=r+(u-r)*i;e.setParameterValueById(this._eyeBlinkParameterIds.at(t),s)}if(l!=Number.MAX_VALUE)for(let t=0;t<this._lipSyncParameterIds.getSize()&&t<64;++t){let r=e.getParameterValueById(this._lipSyncParameterIds.at(t));if(h>>t&1)continue;let s=r+(l-r)*i;e.setParameterValueById(this._lipSyncParameterIds.at(t),s)}for(;a<this._motionData.curveCount&&_.at(a).type==e_.CubismMotionCurveTarget_PartOpacity;++a)-1!=(n=e.getParameterIndex(_.at(a).id))&&(s=eD(this._motionData,a,m),e.setParameterValueByIndex(n,s));o>=this._motionData.duration&&(this._isLoop?(r.setStartTime(t),this._isLoopFadeIn&&r.setFadeInStartTime(t)):(this._onFinishedMotion&&this._onFinishedMotion(this),r.setIsFinished(!0))),this._lastWeight=i}setIsLoop(e){this._isLoop=e}isLoop(){return this._isLoop}setIsLoopFadeIn(e){this._isLoopFadeIn=e}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(e,t){let i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(e==i.at(r).id){i.at(r).fadeInTime=t;return}}setParameterFadeOutTime(e,t){let i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(e==i.at(r).id){i.at(r).fadeOutTime=t;return}}getParameterFadeInTime(e){let t=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(e==t.at(i).id)return t.at(i).fadeInTime;return -1}getParameterFadeOutTime(e){let t=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(e==t.at(i).id)return t.at(i).fadeOutTime;return -1}setEffectIds(e,t){this._eyeBlinkParameterIds=e,this._lipSyncParameterIds=t}release(){this._motionData=void 0,this._motionData=null}parse(e,t){this._motionData=new ev;let i=new eI(e,t);if(!i){i.release(),i=void 0;return}this._motionData.duration=i.getMotionDuration(),this._motionData.loop=i.isMotionLoop(),this._motionData.curveCount=i.getMotionCurveCount(),this._motionData.fps=i.getMotionFps(),this._motionData.eventCount=i.getEventCount();let r=i.getEvaluationOptionFlag(eE.EvaluationOptionFlag_AreBeziersRistricted);i.isExistMotionFadeInTime()?this._fadeInSeconds=0>i.getMotionFadeInTime()?1:i.getMotionFadeInTime():this._fadeInSeconds=1,i.isExistMotionFadeOutTime()?this._fadeOutSeconds=0>i.getMotionFadeOutTime()?1:i.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,ey,!0),this._motionData.segments.updateSize(i.getMotionTotalSegmentCount(),ex,!0),this._motionData.points.updateSize(i.getMotionTotalPointCount(),ef,!0),this._motionData.events.updateSize(this._motionData.eventCount,eb,!0);let s=0,a=0;for(let e=0;e<this._motionData.curveCount;++e){"Model"==i.getMotionCurveTarget(e)?this._motionData.curves.at(e).type=e_.CubismMotionCurveTarget_Model:"Parameter"==i.getMotionCurveTarget(e)?this._motionData.curves.at(e).type=e_.CubismMotionCurveTarget_Parameter:"PartOpacity"==i.getMotionCurveTarget(e)?this._motionData.curves.at(e).type=e_.CubismMotionCurveTarget_PartOpacity:(0,em.E2)('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!'),this._motionData.curves.at(e).id=i.getMotionCurveId(e),this._motionData.curves.at(e).baseSegmentIndex=a,this._motionData.curves.at(e).fadeInTime=i.isExistMotionCurveFadeInTime(e)?i.getMotionCurveFadeInTime(e):-1,this._motionData.curves.at(e).fadeOutTime=i.isExistMotionCurveFadeOutTime(e)?i.getMotionCurveFadeOutTime(e):-1;for(let t=0;t<i.getMotionCurveSegmentCount(e);){switch(0==t?(this._motionData.segments.at(a).basePointIndex=s,this._motionData.points.at(s).time=i.getMotionCurveSegment(e,t),this._motionData.points.at(s).value=i.getMotionCurveSegment(e,t+1),s+=1,t+=2):this._motionData.segments.at(a).basePointIndex=s-1,i.getMotionCurveSegment(e,t)){case ep.CubismMotionSegmentType_Linear:this._motionData.segments.at(a).segmentType=ep.CubismMotionSegmentType_Linear,this._motionData.segments.at(a).evaluate=ek,this._motionData.points.at(s).time=i.getMotionCurveSegment(e,t+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(e,t+2),s+=1,t+=3;break;case ep.CubismMotionSegmentType_Bezier:this._motionData.segments.at(a).segmentType=ep.CubismMotionSegmentType_Bezier,r?this._motionData.segments.at(a).evaluate=eT:this._motionData.segments.at(a).evaluate=eF,this._motionData.points.at(s).time=i.getMotionCurveSegment(e,t+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(e,t+2),this._motionData.points.at(s+1).time=i.getMotionCurveSegment(e,t+3),this._motionData.points.at(s+1).value=i.getMotionCurveSegment(e,t+4),this._motionData.points.at(s+2).time=i.getMotionCurveSegment(e,t+5),this._motionData.points.at(s+2).value=i.getMotionCurveSegment(e,t+6),s+=3,t+=7;break;case ep.CubismMotionSegmentType_Stepped:this._motionData.segments.at(a).segmentType=ep.CubismMotionSegmentType_Stepped,this._motionData.segments.at(a).evaluate=eA,this._motionData.points.at(s).time=i.getMotionCurveSegment(e,t+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(e,t+2),s+=1,t+=3;break;case ep.CubismMotionSegmentType_InverseStepped:this._motionData.segments.at(a).segmentType=ep.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(a).evaluate=eL,this._motionData.points.at(s).time=i.getMotionCurveSegment(e,t+1),this._motionData.points.at(s).value=i.getMotionCurveSegment(e,t+2),s+=1,t+=3;break;default:(0,em.vT)(0)}++this._motionData.curves.at(e).segmentCount,++a}}for(let e=0;e<i.getEventCount();++e)this._motionData.events.at(e).fireTime=i.getEventTime(e),this._motionData.events.at(e).value=i.getEventValue(e);i.release()}getFiredEvent(e,t){this._firedEventValues.updateSize(0);for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>e&&this._motionData.events.at(i).fireTime<=t&&this._firedEventValues.pushBack(new eg.F(this._motionData.events.at(i).value.s));return this._firedEventValues}isExistModelOpacity(){for(let e=0;e<this._motionData.curveCount;e++){let t=this._motionData.curves.at(e);if(t.type==e_.CubismMotionCurveTarget_Model&&0==t.id.getString().s.localeCompare(eV))return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let e=0;e<this._motionData.curveCount;e++){let t=this._motionData.curves.at(e);if(t.type==e_.CubismMotionCurveTarget_Model&&0==t.id.getString().s.localeCompare(eV))return e}return -1}getModelOpacityId(e){if(-1!=e){let t=this._motionData.curves.at(e);if(t.type==e_.CubismMotionCurveTarget_Model&&0==t.id.getString().s.localeCompare(eV))return k.MN.getIdManager().getId(t.id.getString().s)}return null}getModelOpacityValue(){return this._modelOpacity}constructor(){super(),this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._modelCurveIdOpacity=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null,this._modelOpacity=1}}(b||(b={})).CubismMotion=eN;class ej extends eh.U1{getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(e){this._reservePriority=e}startMotionPriority(e,t,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(e,t)}updateMotion(e,t){this._userTimeSeconds+=t;let i=super.doUpdateMotion(e,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),i}reserveMotion(e){return!(e<=this._reservePriority)&&!(e<=this._currentPriority)&&(this._reservePriority=e,!0)}constructor(){super(),this._currentPriority=0,this._reservePriority=0}}(v||(v={})).CubismMotionManager=ej;var eO=i(4242),ez=function(e){return e[e.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",e}({}),eU=function(e){return e[e.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",e[e.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",e[e.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",e}({});class eX{constructor(){this.gravity=new eO.r(0,0),this.wind=new eO.r(0,0)}}class eY{}class eG{}class eH{constructor(){this.initialPosition=new eO.r(0,0),this.position=new eO.r(0,0),this.lastPosition=new eO.r(0,0),this.lastGravity=new eO.r(0,0),this.force=new eO.r(0,0),this.velocity=new eO.r(0,0)}}class eW{constructor(){this.normalizationPosition=new eG,this.normalizationAngle=new eG}}class eq{constructor(){this.source=new eY}}class eJ{constructor(){this.destination=new eY,this.translationScale=new eO.r(0,0)}}class eK{constructor(){this.settings=new T.tG,this.inputs=new T.tG,this.outputs=new T.tG,this.particles=new T.tG,this.gravity=new eO.r(0,0),this.wind=new eO.r(0,0),this.fps=0}}!function(e){e.CubismPhysicsInput=eq,e.CubismPhysicsNormalization=eG,e.CubismPhysicsOutput=eJ,e.CubismPhysicsParameter=eY,e.CubismPhysicsParticle=eH,e.CubismPhysicsRig=eK,e.CubismPhysicsSource=eU,e.CubismPhysicsSubRig=eW,e.CubismPhysicsTargetType=ez,e.PhysicsJsonEffectiveForces=eX}(S||(S={}));let eZ="Position",eQ="Angle",e$="Type",e0="Meta",e1="EffectiveForces",e2="Gravity",e3="Wind",e5="PhysicsSettings",e4="Normalization",e6="Minimum",e8="Maximum",e7="Default",e9="Reflect",te="Weight",tt="Input",ti="Output",tr="Vertices";class ts{release(){F._3.delete(this._json)}getGravity(){let e=new eO.r(0,0);return e.x=this._json.getRoot().getValueByString(e0).getValueByString(e1).getValueByString(e2).getValueByString("X").toFloat(),e.y=this._json.getRoot().getValueByString(e0).getValueByString(e1).getValueByString(e2).getValueByString("Y").toFloat(),e}getWind(){let e=new eO.r(0,0);return e.x=this._json.getRoot().getValueByString(e0).getValueByString(e1).getValueByString(e3).getValueByString("X").toFloat(),e.y=this._json.getRoot().getValueByString(e0).getValueByString(e1).getValueByString(e3).getValueByString("Y").toFloat(),e}getFps(){return this._json.getRoot().getValueByString(e0).getValueByString("Fps").toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(e0).getValueByString("PhysicsSettingCount").toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(e0).getValueByString("TotalInputCount").toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(e0).getValueByString("TotalOutputCount").toInt()}getVertexCount(){return this._json.getRoot().getValueByString(e0).getValueByString("VertexCount").toInt()}getNormalizationPositionMinimumValue(e){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(e4).getValueByString(eZ).getValueByString(e6).toFloat()}getNormalizationPositionMaximumValue(e){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(e4).getValueByString(eZ).getValueByString(e8).toFloat()}getNormalizationPositionDefaultValue(e){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(e4).getValueByString(eZ).getValueByString(e7).toFloat()}getNormalizationAngleMinimumValue(e){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(e4).getValueByString(eQ).getValueByString(e6).toFloat()}getNormalizationAngleMaximumValue(e){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(e4).getValueByString(eQ).getValueByString(e8).toFloat()}getNormalizationAngleDefaultValue(e){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(e4).getValueByString(eQ).getValueByString(e7).toFloat()}getInputCount(e){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(tt).getVector().getSize()}getInputWeight(e,t){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(tt).getValueByIndex(t).getValueByString(te).toFloat()}getInputReflect(e,t){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(tt).getValueByIndex(t).getValueByString(e9).toBoolean()}getInputType(e,t){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(tt).getValueByIndex(t).getValueByString(e$).getRawString()}getInputSourceId(e,t){return k.MN.getIdManager().getId(this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(tt).getValueByIndex(t).getValueByString("Source").getValueByString("Id").getRawString())}getOutputCount(e){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(ti).getVector().getSize()}getOutputVertexIndex(e,t){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(ti).getValueByIndex(t).getValueByString("VertexIndex").toInt()}getOutputAngleScale(e,t){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(ti).getValueByIndex(t).getValueByString("Scale").toFloat()}getOutputWeight(e,t){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(ti).getValueByIndex(t).getValueByString(te).toFloat()}getOutputDestinationId(e,t){return k.MN.getIdManager().getId(this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(ti).getValueByIndex(t).getValueByString("Destination").getValueByString("Id").getRawString())}getOutputType(e,t){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(ti).getValueByIndex(t).getValueByString(e$).getRawString()}getOutputReflect(e,t){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(ti).getValueByIndex(t).getValueByString(e9).toBoolean()}getParticleCount(e){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(tr).getVector().getSize()}getParticleMobility(e,t){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(tr).getValueByIndex(t).getValueByString("Mobility").toFloat()}getParticleDelay(e,t){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(tr).getValueByIndex(t).getValueByString("Delay").toFloat()}getParticleAcceleration(e,t){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(tr).getValueByIndex(t).getValueByString("Acceleration").toFloat()}getParticleRadius(e,t){return this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(tr).getValueByIndex(t).getValueByString("Radius").toFloat()}getParticlePosition(e,t){let i=new eO.r(0,0);return i.x=this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(tr).getValueByIndex(t).getValueByString(eZ).getValueByString("X").toFloat(),i.y=this._json.getRoot().getValueByString(e5).getValueByIndex(e).getValueByString(tr).getValueByIndex(t).getValueByString(eZ).getValueByString("Y").toFloat(),i}constructor(e,t){this._json=F._3.create(e,t)}}(C||(C={})).CubismPhysicsJson=ts;let ta="Angle";class tn{static create(e,t){let i=new tn;return i.parse(e,t),i._physicsRig.gravity.y=0,i}static delete(e){null!=e&&(e.release(),e=null)}parse(e,t){this._physicsRig=new eK;let i=new ts(e,t);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.fps=i.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,eW,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),eq,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),eJ,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),eH,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear();let r=0,s=0,a=0;for(let e=0;e<this._physicsRig.settings.getSize();++e){this._physicsRig.settings.at(e).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(e),this._physicsRig.settings.at(e).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(e),this._physicsRig.settings.at(e).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(e),this._physicsRig.settings.at(e).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(e),this._physicsRig.settings.at(e).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(e),this._physicsRig.settings.at(e).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(e),this._physicsRig.settings.at(e).inputCount=i.getInputCount(e),this._physicsRig.settings.at(e).baseInputIndex=r;for(let t=0;t<this._physicsRig.settings.at(e).inputCount;++t)this._physicsRig.inputs.at(r+t).sourceParameterIndex=-1,this._physicsRig.inputs.at(r+t).weight=i.getInputWeight(e,t),this._physicsRig.inputs.at(r+t).reflect=i.getInputReflect(e,t),"X"==i.getInputType(e,t)?(this._physicsRig.inputs.at(r+t).type=eU.CubismPhysicsSource_X,this._physicsRig.inputs.at(r+t).getNormalizedParameterValue=tu):"Y"==i.getInputType(e,t)?(this._physicsRig.inputs.at(r+t).type=eU.CubismPhysicsSource_Y,this._physicsRig.inputs.at(r+t).getNormalizedParameterValue=th):i.getInputType(e,t)==ta&&(this._physicsRig.inputs.at(r+t).type=eU.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(r+t).getNormalizedParameterValue=td),this._physicsRig.inputs.at(r+t).source.targetType=ez.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(r+t).source.id=i.getInputSourceId(e,t);r+=this._physicsRig.settings.at(e).inputCount,this._physicsRig.settings.at(e).outputCount=i.getOutputCount(e),this._physicsRig.settings.at(e).baseOutputIndex=s;let t=new tl;t.outputs.resize(this._physicsRig.settings.at(e).outputCount);let n=new tl;n.outputs.resize(this._physicsRig.settings.at(e).outputCount);for(let r=0;r<this._physicsRig.settings.at(e).outputCount;++r)t.outputs.set(r,0),n.outputs.set(r,0),this._physicsRig.outputs.at(s+r).destinationParameterIndex=-1,this._physicsRig.outputs.at(s+r).vertexIndex=i.getOutputVertexIndex(e,r),this._physicsRig.outputs.at(s+r).angleScale=i.getOutputAngleScale(e,r),this._physicsRig.outputs.at(s+r).weight=i.getOutputWeight(e,r),this._physicsRig.outputs.at(s+r).destination.targetType=ez.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(s+r).destination.id=i.getOutputDestinationId(e,r),"X"==i.getOutputType(e,r)?(this._physicsRig.outputs.at(s+r).type=eU.CubismPhysicsSource_X,this._physicsRig.outputs.at(s+r).getValue=tc,this._physicsRig.outputs.at(s+r).getScale=t_):"Y"==i.getOutputType(e,r)?(this._physicsRig.outputs.at(s+r).type=eU.CubismPhysicsSource_Y,this._physicsRig.outputs.at(s+r).getValue=tg,this._physicsRig.outputs.at(s+r).getScale=tp):i.getOutputType(e,r)==ta&&(this._physicsRig.outputs.at(s+r).type=eU.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(s+r).getValue=tm,this._physicsRig.outputs.at(s+r).getScale=tf),this._physicsRig.outputs.at(s+r).reflect=i.getOutputReflect(e,r);this._currentRigOutputs.pushBack(t),this._previousRigOutputs.pushBack(n),s+=this._physicsRig.settings.at(e).outputCount,this._physicsRig.settings.at(e).particleCount=i.getParticleCount(e),this._physicsRig.settings.at(e).baseParticleIndex=a;for(let t=0;t<this._physicsRig.settings.at(e).particleCount;++t)this._physicsRig.particles.at(a+t).mobility=i.getParticleMobility(e,t),this._physicsRig.particles.at(a+t).delay=i.getParticleDelay(e,t),this._physicsRig.particles.at(a+t).acceleration=i.getParticleAcceleration(e,t),this._physicsRig.particles.at(a+t).radius=i.getParticleRadius(e,t),this._physicsRig.particles.at(a+t).position=i.getParticlePosition(e,t);a+=this._physicsRig.settings.at(e).particleCount}this.initialize(),i.release()}stabilization(e){var t,i,r,s;let a,n,o,l,u,h,d,c,g=new eO.r,m=e.getModel().parameters.values,_=e.getModel().parameters.maximumValues,p=e.getModel().parameters.minimumValues,f=e.getModel().parameters.defaultValues;(null!=(r=null==(t=this._parameterCaches)?void 0:t.length)?r:0)<e.getParameterCount()&&(this._parameterCaches=new Float32Array(e.getParameterCount())),(null!=(s=null==(i=this._parameterInputCaches)?void 0:i.length)?s:0)<e.getParameterCount()&&(this._parameterInputCaches=new Float32Array(e.getParameterCount()));for(let t=0;t<e.getParameterCount();++t)this._parameterCaches[t]=m[t],this._parameterInputCaches[t]=m[t];for(let t=0;t<this._physicsRig.subRigCount;++t){a={angle:0},g.x=0,g.y=0,u=this._physicsRig.settings.at(t),h=this._physicsRig.inputs.get(u.baseInputIndex),d=this._physicsRig.outputs.get(u.baseOutputIndex),c=this._physicsRig.particles.get(u.baseParticleIndex);for(let t=0;t<u.inputCount;++t)n=h[t].weight/100,-1==h[t].sourceParameterIndex&&(h[t].sourceParameterIndex=e.getParameterIndex(h[t].source.id)),h[t].getNormalizedParameterValue(g,a,m[h[t].sourceParameterIndex],p[h[t].sourceParameterIndex],_[h[t].sourceParameterIndex],f[h[t].sourceParameterIndex],u.normalizationPosition,u.normalizationAngle,h[t].reflect,n),this._parameterCaches[h[t].sourceParameterIndex]=m[h[t].sourceParameterIndex];o=ei.C.degreesToRadian(-a.angle),g.x=g.x*ei.C.cos(o)-g.y*ei.C.sin(o),g.y=g.x*ei.C.sin(o)+g.y*ei.C.cos(o),function(e,t,i,r,s,a){let n=new eO.r(0,0);e[0].position=new eO.r(i.x,i.y);let o=ei.C.degreesToRadian(r),l=ei.C.radianToDirection(o);l.normalize();for(let i=1;i<t;++i)e[i].force=l.multiplyByScaler(e[i].acceleration).add(s),e[i].lastPosition=new eO.r(e[i].position.x,e[i].position.y),e[i].velocity=new eO.r(0,0),(n=e[i].force).normalize(),n=n.multiplyByScaler(e[i].radius),e[i].position=e[i-1].position.add(n),ei.C.abs(e[i].position.x)<a&&(e[i].position.x=0),e[i].force=new eO.r(0,0),e[i].lastGravity=new eO.r(l.x,l.y)}(c,u.particleCount,g,a.angle,this._options.wind,.001*u.normalizationPosition.maximum);for(let i=0;i<u.outputCount;++i){let r=d[i].vertexIndex;if(-1==d[i].destinationParameterIndex&&(d[i].destinationParameterIndex=e.getParameterIndex(d[i].destination.id)),r<1||r>=u.particleCount)continue;let s=new eO.r;s=c[r].position.substract(c[r-1].position),l=d[i].getValue(s,c,r,d[i].reflect,this._options.gravity),this._currentRigOutputs.at(t).outputs.set(i,l),this._previousRigOutputs.at(t).outputs.set(i,l);let a=d[i].destinationParameterIndex,n=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(m.subarray(a))):m.slice(a);tx(n,p[a],_[a],l,d[i]);for(let e=a,t=0;e<this._parameterCaches.length;e++,t++)m[e]=this._parameterCaches[e]=n[t]}}}evaluate(e,t){var i,r,s,a;let n,o,l,u,h,d,c,g,m,_=new eO.r;if(0>=t)return;let p=e.getModel().parameters.values,f=e.getModel().parameters.maximumValues,x=e.getModel().parameters.minimumValues,y=e.getModel().parameters.defaultValues;if(this._currentRemainTime+=t,this._currentRemainTime>5&&(this._currentRemainTime=0),(null!=(s=null==(i=this._parameterCaches)?void 0:i.length)?s:0)<e.getParameterCount()&&(this._parameterCaches=new Float32Array(e.getParameterCount())),(null!=(a=null==(r=this._parameterInputCaches)?void 0:r.length)?a:0)<e.getParameterCount()){this._parameterInputCaches=new Float32Array(e.getParameterCount());for(let t=0;t<e.getParameterCount();++t)this._parameterInputCaches[t]=p[t]}for(m=this._physicsRig.fps>0?1/this._physicsRig.fps:t;this._currentRemainTime>=m;){for(let e=0;e<this._physicsRig.subRigCount;++e){h=this._physicsRig.settings.at(e),c=this._physicsRig.outputs.get(h.baseOutputIndex);for(let t=0;t<h.outputCount;++t)this._previousRigOutputs.at(e).outputs.set(t,this._currentRigOutputs.at(e).outputs.at(t))}let t=m/this._currentRemainTime;for(let i=0;i<e.getParameterCount();++i)this._parameterCaches[i]=this._parameterInputCaches[i]*(1-t)+p[i]*t,this._parameterInputCaches[i]=this._parameterCaches[i];for(let t=0;t<this._physicsRig.subRigCount;++t){n={angle:0},_.x=0,_.y=0,h=this._physicsRig.settings.at(t),d=this._physicsRig.inputs.get(h.baseInputIndex),c=this._physicsRig.outputs.get(h.baseOutputIndex),g=this._physicsRig.particles.get(h.baseParticleIndex);for(let t=0;t<h.inputCount;++t)o=d[t].weight/100,-1==d[t].sourceParameterIndex&&(d[t].sourceParameterIndex=e.getParameterIndex(d[t].source.id)),d[t].getNormalizedParameterValue(_,n,this._parameterCaches[d[t].sourceParameterIndex],x[d[t].sourceParameterIndex],f[d[t].sourceParameterIndex],y[d[t].sourceParameterIndex],h.normalizationPosition,h.normalizationAngle,d[t].reflect,o);l=ei.C.degreesToRadian(-n.angle),_.x=_.x*ei.C.cos(l)-_.y*ei.C.sin(l),_.y=_.x*ei.C.sin(l)+_.y*ei.C.cos(l),function(e,t,i,r,s,a,n,o){let l,u,h=new eO.r(0,0),d=new eO.r(0,0),c=new eO.r(0,0),g=new eO.r(0,0);e[0].position=new eO.r(i.x,i.y);let m=ei.C.degreesToRadian(r),_=ei.C.radianToDirection(m);_.normalize();for(let i=1;i<t;++i)e[i].force=_.multiplyByScaler(e[i].acceleration).add(s),e[i].lastPosition=new eO.r(e[i].position.x,e[i].position.y),l=e[i].delay*n*30,h=e[i].position.substract(e[i-1].position),u=ei.C.directionToRadian(e[i].lastGravity,_)/5,h.x=ei.C.cos(u)*h.x-h.y*ei.C.sin(u),h.y=ei.C.sin(u)*h.x+h.y*ei.C.cos(u),e[i].position=e[i-1].position.add(h),d=e[i].velocity.multiplyByScaler(l),c=e[i].force.multiplyByScaler(l).multiplyByScaler(l),e[i].position=e[i].position.add(d).add(c),(g=e[i].position.substract(e[i-1].position)).normalize(),e[i].position=e[i-1].position.add(g.multiplyByScaler(e[i].radius)),ei.C.abs(e[i].position.x)<a&&(e[i].position.x=0),0!=l&&(e[i].velocity=e[i].position.substract(e[i].lastPosition),e[i].velocity=e[i].velocity.divisionByScalar(l),e[i].velocity=e[i].velocity.multiplyByScaler(e[i].mobility)),e[i].force=new eO.r(0,0),e[i].lastGravity=new eO.r(_.x,_.y)}(g,h.particleCount,_,n.angle,this._options.wind,.001*h.normalizationPosition.maximum,m,5);for(let i=0;i<h.outputCount;++i){let r=c[i].vertexIndex;if(-1==c[i].destinationParameterIndex&&(c[i].destinationParameterIndex=e.getParameterIndex(c[i].destination.id)),r<1||r>=h.particleCount)continue;let s=new eO.r;s.x=g[r].position.x-g[r-1].position.x,s.y=g[r].position.y-g[r-1].position.y,u=c[i].getValue(s,g,r,c[i].reflect,this._options.gravity),this._currentRigOutputs.at(t).outputs.set(i,u);let a=c[i].destinationParameterIndex,n=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(a))):this._parameterCaches.slice(a);tx(n,x[a],f[a],u,c[i]);for(let e=a,t=0;e<this._parameterCaches.length;e++,t++)this._parameterCaches[e]=n[t]}}this._currentRemainTime-=m}let b=this._currentRemainTime/m;this.interpolate(e,b)}interpolate(e,t){let i,r,s=e.getModel().parameters.values,a=e.getModel().parameters.maximumValues,n=e.getModel().parameters.minimumValues;for(let e=0;e<this._physicsRig.subRigCount;++e){r=this._physicsRig.settings.at(e),i=this._physicsRig.outputs.get(r.baseOutputIndex);for(let o=0;o<r.outputCount;++o){if(-1==i[o].destinationParameterIndex)continue;let r=i[o].destinationParameterIndex,l=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(s.subarray(r))):s.slice(r);tx(l,n[r],a[r],this._previousRigOutputs.at(e).outputs.at(o)*(1-t)+this._currentRigOutputs.at(e).outputs.at(o)*t,i[o]);for(let e=r,t=0;e<s.length;e++,t++)s[e]=l[t]}}}setOptions(e){this._options=e}getOption(){return this._options}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){let e,t,i;for(let r=0;r<this._physicsRig.subRigCount;++r){t=this._physicsRig.settings.at(r),(e=this._physicsRig.particles.get(t.baseParticleIndex))[0].initialPosition=new eO.r(0,0),e[0].lastPosition=new eO.r(e[0].initialPosition.x,e[0].initialPosition.y),e[0].lastGravity=new eO.r(0,-1),e[0].lastGravity.y*=-1,e[0].velocity=new eO.r(0,0),e[0].force=new eO.r(0,0);for(let r=1;r<t.particleCount;++r)(i=new eO.r(0,0)).y=e[r].radius,e[r].initialPosition=new eO.r(e[r-1].initialPosition.x+i.x,e[r-1].initialPosition.y+i.y),e[r].position=new eO.r(e[r].initialPosition.x,e[r].initialPosition.y),e[r].lastPosition=new eO.r(e[r].initialPosition.x,e[r].initialPosition.y),e[r].lastGravity=new eO.r(0,-1),e[r].lastGravity.y*=-1,e[r].velocity=new eO.r(0,0),e[r].force=new eO.r(0,0)}}constructor(){this._physicsRig=null,this._options=new to,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new T.tG,this._previousRigOutputs=new T.tG,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}}class to{constructor(){this.gravity=new eO.r(0,0),this.wind=new eO.r(0,0)}}class tl{constructor(){this.outputs=new T.tG(0)}}function tu(e,t,i,r,s,a,n,o,l,u){e.x+=ty(i,r,s,a,n.minimum,n.maximum,n.defalut,l)*u}function th(e,t,i,r,s,a,n,o,l,u){e.y+=ty(i,r,s,a,n.minimum,n.maximum,n.defalut,l)*u}function td(e,t,i,r,s,a,n,o,l,u){t.angle+=ty(i,r,s,a,o.minimum,o.maximum,o.defalut,l)*u}function tc(e,t,i,r,s){let a=e.x;return r&&(a*=-1),a}function tg(e,t,i,r,s){let a=e.y;return r&&(a*=-1),a}function tm(e,t,i,r,s){let a;return s=i>=2?t[i-1].position.substract(t[i-2].position):s.multiplyByScaler(-1),a=ei.C.directionToRadian(s,e),r&&(a*=-1),a}function t_(e,t){return JSON.parse(JSON.stringify(e.x))}function tp(e,t){return JSON.parse(JSON.stringify(e.y))}function tf(e,t){return JSON.parse(JSON.stringify(t))}function tx(e,t,i,r,s){let a;(a=r*s.getScale(s.translationScale,s.angleScale))<t?(a<s.valueBelowMinimum&&(s.valueBelowMinimum=a),a=t):a>i&&(a>s.valueExceededMaximum&&(s.valueExceededMaximum=a),a=i);let n=s.weight/100;n>=1||(a=e[0]*(1-n)+a*n),e[0]=a}function ty(e,t,i,r,s,a,n,o){let l,u=0,h=ei.C.max(i,t);h<e&&(e=h);let d=ei.C.min(i,t);d>e&&(e=d);let c=ei.C.min(s,a),g=ei.C.max(s,a),m=ei.C.min(d,h)+function(e,t){let i=ei.C.max(e,t),r=ei.C.min(e,t);return ei.C.abs(i-r)}(d,h)/2,_=e-m;switch(l=0,_>0?l=1:_<0&&(l=-1),l){case 1:{let e=h-m;0!=e&&(u=(g-n)/e*_+n);break}case -1:{let e=d-m;0!=e&&(u=(c-n)/e*_+n);break}case 0:u=n}return o?u:-1*u}!function(e){e.CubismPhysics=tn,e.Options=to}(w||(w={}));var tb=i(7973),tv=i(2887),tS=i(4532);class tC{release(){for(let e=0;e<this._clippingContextListForMask.getSize();e++)this._clippingContextListForMask.at(e)&&(this._clippingContextListForMask.at(e).release(),this._clippingContextListForMask.set(e,void 0)),this._clippingContextListForMask.set(e,null);this._clippingContextListForMask=null;for(let e=0;e<this._clippingContextListForDraw.getSize();e++)this._clippingContextListForDraw.set(e,null);this._clippingContextListForDraw=null;for(let e=0;e<this._channelColors.getSize();e++)this._channelColors.set(e,null);this._channelColors=null,null!=this._clearedFrameBufferFlags&&this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=null}initialize(e,t){t%1!=0&&((0,em.E2)("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),t=~~t),t<1&&(0,em.E2)("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=t<1?1:t,this._clearedFrameBufferFlags=new T.tG(this._renderTextureCount);for(let t=0;t<e.getDrawableCount();t++){if(e.getDrawableMaskCounts()[t]<=0){this._clippingContextListForDraw.pushBack(null);continue}let i=this.findSameClip(e.getDrawableMasks()[t],e.getDrawableMaskCounts()[t]);null==i&&(i=new this._clippingContexttConstructor(this,e.getDrawableMasks()[t],e.getDrawableMaskCounts()[t]),this._clippingContextListForMask.pushBack(i)),i.addClippedDrawable(t),this._clippingContextListForDraw.pushBack(i)}}findSameClip(e,t){for(let i=0;i<this._clippingContextListForMask.getSize();i++){let r=this._clippingContextListForMask.at(i),s=r._clippingIdCount;if(s!=t)continue;let a=0;for(let t=0;t<s;t++){let i=r._clippingIdList[t];for(let t=0;t<s;t++)if(e[t]==i){a++;break}}if(a==s)return r}return null}setupMatrixForHighPrecision(e,t){let i=0;for(let t=0;t<this._clippingContextListForMask.getSize();t++){let r=this._clippingContextListForMask.at(t);this.calcClippedDrawTotalBounds(e,r),r._isUsing&&i++}if(i>0){if(this.setupLayoutBounds(0),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount){this._clearedFrameBufferFlags.clear();for(let e=0;e<this._renderTextureCount;e++)this._clearedFrameBufferFlags.pushBack(!1)}else for(let e=0;e<this._renderTextureCount;e++)this._clearedFrameBufferFlags.set(e,!1);for(let i=0;i<this._clippingContextListForMask.getSize();i++){let r=this._clippingContextListForMask.at(i),s=r._allClippedDrawRect,a=r._layoutBounds,n=0,o=0,l=e.getPixelsPerUnit(),u=r.getClippingManager().getClippingMaskBufferSize(),h=a.width*u,d=a.height*u;this._tmpBoundsOnModel.setRect(s),this._tmpBoundsOnModel.width*l>h?(this._tmpBoundsOnModel.expand(.05*s.width,0),n=a.width/this._tmpBoundsOnModel.width):n=l/h,this._tmpBoundsOnModel.height*l>d?(this._tmpBoundsOnModel.expand(0,.05*s.height),o=a.height/this._tmpBoundsOnModel.height):o=l/d,this.createMatrixForMask(t,a,n,o),r._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),r._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray())}}}createMatrixForMask(e,t,i,r){this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(t.x,t.y),this._tmpMatrix.scaleRelative(i,r),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(t.x,t.y*(e?-1:1)),this._tmpMatrix.scaleRelative(i,r*(e?-1:1)),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray())}setupLayoutBounds(e){let t=this._renderTextureCount<=1?36:32*this._renderTextureCount;if(e<=0||e>t){e>t&&(0,em.iA)("not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}",e-t,this._renderTextureCount,e);for(let e=0;e<this._clippingContextListForMask.getSize();e++){let t=this._clippingContextListForMask.at(e);t._layoutChannelIndex=0,t._layoutBounds.x=0,t._layoutBounds.y=0,t._layoutBounds.width=1,t._layoutBounds.height=1,t._bufferIndex=0}return}let i=this._renderTextureCount<=1?9:8,r=e/this._renderTextureCount,s=e%this._renderTextureCount,a=(r=Math.ceil(r))/4,n=r%4;a=~~a;let o=0;for(let r=0;r<this._renderTextureCount;r++)for(let l=0;l<4;l++){let u=a+ +(l<n);if(l==n+(a<1?-1:0)&&s>0&&(u-=!(r<s)),0==u);else if(1==u){let e=this._clippingContextListForMask.at(o++);e._layoutChannelIndex=l,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1,e._bufferIndex=r}else if(2==u)for(let e=0;e<u;e++){let t=e%2;t=~~t;let i=this._clippingContextListForMask.at(o++);i._layoutChannelIndex=l,i._layoutBounds.x=.5*t,i._layoutBounds.y=0,i._layoutBounds.width=.5,i._layoutBounds.height=1,i._bufferIndex=r}else if(u<=4)for(let e=0;e<u;e++){let t=e%2,i=e/2;t=~~t,i=~~i;let s=this._clippingContextListForMask.at(o++);s._layoutChannelIndex=l,s._layoutBounds.x=.5*t,s._layoutBounds.y=.5*i,s._layoutBounds.width=.5,s._layoutBounds.height=.5,s._bufferIndex=r}else if(u<=i)for(let e=0;e<u;e++){let t=e%3,i=e/3;t=~~t,i=~~i;let s=this._clippingContextListForMask.at(o++);s._layoutChannelIndex=l,s._layoutBounds.x=t/3,s._layoutBounds.y=i/3,s._layoutBounds.width=1/3,s._layoutBounds.height=1/3,s._bufferIndex=r}else{(0,em.iA)("not supported mask count : {0}\n[Details] render texture count : {1}, mask count : {2}",e-t,this._renderTextureCount,e);for(let e=0;e<u;e++){let e=this._clippingContextListForMask.at(o++);e._layoutChannelIndex=0,e._layoutBounds.x=0,e._layoutBounds.y=0,e._layoutBounds.width=1,e._layoutBounds.height=1,e._bufferIndex=0}}}}calcClippedDrawTotalBounds(e,t){let i=Number.MAX_VALUE,r=Number.MAX_VALUE,s=5e-324,a=5e-324,n=t._clippedDrawableIndexList.length;for(let o=0;o<n;o++){let n=t._clippedDrawableIndexList[o],l=e.getDrawableVertexCount(n),u=e.getDrawableVertices(n),h=Number.MAX_VALUE,d=Number.MAX_VALUE,c=-Number.MAX_VALUE,g=-Number.MAX_VALUE,m=l*k.h8.vertexStep;for(let e=k.h8.vertexOffset;e<m;e+=k.h8.vertexStep){let t=u[e],i=u[e+1];t<h&&(h=t),t>c&&(c=t),i<d&&(d=i),i>g&&(g=i)}if(h!=Number.MAX_VALUE)if(h<i&&(i=h),d<r&&(r=d),c>s&&(s=c),g>a&&(a=g),i==Number.MAX_VALUE)t._allClippedDrawRect.x=0,t._allClippedDrawRect.y=0,t._allClippedDrawRect.width=0,t._allClippedDrawRect.height=0,t._isUsing=!1;else{t._isUsing=!0;let e=s-i,n=a-r;t._allClippedDrawRect.x=i,t._allClippedDrawRect.y=r,t._allClippedDrawRect.width=e,t._allClippedDrawRect.height=n}}}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}getChannelFlagAsColor(e){return this._channelColors.at(e)}setClippingMaskBufferSize(e){this._clippingMaskBufferSize=e}constructor(e){this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new T.tG,this._clippingContextListForDraw=new T.tG,this._channelColors=new T.tG,this._tmpBoundsOnModel=new tv.w,this._tmpMatrix=new ee.n,this._tmpMatrixForMask=new ee.n,this._tmpMatrixForDraw=new ee.n,this._clippingContexttConstructor=e;let t=new tS.kY;t.r=1,t.g=0,t.b=0,t.a=0,this._channelColors.pushBack(t),(t=new tS.kY).r=0,t.g=1,t.b=0,t.a=0,this._channelColors.pushBack(t),(t=new tS.kY).r=0,t.g=0,t.b=1,t.a=0,this._channelColors.pushBack(t),(t=new tS.kY).r=0,t.g=0,t.b=0,t.a=1,this._channelColors.pushBack(t)}}class tw{static getInstance(){return null==r&&(r=new tw),r}static deleteInstance(){r&&(r.release(),r=null)}release(){this.releaseShaderProgram()}setupShaderProgramForDraw(e,t,i){let r,s,a,n,o;e.isPremultipliedAlpha()||(0,em.iA)("NoPremultipliedAlpha is not allowed"),0==this._shaderSets.getSize()&&this.generateShaders();let l=null!=e.getClippingContextBufferForDraw(),u=t.getDrawableInvertedMaskBit(i),h=l?u?2:1:0;switch(t.getDrawableBlendMode(i)){case tS.sl.CubismBlendMode_Normal:default:o=this._shaderSets.at(1+h),r=this.gl.ONE,s=this.gl.ONE_MINUS_SRC_ALPHA,a=this.gl.ONE,n=this.gl.ONE_MINUS_SRC_ALPHA;break;case tS.sl.CubismBlendMode_Additive:o=this._shaderSets.at(4+h),r=this.gl.ONE,s=this.gl.ONE,a=this.gl.ZERO,n=this.gl.ONE;break;case tS.sl.CubismBlendMode_Multiplicative:o=this._shaderSets.at(7+h),r=this.gl.DST_COLOR,s=this.gl.ONE_MINUS_SRC_ALPHA,a=this.gl.ZERO,n=this.gl.ONE}this.gl.useProgram(o.shaderProgram),null==e._bufferData.vertex&&(e._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.vertex);let d=t.getDrawableVertices(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,d,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(o.attributePositionLocation),this.gl.vertexAttribPointer(o.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==e._bufferData.uv&&(e._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.uv);let c=t.getDrawableVertexUvs(i);if(this.gl.bufferData(this.gl.ARRAY_BUFFER,c,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(o.attributeTexCoordLocation),this.gl.vertexAttribPointer(o.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),l){this.gl.activeTexture(this.gl.TEXTURE1);let t=e.getClippingContextBufferForDraw().getClippingManager().getColorBuffer().at(e.getClippingContextBufferForDraw()._bufferIndex);this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(o.samplerTexture1Location,1),this.gl.uniformMatrix4fv(o.uniformClipMatrixLocation,!1,e.getClippingContextBufferForDraw()._matrixForDraw.getArray());let i=e.getClippingContextBufferForDraw()._layoutChannelIndex,r=e.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(i);this.gl.uniform4f(o.uniformChannelFlagLocation,r.r,r.g,r.b,r.a)}let g=t.getDrawableTextureIndex(i),m=e.getBindedTextures().getValue(g);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,m),this.gl.uniform1i(o.samplerTexture0Location,0);let _=e.getMvpMatrix();this.gl.uniformMatrix4fv(o.uniformMatrixLocation,!1,_.getArray());let p=e.getModelColorWithOpacity(t.getDrawableOpacity(i)),f=t.getMultiplyColor(i),x=t.getScreenColor(i);this.gl.uniform4f(o.uniformBaseColorLocation,p.r,p.g,p.b,p.a),this.gl.uniform4f(o.uniformMultiplyColorLocation,f.r,f.g,f.b,f.a),this.gl.uniform4f(o.uniformScreenColorLocation,x.r,x.g,x.b,x.a),null==e._bufferData.index&&(e._bufferData.index=this.gl.createBuffer());let y=t.getDrawableVertexIndices(i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,y,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(r,s,a,n)}setupShaderProgramForMask(e,t,i){e.isPremultipliedAlpha()||(0,em.iA)("NoPremultipliedAlpha is not allowed"),0==this._shaderSets.getSize()&&this.generateShaders();let r=this._shaderSets.at(0);this.gl.useProgram(r.shaderProgram),null==e._bufferData.vertex&&(e._bufferData.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.vertex);let s=t.getDrawableVertices(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(r.attributePositionLocation),this.gl.vertexAttribPointer(r.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==e._bufferData.uv&&(e._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.uv);let a=t.getDrawableTextureIndex(i),n=e.getBindedTextures().getValue(a);this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.gl.uniform1i(r.samplerTexture0Location,0),null==e._bufferData.uv&&(e._bufferData.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e._bufferData.uv);let o=t.getDrawableVertexUvs(i);this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(r.attributeTexCoordLocation),this.gl.vertexAttribPointer(r.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),e.getClippingContextBufferForMask();let l=e.getClippingContextBufferForMask()._layoutChannelIndex,u=e.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(l);this.gl.uniform4f(r.uniformChannelFlagLocation,u.r,u.g,u.b,u.a),this.gl.uniformMatrix4fv(r.uniformClipMatrixLocation,!1,e.getClippingContextBufferForMask()._matrixForMask.getArray());let h=e.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(r.uniformBaseColorLocation,2*h.x-1,2*h.y-1,2*h.getRight()-1,2*h.getBottom()-1);let d=t.getMultiplyColor(i),c=t.getScreenColor(i);this.gl.uniform4f(r.uniformMultiplyColorLocation,d.r,d.g,d.b,d.a),this.gl.uniform4f(r.uniformScreenColorLocation,c.r,c.g,c.b,c.a);let g=this.gl.ZERO,m=this.gl.ONE_MINUS_SRC_COLOR,_=this.gl.ZERO,p=this.gl.ONE_MINUS_SRC_ALPHA;null==e._bufferData.index&&(e._bufferData.index=this.gl.createBuffer());let f=t.getDrawableVertexIndices(i);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e._bufferData.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,f,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(g,m,_,p)}releaseShaderProgram(){for(let e=0;e<this._shaderSets.getSize();e++)this.gl.deleteProgram(this._shaderSets.at(e).shaderProgram),this._shaderSets.at(e).shaderProgram=0,this._shaderSets.set(e,void 0),this._shaderSets.set(e,null)}generateShaders(){for(let e=0;e<10;e++)this._shaderSets.pushBack(new tM);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(tB,tI),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(tE,tR),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(tV,tk),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(tV,tT),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(e,t){let i=this.gl.createProgram(),r=this.compileShaderSource(this.gl.VERTEX_SHADER,e);if(!r)return(0,em.iA)("Vertex shader compile error!"),0;let s=this.compileShaderSource(this.gl.FRAGMENT_SHADER,t);return s?(this.gl.attachShader(i,r),this.gl.attachShader(i,s),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS))?(this.gl.deleteShader(r),this.gl.deleteShader(s),i):((0,em.iA)("Failed to link program: {0}",i),this.gl.deleteShader(r),r=0,this.gl.deleteShader(s),s=0,i&&(this.gl.deleteProgram(i),i=0),0):((0,em.iA)("Vertex shader compile error!"),0)}compileShaderSource(e,t){let i=this.gl.createShader(e);if(this.gl.shaderSource(i,t),this.gl.compileShader(i),!i){let e=this.gl.getShaderInfoLog(i);(0,em.iA)("Shader compile log: {0} ",e)}return this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(this.gl.deleteShader(i),null)}setGl(e){this.gl=e}constructor(){this._shaderSets=new T.tG}}class tM{}var tP=function(e){return e[e.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",e[e.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",e[e.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",e[e.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",e[e.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",e[e.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",e[e.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",e[e.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",e[e.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",e[e.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",e}({});let tB="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",tI="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",tE="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",tV="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",tR="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",tk="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",tT="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";!function(e){e.CubismShaderSet=tM,e.CubismShader_WebGL=tw,e.ShaderNames=tP}(M||(M={}));class tF extends tC{getMaskRenderTexture(){if(this._maskTexture&&null!=this._maskTexture.textures)this._maskTexture.frameNo=this._currentFrameNo;else{null!=this._maskRenderTextures&&this._maskRenderTextures.clear(),this._maskRenderTextures=new T.tG,null!=this._maskColorBuffers&&this._maskColorBuffers.clear(),this._maskColorBuffers=new T.tG;let e=this._clippingMaskBufferSize;for(let t=0;t<this._renderTextureCount;t++)this._maskColorBuffers.pushBack(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers.at(t)),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.pushBack(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures.at(t)),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers.at(t),0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a),this._maskTexture=new tA(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(e){this.gl=e}setupClippingContext(e,t){this._currentFrameNo++;let i=0;for(let t=0;t<this._clippingContextListForMask.getSize();t++){let r=this._clippingContextListForMask.at(t);this.calcClippedDrawTotalBounds(e,r),r._isUsing&&i++}if(i>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture().at(0),t.preDraw(),this.setupLayoutBounds(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture),this._clearedFrameBufferFlags.getSize()!=this._renderTextureCount&&(this._clearedFrameBufferFlags.clear(),this._clearedFrameBufferFlags=new T.tG(this._renderTextureCount));for(let e=0;e<this._clearedFrameBufferFlags.getSize();e++)this._clearedFrameBufferFlags.set(e,!1);for(let i=0;i<this._clippingContextListForMask.getSize();i++){let r=this._clippingContextListForMask.at(i),s=r._allClippedDrawRect,a=r._layoutBounds,n=0,o=0,l=this.getMaskRenderTexture().at(r._bufferIndex);this._currentMaskRenderTexture!=l&&(this._currentMaskRenderTexture=l,t.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._tmpBoundsOnModel.setRect(s),this._tmpBoundsOnModel.expand(.05*s.width,.05*s.height),n=a.width/this._tmpBoundsOnModel.width,o=a.height/this._tmpBoundsOnModel.height,this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(n,o),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(a.x,a.y),this._tmpMatrix.scaleRelative(n,o),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),r._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),r._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());let u=r._clippingIdCount;for(let i=0;i<u;i++){let s=r._clippingIdList[i];e.getDrawableDynamicFlagVertexPositionsDidChange(s)&&(t.setIsCulling(!1!=e.getDrawableCulling(s)),this._clearedFrameBufferFlags.at(r._bufferIndex)||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferFlags.set(r._bufferIndex,!0)),t.setClippingContextBufferForMask(r),t.drawMeshWebGL(e,s))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a),t.setClippingContextBufferForMask(null),this.gl.viewport(s[0],s[1],s[2],s[3])}}getColorBuffer(){return this._maskColorBuffers}getClippingMaskCount(){return this._clippingContextListForMask.getSize()}constructor(){super(tL)}}class tA{constructor(e,t){this.frameNo=e,this.textures=t}}class tL extends tS.l8{getClippingManager(){return this._owner}setGl(e){this._owner.setGL(e)}constructor(e,t,i){super(t,i),this._owner=e}}class tD{setGlEnable(e,t){t?this.gl.enable(e):this.gl.disable(e)}setGlEnableVertexAttribArray(e,t){t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e)}save(){if(null==this.gl)return void(0,em.iA)("'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.");this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastElementArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)}restore(){if(null==this.gl)return void(0,em.iA)("'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.");this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])}setGl(e){this.gl=e}constructor(){this._lastVertexAttribArrayEnabled=[,,,,],this._lastColorMask=[,,,,],this._lastBlending=[,,,,],this._lastViewport=[,,,,]}}class tN extends tS.FD{initialize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.isUsingMasking()&&(this._clippingManager=new tF,this._clippingManager.initialize(e,t)),this._sortedDrawableIndexList.resize(e.getDrawableCount(),0),super.initialize(e)}bindTexture(e,t){this._textures.setValue(e,t)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(e){if(!this._model.isUsingMasking())return;let t=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new tF,this._clippingManager.setClippingMaskBufferSize(e),this._clippingManager.initialize(this.getModel(),t)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}release(){this._clippingManager&&(this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null),null!=this.gl&&(this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null)}doDrawModel(){if(null==this.gl)return void(0,em.iA)("'gl' is null. WebGLRenderingContext is required.\nPlease call 'CubimRenderer_WebGL.startUp' function.");null!=this._clippingManager&&(this.preDraw(),this.isUsingHighPrecisionMask()?this._clippingManager.setupMatrixForHighPrecision(this.getModel(),!1):this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();let e=this.getModel().getDrawableCount(),t=this.getModel().getDrawableRenderOrders();for(let i=0;i<e;++i){let e=t[i];this._sortedDrawableIndexList.set(e,i)}for(let t=0;t<e;++t){let e=this._sortedDrawableIndexList.at(t);if(!this.getModel().getDrawableDynamicFlagIsVisible(e))continue;let i=null!=this._clippingManager?this._clippingManager.getClippingContextListForDraw().at(e):null;if(null!=i&&this.isUsingHighPrecisionMask()){i._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,i.getClippingManager().getMaskRenderTexture().at(i._bufferIndex)),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{let e=i._clippingIdCount;for(let t=0;t<e;t++){let e=i._clippingIdList[t];this._model.getDrawableDynamicFlagVertexPositionsDidChange(e)&&(this.setIsCulling(!1!=this._model.getDrawableCulling(e)),this.setClippingContextBufferForMask(i),this.drawMeshWebGL(this._model,e))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a),this.setClippingContextBufferForMask(null),this.gl.viewport(s[0],s[1],s[2],s[3]),this.preDraw()}this.setClippingContextBufferForDraw(i),this.setIsCulling(this.getModel().getDrawableCulling(e)),this.drawMeshWebGL(this._model,e)}}drawMeshWebGL(e,t){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW),this.isGeneratingMask()?tw.getInstance().setupShaderProgramForMask(this,e,t):tw.getInstance().setupShaderProgramForDraw(this,e,t);{let i=e.getDrawableVertexIndexCount(t);this.gl.drawElements(this.gl.TRIANGLES,i,this.gl.UNSIGNED_SHORT,0)}this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){tw.deleteInstance()}setRenderState(e,t){a=e,s=t}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(let e=0;e<this._textures.getSize();++e)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(e)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(e){this._clippingContextBufferForMask=e}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(e){this._clippingContextBufferForDraw=e}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}isGeneratingMask(){return null!=this.getClippingContextBufferForMask()}startUp(e){this.gl=e,this._clippingManager&&this._clippingManager.setGL(e),tw.getInstance().setGl(e),this._rendererProfile.setGl(e),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new tD,this.firstDraw=!0,this._textures=new tb.ak,this._sortedDrawableIndexList=new T.tG,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}}tS.FD.staticRelease=()=>{tN.doStaticRelease()},function(e){e.CubismClippingContext=tL,e.CubismClippingManager_WebGL=tF,e.CubismRenderTextureResource=tA,e.CubismRenderer_WebGL=tN}(P||(P={}));class tj{constructor(e=!1,t=new tS.kY){this.isOverwritten=e,this.color=t}}class tO{constructor(e=!1,t=new tS.kY){this.isOverwritten=e,this.color=t}}class tz{constructor(e=!1,t=!1){this.isOverwritten=e,this.isCulling=t}}class tU{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return null==this._model?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return null==this._model?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return null==this._model?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){let e=this._model.parameters.count,t=this._savedParameters.getSize();for(let i=0;i<e;++i)i<t?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])}getMultiplyColor(e){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(e)?this._userMultiplyColors.at(e).color:this.getDrawableMultiplyColor(e)}getScreenColor(e){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(e)?this._userScreenColors.at(e).color:this.getDrawableScreenColor(e)}setMultiplyColorByTextureColor(e,t){this.setMultiplyColorByRGBA(e,t.r,t.g,t.b,t.a)}setMultiplyColorByRGBA(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this._userMultiplyColors.at(e).color.r=t,this._userMultiplyColors.at(e).color.g=i,this._userMultiplyColors.at(e).color.b=r,this._userMultiplyColors.at(e).color.a=s}setScreenColorByTextureColor(e,t){this.setScreenColorByRGBA(e,t.r,t.g,t.b,t.a)}setScreenColorByRGBA(e,t,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this._userScreenColors.at(e).color.r=t,this._userScreenColors.at(e).color.g=i,this._userScreenColors.at(e).color.b=r,this._userScreenColors.at(e).color.a=s}getPartMultiplyColor(e){return this._userPartMultiplyColors.at(e).color}getPartScreenColor(e){return this._userPartScreenColors.at(e).color}setPartColor(e,t,i,r,s,a,n){if(a.at(e).color.r=t,a.at(e).color.g=i,a.at(e).color.b=r,a.at(e).color.a=s,a.at(e).isOverwritten)for(let a=0;a<this._partChildDrawables.at(e).getSize();++a){let o=this._partChildDrawables.at(e).at(a);n.at(o).color.r=t,n.at(o).color.g=i,n.at(o).color.b=r,n.at(o).color.a=s}}setPartMultiplyColorByTextureColor(e,t){this.setPartMultiplyColorByRGBA(e,t.r,t.g,t.b,t.a)}setPartMultiplyColorByRGBA(e,t,i,r,s){this.setPartColor(e,t,i,r,s,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(e,t){this.setPartScreenColorByRGBA(e,t.r,t.g,t.b,t.a)}setPartScreenColorByRGBA(e,t,i,r,s){this.setPartColor(e,t,i,r,s,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(e){this._isOverwrittenModelMultiplyColors=e}setOverwriteFlagForModelScreenColors(e){this._isOverwrittenModelScreenColors=e}getOverwriteFlagForDrawableMultiplyColors(e){return this._userMultiplyColors.at(e).isOverwritten}getOverwriteFlagForDrawableScreenColors(e){return this._userScreenColors.at(e).isOverwritten}setOverwriteFlagForDrawableMultiplyColors(e,t){this._userMultiplyColors.at(e).isOverwritten=t}setOverwriteFlagForDrawableScreenColors(e,t){this._userScreenColors.at(e).isOverwritten=t}getOverwriteColorForPartMultiplyColors(e){return this._userPartMultiplyColors.at(e).isOverwritten}getOverwriteColorForPartScreenColors(e){return this._userPartScreenColors.at(e).isOverwritten}setOverwriteColorForPartColors(e,t,i,r){i.at(e).isOverwritten=t;for(let s=0;s<this._partChildDrawables.at(e).getSize();++s){let a=this._partChildDrawables.at(e).at(s);r.at(a).isOverwritten=t,t&&(r.at(a).color.r=i.at(e).color.r,r.at(a).color.g=i.at(e).color.g,r.at(a).color.b=i.at(e).color.b,r.at(a).color.a=i.at(e).color.a)}}setOverwriteColorForPartMultiplyColors(e,t){this._userPartMultiplyColors.at(e).isOverwritten=t,this.setOverwriteColorForPartColors(e,t,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(e,t){this._userPartScreenColors.at(e).isOverwritten=t,this.setOverwriteColorForPartColors(e,t,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(e){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(e))return this._userCullings.at(e).isCulling;let t=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(t[e])}setDrawableCulling(e,t){this._userCullings.at(e).isCulling=t}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(e){this._isOverwrittenCullings=e}getOverwriteFlagForDrawableCullings(e){return this._userCullings.at(e).isOverwritten}setOverwriteFlagForDrawableCullings(e,t){this._userCullings.at(e).isOverwritten=t}getModelOapcity(){return this._modelOpacity}setModelOapcity(e){this._modelOpacity=e}getModel(){return this._model}getPartIndex(e){let t,i=this._model.parts.count;for(t=0;t<i;++t)if(e==this._partIds.at(t))return t;return this._notExistPartId.isExist(e)?this._notExistPartId.getValue(e):(t=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(e,t),this._notExistPartOpacities.appendKey(t),t)}getPartId(e){let t=this._model.parts.ids[e];return k.MN.getIdManager().getId(t)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(e,t){if(this._notExistPartOpacities.isExist(e))return void this._notExistPartOpacities.setValue(e,t);(0,em.vT)(0<=e&&e<this.getPartCount()),this._partOpacities[e]=t}setPartOpacityById(e,t){let i=this.getPartIndex(e);i<0||this.setPartOpacityByIndex(i,t)}getPartOpacityByIndex(e){return this._notExistPartOpacities.isExist(e)?this._notExistPartOpacities.getValue(e):((0,em.vT)(0<=e&&e<this.getPartCount()),this._partOpacities[e])}getPartOpacityById(e){let t=this.getPartIndex(e);return t<0?0:this.getPartOpacityByIndex(t)}getParameterIndex(e){let t,i=this._model.parameters.count;for(t=0;t<i;++t)if(e==this._parameterIds.at(t))return t;return this._notExistParameterId.isExist(e)?this._notExistParameterId.getValue(e):(t=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(e,t),this._notExistParameterValues.appendKey(t),t)}getParameterCount(){return this._model.parameters.count}getParameterType(e){return this._model.parameters.types[e]}getParameterMaximumValue(e){return this._model.parameters.maximumValues[e]}getParameterMinimumValue(e){return this._model.parameters.minimumValues[e]}getParameterDefaultValue(e){return this._model.parameters.defaultValues[e]}getParameterId(e){return k.MN.getIdManager().getId(this._model.parameters.ids[e])}getParameterValueByIndex(e){return this._notExistParameterValues.isExist(e)?this._notExistParameterValues.getValue(e):((0,em.vT)(0<=e&&e<this.getParameterCount()),this._parameterValues[e])}getParameterValueById(e){let t=this.getParameterIndex(e);return this.getParameterValueByIndex(t)}setParameterValueByIndex(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this._notExistParameterValues.isExist(e))return void this._notExistParameterValues.setValue(e,1==i?t:this._notExistParameterValues.getValue(e)*(1-i)+t*i);(0,em.vT)(0<=e&&e<this.getParameterCount()),this._model.parameters.maximumValues[e]<t&&(t=this._model.parameters.maximumValues[e]),this._model.parameters.minimumValues[e]>t&&(t=this._model.parameters.minimumValues[e]),this._parameterValues[e]=1==i?t:this._parameterValues[e]=this._parameterValues[e]*(1-i)+t*i}setParameterValueById(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=this.getParameterIndex(e);this.setParameterValueByIndex(r,t,i)}addParameterValueByIndex(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.setParameterValueByIndex(e,this.getParameterValueByIndex(e)+t*i)}addParameterValueById(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=this.getParameterIndex(e);this.addParameterValueByIndex(r,t,i)}multiplyParameterValueById(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=this.getParameterIndex(e);this.multiplyParameterValueByIndex(r,t,i)}multiplyParameterValueByIndex(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.setParameterValueByIndex(e,this.getParameterValueByIndex(e)*(1+(t-1)*i))}getDrawableIndex(e){let t=this._model.drawables.count;for(let i=0;i<t;++i)if(this._drawableIds.at(i)==e)return i;return -1}getDrawableCount(){return this._model.drawables.count}getDrawableId(e){let t=this._model.drawables.ids;return k.MN.getIdManager().getId(t[e])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(e){return this.getDrawableTextureIndex(e)}getDrawableTextureIndex(e){return this._model.drawables.textureIndices[e]}getDrawableDynamicFlagVertexPositionsDidChange(e){let t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(t[e])}getDrawableVertexIndexCount(e){return this._model.drawables.indexCounts[e]}getDrawableVertexCount(e){return this._model.drawables.vertexCounts[e]}getDrawableVertices(e){return this.getDrawableVertexPositions(e)}getDrawableVertexIndices(e){return this._model.drawables.indices[e]}getDrawableVertexPositions(e){return this._model.drawables.vertexPositions[e]}getDrawableVertexUvs(e){return this._model.drawables.vertexUvs[e]}getDrawableOpacity(e){return this._model.drawables.opacities[e]}getDrawableMultiplyColor(e){let t=this._model.drawables.multiplyColors,i=4*e,r=new tS.kY;return r.r=t[i],r.g=t[i+1],r.b=t[i+2],r.a=t[i+3],r}getDrawableScreenColor(e){let t=this._model.drawables.screenColors,i=4*e,r=new tS.kY;return r.r=t[i],r.g=t[i+1],r.b=t[i+2],r.a=t[i+3],r}getDrawableParentPartIndex(e){return this._model.drawables.parentPartIndices[e]}getDrawableBlendMode(e){let t=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(t[e])?tS.sl.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(t[e])?tS.sl.CubismBlendMode_Multiplicative:tS.sl.CubismBlendMode_Normal}getDrawableInvertedMaskBit(e){let t=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(t[e])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let e=0;e<this._model.drawables.count;++e)if(!(this._model.drawables.maskCounts[e]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(e){let t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(t[e])}getDrawableDynamicFlagVisibilityDidChange(e){let t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(t[e])}getDrawableDynamicFlagOpacityDidChange(e){let t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(t[e])}getDrawableDynamicFlagRenderOrderDidChange(e){let t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(t[e])}getDrawableDynamicFlagBlendColorDidChange(e){let t=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(t[e])}loadParameters(){let e=this._model.parameters.count,t=this._savedParameters.getSize();e>t&&(e=t);for(let t=0;t<e;++t)this._parameterValues[t]=this._savedParameters.at(t)}initialize(){(0,em.vT)(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{let e=this._model.parameters.ids,t=this._model.parameters.count;this._parameterIds.prepareCapacity(t);for(let i=0;i<t;++i)k.MN.getIdManager()&&this._parameterIds.pushBack(k.MN.getIdManager().getId(e[i]))}let e=this._model.parts.count;{let t=this._model.parts.ids;this._partIds.prepareCapacity(e);for(let i=0;i<e;++i)this._partIds.pushBack(k.MN.getIdManager().getId(t[i]));this._userPartMultiplyColors.prepareCapacity(e),this._userPartScreenColors.prepareCapacity(e),this._partChildDrawables.prepareCapacity(e)}{let t=this._model.drawables.ids,i=this._model.drawables.count;this._userMultiplyColors.prepareCapacity(i),this._userScreenColors.prepareCapacity(i),this._userCullings.prepareCapacity(i);let r=new tz(!1,!1);for(let t=0;t<e;++t){let e=new tS.kY(1,1,1,1),r=new tS.kY(0,0,0,1),s=new tO(!1,e),a=new tO(!1,r);this._userPartMultiplyColors.pushBack(s),this._userPartScreenColors.pushBack(a),this._partChildDrawables.pushBack(new T.tG),this._partChildDrawables.at(t).prepareCapacity(i)}for(let e=0;e<i;++e){let i=new tS.kY(1,1,1,1),s=new tS.kY(0,0,0,1),a=new tj(!1,i),n=new tj(!1,s);this._drawableIds.pushBack(k.MN.getIdManager().getId(t[e])),this._userMultiplyColors.pushBack(a),this._userScreenColors.pushBack(n),this._userCullings.pushBack(r);let o=this.getDrawableParentPartIndex(e);o>=0&&this._partChildDrawables.at(o).pushBack(e)}}}release(){this._model.release(),this._model=null}constructor(e){this._model=e,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new T.tG,this._parameterIds=new T.tG,this._drawableIds=new T.tG,this._partIds=new T.tG,this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=new T.tG,this._userScreenColors=new T.tG,this._userCullings=new T.tG,this._userPartMultiplyColors=new T.tG,this._userPartScreenColors=new T.tG,this._partChildDrawables=new T.tG,this._notExistPartId=new tb.ak,this._notExistParameterId=new tb.ak,this._notExistParameterValues=new tb.ak,this._notExistPartOpacities=new tb.ak}}(B||(B={})).CubismModel=tU;class tX{static create(e,t){let i=null;if(t&&!this.hasMocConsistency(e))return(0,em.iA)("Inconsistent MOC3."),i;let r=Live2DCubismCore.Moc.fromArrayBuffer(e);return r&&((i=new tX(r))._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(r,e)),i}static delete(e){e._moc._release(),e._moc=null,e=null}createModel(){let e=null,t=Live2DCubismCore.Model.fromMoc(this._moc);return t&&((e=new tU(t)).initialize(),++this._modelCount),e}deleteModel(e){null!=e&&(e.release(),e=null,--this._modelCount)}release(){(0,em.vT)(0==this._modelCount),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(e){return 1===Live2DCubismCore.Moc.prototype.hasMocConsistency(e)}constructor(e){this._moc=e,this._modelCount=0,this._mocVersion=0}}(I||(I={})).CubismMoc=tX;let tY="Meta",tG="UserData";class tH{release(){F._3.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(tY).getValueByString("UserDataCount").toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(tY).getValueByString("TotalUserDataSize").toInt()}getUserDataTargetType(e){return this._json.getRoot().getValueByString(tG).getValueByIndex(e).getValueByString("Target").getRawString()}getUserDataId(e){return k.MN.getIdManager().getId(this._json.getRoot().getValueByString(tG).getValueByIndex(e).getValueByString("Id").getRawString())}getUserDataValue(e){return this._json.getRoot().getValueByString(tG).getValueByIndex(e).getValueByString("Value").getRawString()}constructor(e,t){this._json=F._3.create(e,t)}}(E||(E={})).CubismModelUserDataJson=tH;class tW{}class tq{static create(e,t){let i=new tq;return i.parseUserData(e,t),i}static delete(e){null!=e&&(e.release(),e=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(e,t){let i=new tH(e,t);if(!i){i.release(),i=void 0;return}let r=k.MN.getIdManager().getId("ArtMesh"),s=i.getUserDataCount();for(let e=0;e<s;e++){let t=new tW;t.targetId=i.getUserDataId(e),t.targetType=k.MN.getIdManager().getId(i.getUserDataTargetType(e)),t.value=new eg.F(i.getUserDataValue(e)),this._userDataNodes.pushBack(t),t.targetType==r&&this._artMeshUserDataNode.pushBack(t)}i.release()}release(){for(let e=0;e<this._userDataNodes.getSize();++e)this._userDataNodes.set(e,null);this._userDataNodes=null}constructor(){this._userDataNodes=new T.tG,this._artMeshUserDataNode=new T.tG}}!function(e){e.CubismModelUserData=tq,e.CubismModelUserDataNode=tW}(V||(V={}));class tJ{isInitialized(){return this._initialized}setInitialized(e){this._initialized=e}isUpdating(){return this._updating}setUpdating(e){this._updating=e}setDragging(e,t){this._dragManager.set(e,t)}setAcceleration(e,t,i){this._accelerationX=e,this._accelerationY=t,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(e){this._opacity=e}getOpacity(){return this._opacity}loadModel(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(this._moc=tX.create(e,t),null==this._moc)?void(0,em.iA)("Failed to CubismMoc.create()."):(this._model=this._moc.createModel(),null==this._model)?void(0,em.iA)("Failed to CreateModel()."):void(this._model.saveParameters(),this._modelMatrix=new et(this._model.getCanvasWidth(),this._model.getCanvasHeight()),this._modelMatrix.scale(i,i))}loadMotion(e,t,i,r){return null==e||0==t?((0,em.iA)("Failed to loadMotion()."),null):eN.create(e,t,r)}loadExpression(e,t,i){return null==e||0==t?((0,em.iA)("Failed to loadExpression()."),null):eo.create(e,t)}loadPose(e,t){if(null==e||0==t)return void(0,em.iA)("Failed to loadPose().");this._pose=Q.create(e,t)}loadUserData(e,t){if(null==e||0==t)return void(0,em.iA)("Failed to loadUserData().");this._modelUserData=tq.create(e,t)}loadPhysics(e,t){if(null==e||0==t)return void(0,em.iA)("Failed to loadPhysics().");this._physics=tn.create(e,t)}isHit(e,t,i){let r=this._model.getDrawableIndex(e);if(r<0)return!1;let s=this._model.getDrawableVertexCount(r),a=this._model.getDrawableVertices(r),n=a[0],o=a[0],l=a[1],u=a[1];for(let e=1;e<s;++e){let t=a[k.h8.vertexOffset+e*k.h8.vertexStep],i=a[k.h8.vertexOffset+e*k.h8.vertexStep+1];t<n&&(n=t),t>o&&(o=t),i<l&&(l=i),i>u&&(u=i)}let h=this._modelMatrix.invertTransformX(t),d=this._modelMatrix.invertTransformY(i);return n<=h&&h<=o&&l<=d&&d<=u}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._renderer&&this.deleteRenderer(),this._renderer=new tN,this._renderer.initialize(this._model,e)}deleteRenderer(){null!=this._renderer&&(this._renderer.release(),this._renderer=null)}motionEventFired(e){(0,em.qP)("{0}",e.s)}static cubismDefaultMotionEventCallback(e,t,i){null!=i&&i.motionEventFired(t)}release(){null!=this._motionManager&&(this._motionManager.release(),this._motionManager=null),null!=this._expressionManager&&(this._expressionManager.release(),this._expressionManager=null),null!=this._moc&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,Q.delete(this._pose),q.delete(this._eyeBlink),H.delete(this._breath),this._dragManager=null,tn.delete(this._physics),tq.delete(this._modelUserData),this.deleteRenderer()}constructor(){this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._mocConsistency=!1,this._debugMode=!1,this._renderer=null,this._motionManager=new ej,this._motionManager.setEventCallback(tJ.cubismDefaultMotionEventCallback,this),this._expressionManager=new ec,this._dragManager=new er}}(R||(R={})).CubismUserModel=tJ;var tK=i(7126),tZ=i(6339),tQ=i(8385),t$=i(278);let t0=null;class t1{static getInstance(){return null==t0&&(t0=new t1),t0}static releaseInstance(){null!=t0&&(t0=void 0),t0=null}update(e){let t,i;if(null==this._pcmData||this._sampleOffset>=this._wavFileInfo._samplesPerChannel)return this._lastRms=0,!1;this._userTimeSeconds+=e,(t=Math.floor(this._userTimeSeconds*this._wavFileInfo._samplingRate))>this._wavFileInfo._samplesPerChannel&&(t=this._wavFileInfo._samplesPerChannel),i=0;for(let e=0;e<this._wavFileInfo._numberOfChannels;e++)for(let r=this._sampleOffset;r<t;r++){let t=this._pcmData[e][r];i+=t*t}return i=Math.sqrt(i/(this._wavFileInfo._numberOfChannels*(t-this._sampleOffset))),this._lastRms=i,this._sampleOffset=t,!0}start(e){this._sampleOffset=0,this._userTimeSeconds=0,this._lastRms=0,this.loadWavFile(e)}getRms(){return this._lastRms}loadWavFile(e){return new Promise(t=>{let i=!1;null!=this._pcmData&&this.releasePcmData();let r=async()=>fetch(e).then(e=>e.arrayBuffer());(async()=>{if(this._byteReader._fileByte=await r(),this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=this._byteReader._fileByte.byteLength,this._byteReader._readOffset=0,null==this._byteReader._fileByte||this._byteReader._fileSize<4)return void t(!1);this._wavFileInfo._fileName=e;try{if(!this._byteReader.getCheckSignature("RIFF"))throw i=!1,Error('Cannot find Signeture "RIFF".');if(this._byteReader.get32LittleEndian(),!this._byteReader.getCheckSignature("WAVE"))throw i=!1,Error('Cannot find Signeture "WAVE".');if(!this._byteReader.getCheckSignature("fmt "))throw i=!1,Error('Cannot find Signeture "fmt".');let e=this._byteReader.get32LittleEndian();if(1!=this._byteReader.get16LittleEndian())throw i=!1,Error("File is not linear PCM.");for(this._wavFileInfo._numberOfChannels=this._byteReader.get16LittleEndian(),this._wavFileInfo._samplingRate=this._byteReader.get32LittleEndian(),this._byteReader.get32LittleEndian(),this._byteReader.get16LittleEndian(),this._wavFileInfo._bitsPerSample=this._byteReader.get16LittleEndian(),e>16&&(this._byteReader._readOffset+=e-16);!this._byteReader.getCheckSignature("data")&&this._byteReader._readOffset<this._byteReader._fileSize;)this._byteReader._readOffset+=this._byteReader.get32LittleEndian()+4;if(this._byteReader._readOffset>=this._byteReader._fileSize)throw i=!1,Error('Cannot find "data" Chunk.');{let e=this._byteReader.get32LittleEndian();this._wavFileInfo._samplesPerChannel=8*e/(this._wavFileInfo._bitsPerSample*this._wavFileInfo._numberOfChannels)}this._pcmData=Array(this._wavFileInfo._numberOfChannels);for(let e=0;e<this._wavFileInfo._numberOfChannels;e++)this._pcmData[e]=new Float32Array(this._wavFileInfo._samplesPerChannel);for(let e=0;e<this._wavFileInfo._samplesPerChannel;e++)for(let t=0;t<this._wavFileInfo._numberOfChannels;t++)this._pcmData[t][e]=this.getPcmSample();i=!0,t(i)}catch(e){console.log(e)}})().then(()=>{t(i)})})}getPcmSample(){let e;switch(this._wavFileInfo._bitsPerSample){case 8:e=this._byteReader.get8()-128<<24;break;case 16:e=this._byteReader.get16LittleEndian()<<16;break;case 24:e=this._byteReader.get24LittleEndian()<<8;break;default:e=0}return e/0x7fffffff}getPcmDataChannel(e){return this._pcmData&&e<this._pcmData.length?Float32Array.from(this._pcmData[e]):null}getWavSamplingRate(){return!this._wavFileInfo||this._wavFileInfo._samplingRate<1?null:this._wavFileInfo._samplingRate}releasePcmData(){if(this._pcmData){for(let e=0;e<this._wavFileInfo._numberOfChannels;e++)this._pcmData[e]=void 0;this._pcmData=null}}constructor(){this._loadFiletoBytes=(e,t)=>{this._byteReader._fileByte=e,this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=t},this._pcmData=null,this._userTimeSeconds=0,this._lastRms=0,this._sampleOffset=0,this._wavFileInfo=new t2,this._byteReader=new t3}}class t2{constructor(){this._fileName="",this._numberOfChannels=0,this._bitsPerSample=0,this._samplingRate=0,this._samplesPerChannel=0}}class t3{get8(){let e=this._fileDataView.getUint8(this._readOffset);return this._readOffset++,e}get16LittleEndian(){let e=this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=2,e}get24LittleEndian(){let e=this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=3,e}get32LittleEndian(){let e=this._fileDataView.getUint8(this._readOffset+3)<<24|this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=4,e}getCheckSignature(e){let t=new Uint8Array(4),i=new TextEncoder().encode(e);if(4!=e.length)return!1;for(let e=0;e<4;e++)t[e]=this.get8();return t[0]==i[0]&&t[1]==i[1]&&t[2]==i[2]&&t[3]==i[3]}constructor(){this._fileByte=null,this._fileDataView=null,this._fileSize=0,this._readOffset=0}}var t5=function(e){return e[e.LoadAssets=0]="LoadAssets",e[e.LoadModel=1]="LoadModel",e[e.WaitLoadModel=2]="WaitLoadModel",e[e.LoadExpression=3]="LoadExpression",e[e.WaitLoadExpression=4]="WaitLoadExpression",e[e.LoadPhysics=5]="LoadPhysics",e[e.WaitLoadPhysics=6]="WaitLoadPhysics",e[e.LoadPose=7]="LoadPose",e[e.WaitLoadPose=8]="WaitLoadPose",e[e.SetupEyeBlink=9]="SetupEyeBlink",e[e.SetupBreath=10]="SetupBreath",e[e.LoadUserData=11]="LoadUserData",e[e.WaitLoadUserData=12]="WaitLoadUserData",e[e.SetupEyeBlinkIds=13]="SetupEyeBlinkIds",e[e.SetupLipSyncIds=14]="SetupLipSyncIds",e[e.SetupLayout=15]="SetupLayout",e[e.LoadMotion=16]="LoadMotion",e[e.WaitLoadMotion=17]="WaitLoadMotion",e[e.CompleteInitialize=18]="CompleteInitialize",e[e.CompleteSetupModel=19]="CompleteSetupModel",e[e.LoadTexture=20]="LoadTexture",e[e.WaitLoadTexture=21]="WaitLoadTexture",e[e.CompleteSetup=22]="CompleteSetup",e}(t5||{});class t4 extends tJ{loadAssets(e,t){this._modelHomeDir=e,fetch("".concat(this._modelHomeDir).concat(t)).then(e=>e.arrayBuffer()).then(e=>{let t=new G(e,e.byteLength);this._state=1,this.setupModel(t)}).catch(e=>{(0,em.iA)("Failed to load file ".concat(this._modelHomeDir).concat(t))})}setupModel(e){this._updating=!0,this._initialized=!1,this._modelSetting=e;let t=this._modelSetting.getHitAreasCount();if(console.log("Model has ".concat(t," hit areas")),""!=this._modelSetting.getModelFileName()){let e=this._modelSetting.getModelFileName();fetch("".concat(this._modelHomeDir).concat(e)).then(t=>t.ok?t.arrayBuffer():t.status>=400?((0,em.iA)("Failed to load file ".concat(this._modelHomeDir).concat(e)),new ArrayBuffer(0)):void 0).then(e=>{this.loadModel(e,this._mocConsistency,tK.CurrentKScale),this._state=3,i()}),this._state=2}else t$.D.printMessage("Model data does not exist.");let i=()=>{if(this._modelSetting.getExpressionCount()>0){let e=this._modelSetting.getExpressionCount();for(let t=0;t<e;t++){let i=this._modelSetting.getExpressionName(t),s=this._modelSetting.getExpressionFileName(t);fetch("".concat(this._modelHomeDir).concat(s)).then(e=>e.ok?e.arrayBuffer():e.status>=400?((0,em.iA)("Failed to load file ".concat(this._modelHomeDir).concat(s)),new ArrayBuffer(0)):void 0).then(t=>{let s=this.loadExpression(t,t.byteLength,i);null!=this._expressions.getValue(i)&&(es.D.delete(this._expressions.getValue(i)),this._expressions.setValue(i,null)),this._expressions.setValue(i,s),this._expressionCount++,this._expressionCount>=e&&(this._state=5,r())})}this._state=4}else this._state=5,r()},r=()=>{if(""!=this._modelSetting.getPhysicsFileName()){let e=this._modelSetting.getPhysicsFileName();fetch("".concat(this._modelHomeDir).concat(e)).then(t=>t.ok?t.arrayBuffer():t.status>=400?((0,em.iA)("Failed to load file ".concat(this._modelHomeDir).concat(e)),new ArrayBuffer(0)):void 0).then(e=>{this.loadPhysics(e,e.byteLength),this._state=7,s()}),this._state=6}else this._state=7,s()},s=()=>{if(""!=this._modelSetting.getPoseFileName()){let e=this._modelSetting.getPoseFileName();fetch("".concat(this._modelHomeDir).concat(e)).then(t=>t.ok?t.arrayBuffer():t.status>=400?((0,em.iA)("Failed to load file ".concat(this._modelHomeDir).concat(e)),new ArrayBuffer(0)):void 0).then(e=>{this.loadPose(e,e.byteLength),this._state=9,a()}),this._state=8}else this._state=9,a()},a=()=>{this._modelSetting.getEyeBlinkParameterCount()>0&&(this._eyeBlink=q.create(this._modelSetting),this._state=10),o()},o=()=>{this._breath=H.create();let e=new T.tG;e.pushBack(new W(this._idParamAngleX,0,15,6.5345,.5)),e.pushBack(new W(this._idParamAngleY,0,8,3.5345,.5)),e.pushBack(new W(this._idParamAngleZ,0,10,5.5345,.5)),e.pushBack(new W(this._idParamBodyAngleX,0,4,15.5345,.5));let t=k.MN.getIdManager();if(t){let i=t.getId(n.ParamBreath);i&&e.pushBack(new W(i,.5,.5,3.2345,1))}this._breath.setParameters(e),this._state=11,l()},l=()=>{if(""!=this._modelSetting.getUserDataFile()){let e=this._modelSetting.getUserDataFile();fetch("".concat(this._modelHomeDir).concat(e)).then(t=>t.ok?t.arrayBuffer():t.status>=400?((0,em.iA)("Failed to load file ".concat(this._modelHomeDir).concat(e)),new ArrayBuffer(0)):void 0).then(e=>{this.loadUserData(e,e.byteLength),this._state=13,u()}),this._state=12}else this._state=13,u()},u=()=>{let e=this._modelSetting.getEyeBlinkParameterCount();for(let t=0;t<e;++t)this._eyeBlinkIds.pushBack(this._modelSetting.getEyeBlinkParameterId(t));this._state=14,h()},h=()=>{let e=this._modelSetting.getLipSyncParameterCount();for(let t=0;t<e;++t)this._lipSyncIds.pushBack(this._modelSetting.getLipSyncParameterId(t));if(0===this._lipSyncIds.getSize()){console.warn('[Fallback] No LipSync IDs defined in model setting. Attempting fallback to "ParamMouthOpenY".');let e=k.MN.getIdManager();if(e){let t=e.getId(n.ParamMouthOpenY);this._model&&t&&-1!==this._model.getParameterIndex(t)?(this._lipSyncIds.pushBack(t),console.log('[Fallback] Successfully added "ParamMouthOpenY" as LipSync ID.')):console.warn('[Fallback] Fallback ID "ParamMouthOpenY" not found in the current model or model not loaded.')}else console.warn("[Fallback] Could not access IdManager. LipSync fallback unavailable.")}this._state=15,d()},d=()=>{let e=new tb.ak;if(null==this._modelSetting||null==this._modelMatrix)return void(0,em.iA)("Failed to setupLayout().");this._modelSetting.getLayoutMap(e),this._modelMatrix.setupFromLayout(e),this._state=16,c()},c=()=>{this._state=17,this._model.saveParameters(),this._allMotionCount=0,this._motionCount=0;let e=[],t=this._modelSetting.getMotionGroupCount();for(let i=0;i<t;i++)e[i]=this._modelSetting.getMotionGroupName(i),this._allMotionCount+=this._modelSetting.getMotionCount(e[i]);if(0==this._allMotionCount){this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(tQ.gl);return}for(let i=0;i<t;i++)this.preLoadMotionGroup(e[i]);0==t&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(tQ.gl))}}setupTextures(){if(console.log("Setting up textures for model:",this._modelHomeDir),20==this._state){let e=this._modelSetting.getTextureCount();for(let t=0;t<e;t++){if(""==this._modelSetting.getTextureFileName(t)){console.log("getTextureFileName null");continue}let i=this._modelSetting.getTextureFileName(t);i=this._modelHomeDir+i;let r=i=>{this.getRenderer().bindTexture(t,i.id),this._textureCount++,this._textureCount>=e&&(this._state=22)};tZ.VY.getInstance().getTextureManager().createTextureFromPngFile(i,!0,r),this.getRenderer().setIsPremultipliedAlpha(!0)}this._state=21}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}update(){if(22!=this._state)return;let e=t$.D.getDeltaTime();this._userTimeSeconds+=e,this._dragManager.update(e),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY();let t=!1;if(this._model.loadParameters(),this._motionManager.isFinished()?this.startRandomMotion(tK.MotionGroupIdle,tK.PriorityIdle):t=this._motionManager.updateMotion(this._model,e),this._model.saveParameters(),t||null==this._eyeBlink||this._eyeBlink.updateParameters(this._model,e),null!=this._expressionManager&&this._expressionManager.updateMotion(this._model,e),this._model.addParameterValueById(this._idParamAngleX,30*this._dragX),this._model.addParameterValueById(this._idParamAngleY,30*this._dragY),this._model.addParameterValueById(this._idParamAngleZ,-(this._dragX*this._dragY*30)),this._model.addParameterValueById(this._idParamBodyAngleX,10*this._dragX),this._model.addParameterValueById(this._idParamEyeBallX,this._dragX),this._model.addParameterValueById(this._idParamEyeBallY,this._dragY),null!=this._breath&&this._breath.updateParameters(this._model,e),null!=this._physics&&this._physics.evaluate(this._model,e),this._lipsync){let t=0;this._wavFileHandler.update(e),t=Math.min(1,1.5*(t=this._wavFileHandler.getRms()));for(let e=0;e<this._lipSyncIds.getSize();++e)this._model.addParameterValueById(this._lipSyncIds.at(e),t,4)}null!=this._pose&&this._pose.updateParameters(this._model,e),this._model.update()}startMotion(e,t,i,r){if(3===i&&tK.DebugLogEnable&&console.log("[APP] startMotion: Attempting to start tap motion. Group: '".concat(e,"', Index: ").concat(t)),i==tK.PriorityForce)this._motionManager.setReservePriority(i);else if(!this._motionManager.reserveMotion(i))return this._debugMode&&t$.D.printMessage("[APP]can't start motion."),eh.u3;let s=this._modelSetting.getMotionFileName(e,t),a="".concat(e,"_").concat(t),n=this._motions.getValue(a),o=!1;return null==n?(tK.DebugLogEnable&&console.log("[APP] startMotion: Motion '".concat(a,"' not found in cache, fetching: ").concat(s)),fetch("".concat(this._modelHomeDir).concat(s)).then(e=>e.ok?e.arrayBuffer():e.status>=400?((0,em.iA)("Failed to load file ".concat(this._modelHomeDir).concat(s)),new ArrayBuffer(0)):void 0).then(s=>{if(null==(n=this.loadMotion(s,s.byteLength,null,r))){tK.DebugLogEnable&&console.error("[APP] startMotion: Failed to load motion from fetched data for '".concat(a,"'"));return}let l=this._modelSetting.getMotionFadeInTimeValue(e,t);l>=0&&n.setFadeInTime(l),(l=this._modelSetting.getMotionFadeOutTimeValue(e,t))>=0&&n.setFadeOutTime(l),n.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),o=!0,tK.DebugLogEnable&&console.log("[APP] startMotion: Starting fetched motion '".concat(a,"'")),this._motionManager.startMotionPriority(n,o,i)}),eh.u3):(tK.DebugLogEnable&&console.log("[APP] startMotion: Motion '".concat(a,"' found in cache. Starting.")),n.setFinishedMotionHandler(r),this._motionManager.startMotionPriority(n,o,i))}startRandomMotion(e,t,i){if(tK.DebugLogEnable&&console.log("[APP] startRandomMotion called. Group: '".concat(e,"', Priority: ").concat(t)),0==this._modelSetting.getMotionCount(e))return tK.DebugLogEnable&&console.warn("[APP] startRandomMotion: No motions found in group '".concat(e,"'")),eh.u3;let r=Math.floor(Math.random()*this._modelSetting.getMotionCount(e));return tK.DebugLogEnable&&console.log("[APP] startRandomMotion: Selected random index ".concat(r," from group '").concat(e,"'")),this.startMotion(e,r,t,i)}setExpression(e){let t=this._expressions.getValue(e);this._debugMode&&t$.D.printMessage("[APP]expression: [".concat(e,"]")),null!=t?this._expressionManager.startMotionPriority(t,!1,tK.PriorityForce):this._debugMode&&t$.D.printMessage("[APP]expression[".concat(e,"] is null"))}setRandomExpression(){if(0==this._expressions.getSize())return;let e=Math.floor(Math.random()*this._expressions.getSize());for(let t=0;t<this._expressions.getSize();t++)if(t==e){let e=this._expressions._keyValues[t].first;this.setExpression(e);return}}motionEventFired(e){(0,em.qP)("{0} is fired on LAppModel!!",e.s)}hitTest(e,t,i){if(this._opacity<1)return!1;let r=this._modelSetting.getHitAreasCount();for(let s=0;s<r;s++)if(this._modelSetting.getHitAreaName(s)==e){let e=this._modelSetting.getHitAreaId(s);return this.isHit(e,t,i)}return!1}anyhitTest(e,t){if(this._opacity<1)return null;let i=this._modelSetting.getHitAreasCount();for(let s=0;s<i;s++){let i=this._modelSetting.getHitAreaId(s);if(this.isHit(i,e,t)){var r;let e=this._modelSetting.getHitAreaId(s),t=null==e||null==(r=e._id)?void 0:r.s;return tK.DebugLogEnable&&console.log("[APP] anyhitTest: Hit detected. ID Handle:",e," Extracted ID String: ".concat(t)),t||null}}return tK.DebugLogEnable,null}preLoadMotionGroup(e){for(let t=0;t<this._modelSetting.getMotionCount(e);t++){let i=this._modelSetting.getMotionFileName(e,t),r="".concat(e,"_").concat(t);this._debugMode&&t$.D.printMessage("[APP]load motion: ".concat(i," => [").concat(r,"]")),fetch("".concat(this._modelHomeDir).concat(i)).then(e=>e.ok?e.arrayBuffer():e.status>=400?((0,em.iA)("Failed to load file ".concat(this._modelHomeDir).concat(i)),null):void 0).then(i=>{if(!i)return void this._allMotionCount--;let s=this.loadMotion(i,i.byteLength,r);if(null!=s){let i=this._modelSetting.getMotionFadeInTimeValue(e,t);i>=0&&s.setFadeInTime(i),(i=this._modelSetting.getMotionFadeOutTimeValue(e,t))>=0&&s.setFadeOutTime(i),s.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),null!=this._motions.getValue(r)&&es.D.delete(this._motions.getValue(r)),this._motions.setValue(r,s),this._motionCount++,this._motionCount>=this._allMotionCount&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(tQ.gl))}else this._allMotionCount--}).catch(e=>{(0,em.iA)("Failed to load motion: ".concat(e)),this._allMotionCount--})}}releaseMotions(){this._motions.clear()}releaseExpressions(){this._expressions.clear()}doDraw(){if(null==this._model)return;let e=[0,0,tQ.Ji.width,tQ.Ji.height];this.getRenderer().setRenderState(tZ.qO,e),this.getRenderer().drawModel()}draw(e){null!=this._model&&22==this._state&&(e.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(e),this.doDraw())}async hasMocConsistencyFromFile(){if((0,em.vT)(this._modelSetting.getModelFileName().localeCompare("")),""!=this._modelSetting.getModelFileName()){let e=this._modelSetting.getModelFileName(),t=await fetch("".concat(this._modelHomeDir).concat(e)),i=await t.arrayBuffer();return this._consistency=tX.hasMocConsistency(i),this._consistency?(0,em.qP)("Consistent MOC3."):(0,em.qP)("Inconsistent MOC3."),this._consistency}t$.D.printMessage("Model data does not exist.")}isHitOnModel(e,t){if(this._opacity<1)return!1;let i=this._model.getDrawableCount(),r=this._modelMatrix.getArray(),s=r[0]*r[5]-r[1]*r[4];if(1e-4>Math.abs(s))return!1;let a=1/s,n={a:r[5]*a,b:-r[1]*a,c:-r[4]*a,d:r[0]*a,tx:(r[4]*r[13]-r[5]*r[12])*a,ty:(r[1]*r[12]-r[0]*r[13])*a},o={x:e*n.a+t*n.c+n.tx,y:e*n.b+t*n.d+n.ty};for(let e=0;e<i;e++){if(!this._model.getDrawableDynamicFlagIsVisible(e))continue;let t=this._model.getDrawableVertices(e),i=t[0],r=t[1],s=t[0],a=t[1];for(let e=2;e<t.length;e+=2){let n=t[e],o=t[e+1];i=Math.min(i,n),r=Math.min(r,o),s=Math.max(s,n),a=Math.max(a,o)}if(o.x>=i&&o.x<=s&&o.y>=r&&o.y<=a)return!0}return!1}anyHitTestWithFallback(e,t){return null!==this.anyhitTest(e,t)||this.isHitOnModel(e,t)}startTapMotion(e,t){if(tK.DebugLogEnable&&console.log("[APP] startTapMotion called. Hit area: ".concat(e)),!t||0===Object.keys(t).length){tK.DebugLogEnable&&console.log("[APP] No tap motions configured.");return}let i={},r=!1;if(e&&t[e]&&(i=t[e],r=!0,tK.DebugLogEnable&&console.log("[APP] startTapMotion: Using motions for specific area: ".concat(e),i)),!r&&(i={},Object.values(t).forEach(e=>{for(let[t,r]of Object.entries(e))i[t]?i[t]+=Number(r):i[t]=Number(r)}),tK.DebugLogEnable&&console.log("[APP] startTapMotion: Using combined motions:",i)),0===Object.keys(i).length){tK.DebugLogEnable&&console.log("[APP] startTapMotion: No motions found to consider.");return}let s=Object.keys(i),a=Object.values(i).map(Number),n=a.reduce((e,t)=>e+(isNaN(t)?0:t),0);if(tK.DebugLogEnable&&console.log("[APP] startTapMotion: Motion groups: ".concat(s,", Weights: ").concat(a,", Total weight: ").concat(n)),n<=0){tK.DebugLogEnable&&console.log("[APP] startTapMotion: Total weight is zero or invalid.");return}let o=Math.random()*n,l=null;for(let e=0;e<s.length;e++){let t=isNaN(a[e])?0:a[e];if(o<t){l=s[e];break}o-=t}tK.DebugLogEnable&&console.log("[APP] startTapMotion: Selected group: ".concat(l)),null!==l?this.startRandomMotion(l,3):tK.DebugLogEnable&&console.log("[APP] startTapMotion: Could not select a motion group.")}constructor(){super(),this._modelSetting=null,this._modelHomeDir=null,this._userTimeSeconds=0,this._eyeBlinkIds=new T.tG,this._lipSyncIds=new T.tG,this._motions=new tb.ak,this._expressions=new tb.ak,this._hitArea=new T.tG,this._userArea=new T.tG;let e=k.MN.getIdManager();e?(this._idParamAngleX=e.getId(n.ParamAngleX),this._idParamAngleY=e.getId(n.ParamAngleY),this._idParamAngleZ=e.getId(n.ParamAngleZ),this._idParamEyeBallX=e.getId(n.ParamEyeBallX),this._idParamEyeBallY=e.getId(n.ParamEyeBallY),this._idParamBodyAngleX=e.getId(n.ParamBodyAngleX)):(this._idParamAngleX=null,this._idParamAngleY=null,this._idParamAngleZ=null,this._idParamEyeBallX=null,this._idParamEyeBallY=null,this._idParamBodyAngleX=null),tK.MOCConsistencyValidationEnable&&(this._mocConsistency=!0),this._state=0,this._expressionCount=0,this._textureCount=0,this._motionCount=0,this._allMotionCount=0,this._wavFileHandler=new t1,this._consistency=!1}}},7932:(e,t,i)=>{"use strict";i.d(t,{h8:()=>x,MN:()=>b,$b:()=>S,c$:()=>v,jz:()=>y,d7:()=>g});var r,s,a,n=i(2342),o=i(5943);class l{static createIdInternal(e){return new l(e)}getString(){return this._id}isEqual(e){return"string"==typeof e?this._id.isEqual(e):e instanceof o.F?this._id.isEqual(e.s):e instanceof l&&this._id.isEqual(e._id.s)}isNotEqual(e){return"string"==typeof e?!this._id.isEqual(e):e instanceof o.F?!this._id.isEqual(e.s):e instanceof l&&!this._id.isEqual(e._id.s)}constructor(e){if("string"==typeof e){this._id=new o.F(e);return}this._id=e}}(r||(r={})).CubismId=l;class u{release(){for(let e=0;e<this._ids.getSize();++e)this._ids.set(e,void 0);this._ids=null}registerIds(e){for(let t=0;t<e.length;t++)this.registerId(e[t])}registerId(e){let t=null;return"string"!=typeof e?this.registerId(e.s):null!=(t=this.findId(e))?t:(t=l.createIdInternal(e),this._ids.pushBack(t),t)}getId(e){return this.registerId(e)}isExist(e){return"string"==typeof e?null!=this.findId(e):this.isExist(e.s)}findId(e){for(let t=0;t<this._ids.getSize();++t)if(this._ids.at(t).getString().isEqual(e))return this._ids.at(t);return null}constructor(){this._ids=new n.tG}}(s||(s={})).CubismIdManager=u;var h=i(4532),d=i(5626),c=i(275);function g(e,t){let i=0;for(let t=1;;t++){let r=e.slice(t-1,t);if("e"!=r&&"-"!=r&&"E"!=r){if(isNaN(Number(e.substring(0,t))))break;i=t}}let r=parseFloat(e);return isNaN(r)&&(r=NaN),t[0]=e.slice(i),r}let m=!1,_=!1,p=null,f=null,x=Object.freeze({vertexOffset:0,vertexStep:2});function y(e){e&&(e=void 0)}class b{static startUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(m)return(0,d.qP)("CubismFramework.startUp() is already done."),m;null!=(p=e)&&Live2DCubismCore.Logging.csmSetLogFunction(p.logFunction),m=!0;{let e=Live2DCubismCore.Version.csmGetVersion(),t=(0xff000000&e)>>24,i=(0xff0000&e)>>16,r=65535&e;(0,d.qP)("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+t).slice(-2),("00"+i).slice(-2),("0000"+r).slice(-4),e)}return(0,d.qP)("CubismFramework.startUp() is complete."),m}static cleanUp(){m=!1,_=!1,p=null,f=null}static initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return((0,d.vT)(m),m)?_?void(0,d.E2)("CubismFramework.initialize() skipped, already initialized."):void(c.WT.staticInitializeNotForClientCall(),f=new u,Live2DCubismCore.Memory.initializeAmountOfMemory(e),_=!0,(0,d.qP)("CubismFramework.initialize() is complete.")):void(0,d.E2)("CubismFramework is not started.")}static dispose(){return((0,d.vT)(m),m)?_?void(c.WT.staticReleaseNotForClientCall(),f.release(),f=null,h.FD.staticRelease(),_=!1,(0,d.qP)("CubismFramework.dispose() is complete.")):void(0,d.E2)("CubismFramework.dispose() skipped, not initialized."):void(0,d.E2)("CubismFramework is not started.")}static isStarted(){return m}static isInitialized(){return _}static coreLogFunction(e){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(e)}static getLoggingLevel(){return null!=p?p.loggingLevel:5}static getIdManager(){return f}constructor(){}}class v{}var S=function(e){return e[e.LogLevel_Verbose=0]="LogLevel_Verbose",e[e.LogLevel_Debug=1]="LogLevel_Debug",e[e.LogLevel_Info=2]="LogLevel_Info",e[e.LogLevel_Warning=3]="LogLevel_Warning",e[e.LogLevel_Error=4]="LogLevel_Error",e[e.LogLevel_Off=5]="LogLevel_Off",e}({});!function(e){e.Constant=x,e.csmDelete=y,e.CubismFramework=b}(a||(a={}))},7973:(e,t,i)=>{"use strict";i.d(t,{ak:()=>o,cQ:()=>n,lJ:()=>l});var r,s=i(5626),a=i(7973);class n{constructor(e,t){this.first=void 0==e?null:e,this.second=void 0==t?null:t}}class o{release(){this.clear()}appendKey(e){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new n(e),this._size+=1}getValue(e){let t=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==e){t=i;break}return t>=0?this._keyValues[t].second:(this.appendKey(e),this._keyValues[this._size-1].second)}setValue(e,t){let i=-1;for(let t=0;t<this._size;t++)if(this._keyValues[t].first==e){i=t;break}i>=0?this._keyValues[i].second=t:(this.appendKey(e),this._keyValues[this._size-1].second=t)}isExist(e){for(let t=0;t<this._size;t++)if(this._keyValues[t].first==e)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(e,t){e>this._keyValues.length&&(0==this._keyValues.length?!t&&e<o.DefaultSize&&(e=o.DefaultSize):!t&&e<2*this._keyValues.length&&(e=2*this._keyValues.length),this._keyValues.length=e)}begin(){return new l(this,0)}end(){return new l(this,this._size)}erase(e){let t=e._index;return t<0||this._size<=t?e:(this._keyValues.splice(t,1),--this._size,new l(this,t))}dumpAsInt(){for(let e=0;e<this._size;e++)(0,s.XH)("{0} ,",this._keyValues[e]),(0,s.XH)("\n")}constructor(e){void 0!=e?e<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=Array(e),this._size=e):(this._keyValues=[],this._dummyValue=null,this._size=0)}}o.DefaultSize=10;class l{set(e){return this._index=e._index,this._map=e._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new l(this._map,this._index++)}decrement(){let e=new l(this._map,this._index);return this._map=e._map,this._index=e._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(e){return this._index!=e._index||this._map!=e._map}constructor(e,t){this._map=void 0!=e?e:new o,this._index=void 0!=t?t:0}}!function(e){e.csmMap=a.ak,e.csmPair=a.cQ,e.iterator=a.lJ}(r||(r={}))},8385:(e,t,i)=>{"use strict";i.d(t,{Ji:()=>r,gl:()=>s,sJ:()=>n});let r=null,s=null,a=null;class n{static getInstance(){return null==a&&(a=new n),a}static releaseInstance(){null!=a&&a.release(),a=null}release(){}constructor(){(s=(r=document.getElementById("canvas")).getContext("webgl2"))||(alert("Cannot initialize WebGL. This browser does not support."),s=null,document.body.innerHTML="This browser does not support the <code>&lt;canvas&gt;</code> element.")}}},9258:(e,t,i)=>{Promise.resolve().then(i.bind(i,7315))},9988:(e,t,i)=>{"use strict";i.d(t,{V:()=>h});var r=i(962),s=i(2342),a=i(7126),n=i(8385),o=i(7742),l=i(278);let u=null;class h{static getInstance(){return null==u&&(u=new h),u}static releaseInstance(){null!=u&&(u=void 0),u=null}getModel(e){return e<this._models.getSize()?this._models.at(e):null}releaseAllModel(){for(let e=0;e<this._models.getSize();e++)this._models.at(e).release(),this._models.set(e,null);this._models.clear()}onDrag(e,t){for(let i=0;i<this._models.getSize();i++){let r=this.getModel(i);r&&r.setDragging(e,t)}}onTap(e,t){a.DebugLogEnable&&l.D.printMessage("[APP]tap point: {x: ".concat(e.toFixed(2)," y: ").concat(t.toFixed(2),"}"));for(let i=0;i<this._models.getSize();i++)this._models.at(i).hitTest(a.HitAreaNameHead,e,t)?(a.DebugLogEnable&&l.D.printMessage("[APP]hit area: [".concat(a.HitAreaNameHead,"]")),this._models.at(i).setRandomExpression()):this._models.at(i).hitTest(a.HitAreaNameBody,e,t)&&(a.DebugLogEnable&&l.D.printMessage("[APP]hit area: [".concat(a.HitAreaNameBody,"]")),this._models.at(i).startRandomMotion(a.MotionGroupTapBody,a.PriorityNormal,this._finishedMotion))}onUpdate(){let{width:e,height:t}=n.Ji,i=this._models.getSize();for(let s=0;s<i;++s){let i=new r.n,a=this.getModel(s);a.getModel()&&(a.getModel().getCanvasWidth()>1&&e<t?(a.getModelMatrix().setWidth(2),i.scale(1,e/t)):i.scale(t/e,1),null!=this._viewMatrix&&i.multiplyByMatrix(this._viewMatrix)),a.update(),a.draw(i)}}nextScene(){let e=(this._sceneIndex+1)%a.ModelDirSize;this.changeScene(e)}changeScene(e){this._sceneIndex=e,a.DebugLogEnable&&l.D.printMessage("[APP]model index: ".concat(this._sceneIndex));let t=a.ModelDir[e],i=a.ResourcesPath+t+"/",r=a.ModelFileNames&&a.ModelFileNames[e]?a.ModelFileNames[e]:a.ModelDir[e];r+=".model3.json",a.DebugLogEnable&&l.D.printMessage("[APP]model path: ".concat(i).concat(r)),this.releaseAllModel(),this._models.pushBack(new o.$),this._models.at(0).loadAssets(i,r)}setViewMatrix(e){for(let t=0;t<16;t++)this._viewMatrix.getArray()[t]=e.getArray()[t]}constructor(){this._finishedMotion=e=>{l.D.printMessage("Motion Finished:"),console.log(e)},this._viewMatrix=new r.n,this._models=new s.tG,this._sceneIndex=0,this.changeScene(this._sceneIndex)}}}},e=>{e.O(0,[355,46,441,964,358],()=>e(e.s=9258)),_N_E=e.O()}]);