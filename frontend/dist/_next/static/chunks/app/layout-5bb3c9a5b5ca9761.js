(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{424:(e,t,o)=>{"use strict";o.d(t,{SettingsProvider:()=>c,t:()=>l});var r=o(5155),i=o(2115);let a={baseUrl:"http://127.0.0.1:8000",websocketBaseUrl:"ws://127.0.0.1:8000/ws",reduceVideoVolumeOnSpeech:!0,videoVolumeReductionPercent:50},n={type:"image",imageUrl:"",imageFile:null,imageScale:1,imagePositionX:50,imagePositionY:50,imageMode:"cover"},s=(0,i.createContext)(void 0),l=()=>{let e=(0,i.useContext)(s);if(void 0===e)throw Error("useSettings must be used within a SettingsProvider");return e},c=e=>{let{children:t}=e,[o,l]=(0,i.useState)(a),[c,u]=(0,i.useState)(n);(0,i.useEffect)(()=>{d()},[]);let d=()=>{try{let e=localStorage.getItem("generalSettings");if(e){let t=JSON.parse(e);l({...a,...t})}let t=localStorage.getItem("backgroundSettings");if(t){let e=JSON.parse(t);u({...n,...e,imageFile:null})}console.log("Settings loaded successfully")}catch(e){console.error("Failed to load settings:",e),l(a),u(n);try{localStorage.removeItem("generalSettings"),localStorage.removeItem("backgroundSettings")}catch(e){console.error("Failed to clear corrupted localStorage:",e)}}};return(0,r.jsx)(s.Provider,{value:{generalSettings:o,backgroundSettings:c,updateGeneralSettings:e=>{l(t=>({...t,...e}))},updateBackgroundSettings:e=>{u(e)},saveSettings:()=>{try{localStorage.setItem("generalSettings",JSON.stringify(o));let e={...c,imageFile:null};localStorage.setItem("backgroundSettings",JSON.stringify(e)),console.log("Settings saved successfully")}catch(e){console.error("Failed to save settings:",e)}},loadSettings:d},children:t})}},1530:(e,t,o)=>{Promise.resolve().then(o.bind(o,7817)),Promise.resolve().then(o.bind(o,1538)),Promise.resolve().then(o.bind(o,3135)),Promise.resolve().then(o.bind(o,424)),Promise.resolve().then(o.t.bind(o,7107,23))},1538:(e,t,o)=>{"use strict";o.d(t,{Live2DConfigProvider:()=>s,w:()=>l});var r=o(5155),i=o(2115);let a={modelInfo:{name:"Elaina",description:"Default Live2D model - AI Companion",url:"http://127.0.0.1:8000/live2d-models/elaina/LSS.model3.json",kScale:.8,initialXshift:20,initialYshift:-50,idleMotionGroupName:"Idle",defaultEmotion:0,emotionMap:{neutral:0,coldness:1,disgust:1,sad:2,worry:2,confusion:3,anger:4,surprise:5,expectation:5,joy:6,excitement:7,pride:8,shy:9,stunned:10,embarrassed:11,play_cool:12,drink_tea:13},pointerInteractive:!0,scrollToResize:!0,initialScale:.8},isLoading:!1},n=(0,i.createContext)(null);function s(e){let{children:t}=e,[o,s]=(0,i.useState)(a.isLoading),[l,c]=(0,i.useState)(a.modelInfo),u=e=>{var t,o;if(!(null==e?void 0:e.url))return void c(void 0);let r=2*Number(e.kScale||.5);console.log("Setting model info with default scale:",r),c({...e,kScale:r,pointerInteractive:"pointerInteractive"in e?e.pointerInteractive:null==(t=null==l?void 0:l.pointerInteractive)||t,scrollToResize:"scrollToResize"in e?e.scrollToResize:null==(o=null==l?void 0:l.scrollToResize)||o})},d=(0,i.useMemo)(()=>({modelInfo:l,setModelInfo:u,isLoading:o,setIsLoading:s}),[l,o,s]);return(0,r.jsx)(n.Provider,{value:d,children:t})}function l(){let e=(0,i.useContext)(n);if(!e)throw Error("useLive2DConfig must be used within a Live2DConfigProvider");return e}},3135:(e,t,o)=>{"use strict";o.d(t,{MicrophoneProvider:()=>n,S:()=>s});var r=o(5155),i=o(2115);let a=(0,i.createContext)(void 0);function n(e){let{children:t}=e,[o,n]=(0,i.useState)("idle"),[s,l]=(0,i.useState)(!1),[c,u]=(0,i.useState)(!1),[d,g]=(0,i.useState)(null),[m,v]=(0,i.useState)(null),[p,h]=(0,i.useState)(),S=(0,i.useRef)([]),f=(0,i.useCallback)(async()=>{try{if("permissions"in navigator){let e=await navigator.permissions.query({name:"microphone"});u("granted"===e.state),"denied"===e.state&&(n("disabled"),g("Microphone permission denied"))}}catch(e){console.warn("Permission API not supported:",e)}},[]),b=(0,i.useCallback)(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0}});return u(!0),n("idle"),g(null),e.getTracks().forEach(e=>e.stop()),!0}catch(e){return u(!1),n("error"),g("Failed to access microphone"),console.error("Microphone permission error:",e),!1}},[]),C=(0,i.useCallback)(async()=>{try{if(!c&&!await b())return;let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0}});S.current=[];let t=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"});t.ondataavailable=e=>{e.data.size>0&&(S.current.push(e.data),console.log("\uD83D\uDCFC Audio chunk recorded:",e.data.size,"bytes"))},t.onstart=()=>{l(!0),n("recording"),g(null),console.log("\uD83C\uDF99️ Recording started")},t.onstop=()=>{l(!1),n("idle"),S.current.length>0&&new Blob(S.current,{type:"audio/webm;codecs=opus"}).arrayBuffer().then(e=>{p&&(p(e),console.log("\uD83C\uDFB5 Audio data sent:",e.byteLength,"bytes"))}),e.getTracks().forEach(e=>e.stop()),console.log("⏹️ Recording stopped and data sent")},t.onerror=t=>{g("Recording error occurred"),n("error"),e.getTracks().forEach(e=>e.stop()),console.error("MediaRecorder error:",t)},v(t),t.start(100)}catch(e){g("Failed to start recording"),n("error"),console.error("Start recording error:",e)}},[c,b,p]),w=(0,i.useCallback)(()=>{m&&s&&(m.stop(),v(null))},[m,s]),y=(0,i.useCallback)(async()=>{s?w():await C()},[s,C,w]),k=(0,i.useCallback)(e=>{h(()=>e)},[]);return(0,i.useEffect)(()=>{f()},[f]),(0,r.jsx)(a.Provider,{value:{state:o,isRecording:s,hasPermission:c,error:d,startRecording:C,stopRecording:w,toggleRecording:y,requestPermission:b,onAudioData:p,setAudioDataCallback:k},children:t})}function s(){let e=(0,i.useContext)(a);if(void 0===e)throw Error("useMicrophone must be used within a MicrophoneProvider");return e}},7107:()=>{},7817:(e,t,o)=>{"use strict";o.d(t,{ChatProvider:()=>n,Y:()=>s});var r=o(5155),i=o(2115);let a=(0,i.createContext)(void 0);function n(e){let{children:t}=e,[o,n]=(0,i.useState)([]),[s,l]=(0,i.useState)(!0),c=(0,i.useCallback)(e=>{let t={...e,id:"msg_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),timestamp:Date.now()};n(e=>[...e,t])},[]),u=(0,i.useCallback)(()=>{n([])},[]);return(0,r.jsx)(a.Provider,{value:{messages:o,addMessage:c,clearMessages:u,isVisible:s,setIsVisible:l},children:t})}function s(){let e=(0,i.useContext)(a);if(void 0===e)throw Error("useChat must be used within a ChatProvider");return e}}},e=>{e.O(0,[578,441,964,358],()=>e(e.s=1530)),_N_E=e.O()}]);