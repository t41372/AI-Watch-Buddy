"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[531],{424:(e,t,n)=>{n.d(t,{Al:()=>l,SettingsProvider:()=>f,hY:()=>a,t0:()=>d});var r=n(5155),o=n(2115),i=n(9509);let a=()=>i.env.NEXT_PUBLIC_API_BASE_URL||"http://127.0.0.1:8000",l=()=>i.env.NEXT_PUBLIC_WEBSOCKET_BASE_URL||"ws://127.0.0.1:8000/ws",s={reduceVideoVolumeOnSpeech:!0,videoVolumeReductionPercent:50},c={type:"image",imageUrl:"",imageFile:null,imageScale:1,imagePositionX:50,imagePositionY:50,imageMode:"cover"},u=(0,o.createContext)(void 0),d=()=>{let e=(0,o.useContext)(u);if(void 0===e)throw Error("useSettings must be used within a SettingsProvider");return e},f=e=>{let{children:t}=e,[n,a]=(0,o.useState)(s),[l,d]=(0,o.useState)(c);(0,o.useEffect)(()=>{f(),console.log("Environment variables:",{NEXT_PUBLIC_API_BASE_URL:i.env.NEXT_PUBLIC_API_BASE_URL,NEXT_PUBLIC_WEBSOCKET_BASE_URL:i.env.NEXT_PUBLIC_WEBSOCKET_BASE_URL,defaultGeneralSettings:s})},[]);let f=()=>{try{let e=localStorage.getItem("generalSettings");if(e){let t=JSON.parse(e);a({...s,...t})}let t=localStorage.getItem("backgroundSettings");if(t){let e=JSON.parse(t);d({...c,...e,imageFile:null})}console.log("Settings loaded successfully")}catch(e){console.error("Failed to load settings:",e),a(s),d(c);try{localStorage.removeItem("generalSettings"),localStorage.removeItem("backgroundSettings")}catch(e){console.error("Failed to clear corrupted localStorage:",e)}}};return(0,r.jsx)(u.Provider,{value:{generalSettings:n,backgroundSettings:l,updateGeneralSettings:e=>{a(t=>({...t,...e}))},updateBackgroundSettings:e=>{d(e)},saveSettings:()=>{try{localStorage.setItem("generalSettings",JSON.stringify(n));let e={...l,imageFile:null};localStorage.setItem("backgroundSettings",JSON.stringify(e)),console.log("Settings saved successfully")}catch(e){console.error("Failed to save settings:",e)}},loadSettings:f},children:t})}},1538:(e,t,n)=>{n.d(t,{Live2DConfigProvider:()=>s,w:()=>c});var r=n(5155),o=n(2115),i=n(424);let a={modelInfo:{name:"Elaina",description:"Default Live2D model - AI Companion",url:"/live2d-models/elaina/LSS.model3.json",kScale:.8,initialXshift:20,initialYshift:-50,idleMotionGroupName:"Idle",defaultEmotion:0,emotionMap:{neutral:0,coldness:1,disgust:1,sad:2,worry:2,confusion:3,anger:4,surprise:5,expectation:5,joy:6,excitement:7,pride:8,shy:9,stunned:10,embarrassed:11,play_cool:12,drink_tea:13},pointerInteractive:!0,scrollToResize:!0,initialScale:.8},isLoading:!1},l=(0,o.createContext)(null);function s(e){let{children:t}=e,{generalSettings:n}=(0,i.t0)(),[s,c]=(0,o.useState)(a.isLoading),[u,d]=(0,o.useState)(a.modelInfo),f=e=>{var t,n;if(!(null==e?void 0:e.url))return void d(void 0);let r=2*Number(e.kScale||.5);console.log("Setting model info with default scale:",r);let o=(0,i.hY)(),a=e.url.startsWith("http")?e.url:"".concat(o).concat(e.url);d({...e,url:a,kScale:r,pointerInteractive:"pointerInteractive"in e?e.pointerInteractive:null==(t=null==u?void 0:u.pointerInteractive)||t,scrollToResize:"scrollToResize"in e?e.scrollToResize:null==(n=null==u?void 0:u.scrollToResize)||n})},h=(0,o.useMemo)(()=>({modelInfo:u?{...u,url:u.url.startsWith("http")?u.url:"".concat((0,i.hY)()).concat(u.url)}:void 0,setModelInfo:f,isLoading:s,setIsLoading:c}),[u,s,c]);return(0,r.jsx)(l.Provider,{value:h,children:t})}function c(){let e=(0,o.useContext)(l);if(!e)throw Error("useLive2DConfig must be used within a Live2DConfigProvider");return e}},3968:(e,t,n)=>{e.exports=n.p+"static/media/ten_vad.804eed85.wasm"},7817:(e,t,n)=>{n.d(t,{ChatProvider:()=>a,Y:()=>l});var r=n(5155),o=n(2115);let i=(0,o.createContext)(void 0);function a(e){let{children:t}=e,[n,a]=(0,o.useState)([]),[l,s]=(0,o.useState)(!0),c=(0,o.useCallback)(e=>{let t={...e,id:"msg_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),timestamp:Date.now()};a(e=>[...e,t])},[]),u=(0,o.useCallback)(()=>{a([])},[]);return(0,r.jsx)(i.Provider,{value:{messages:n,addMessage:c,clearMessages:u,isVisible:l,setIsVisible:s},children:t})}function l(){let e=(0,o.useContext)(i);if(void 0===e)throw Error("useChat must be used within a ChatProvider");return e}},8366:(e,t,n)=>{n.d(t,{MicrophoneProvider:()=>s,S:()=>c});var r=n(5155),o=n(2115),i=(()=>{var e="file:///Users/tim/LocalData/coding/2025/Projects/AdventureX/2-AI-WatchBuddy/ai_watch_buddy/frontend/libs/ten_vad.js";return function(t){t=t||{},i||(i=void 0!==t?t:{}),i.ready=new Promise(function(e,t){a=e,l=t});var r,o,i,a,l,s,c=Object.assign({},i),u="function"==typeof importScripts,d="";u?d=self.location.href:"undefined"!=typeof document&&document.currentScript&&(d=document.currentScript.src),e&&(d=e),d=0!==d.indexOf("blob:")?d.substr(0,d.replace(/[?#].*/,"").lastIndexOf("/")+1):"",u&&(s=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)});var f=i.print||console.log.bind(console),h=i.printErr||console.warn.bind(console);Object.assign(i,c),c=null,i.wasmBinary&&(p=i.wasmBinary),i.noExitRuntime,"object"!=typeof WebAssembly&&I("no native wasm support detected");var p,m,g,v,y,S=!1,_="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function b(){var e=m.buffer;g=e,i.HEAP8=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=new Int32Array(e),i.HEAPU8=v=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=y=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}var w=[],A=[],P=[],C=0,E=null,R=null;function I(e){throw i.onAbort&&i.onAbort(e),h(e="Aborted("+e+")"),S=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),l(e),e}function D(){return r.startsWith("data:application/octet-stream;base64,")}if(i.locateFile){if(r="ten_vad.wasm",!D()){var V=r;r=i.locateFile?i.locateFile(V,d):d+V}}else r=new n.U(n(3968)).href;function k(){var e=r;try{if(e==r&&p)return new Uint8Array(p);if(s)return s(e);throw"both async and sync fetching of the wasm failed"}catch(e){I(e)}}function H(e){for(;0<e.length;)e.shift()(i)}var z=[null,[],[]],x={a:function(){I("")},f:function(e,t,n){v.copyWithin(e,t,t+n)},c:function(e){var t=v.length;if(0x80000000<(e>>>=0))return!1;for(var n=1;4>=n;n*=2){var r=t*(1+.2/n);r=Math.min(r,e+0x6000000);var o=Math;r=Math.max(e,r),o=o.min.call(o,0x80000000,r+(65536-r%65536)%65536);e:{try{m.grow(o-g.byteLength+65535>>>16),b();var i=1;break e}catch(e){}i=void 0}if(i)return!0}return!1},e:function(){return 52},b:function(){return 70},d:function(e,t,n,r){for(var o=0,i=0;i<n;i++){var a=y[t>>2],l=y[t+4>>2];t+=8;for(var s=0;s<l;s++){var c=v[a+s],u=z[e];if(0===c||10===c){c=u;for(var d=0,p=d+NaN,m=d;c[m]&&!(m>=p);)++m;if(16<m-d&&c.buffer&&_)c=_.decode(c.subarray(d,m));else{for(p="";d<m;){var g=c[d++];if(128&g){var S=63&c[d++];if(192==(224&g))p+=String.fromCharCode((31&g)<<6|S);else{var b=63&c[d++];65536>(g=224==(240&g)?(15&g)<<12|S<<6|b:(7&g)<<18|S<<12|b<<6|63&c[d++])?p+=String.fromCharCode(g):(g-=65536,p+=String.fromCharCode(55296|g>>10,56320|1023&g))}}else p+=String.fromCharCode(g)}c=p}(1===e?f:h)(c),u.length=0}else u.push(c)}o+=l}return y[r>>2]=o,0}};function M(){function e(){if(!o&&(o=!0,i.calledRun=!0,!S)){if(H(A),a(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;){var e=i.postRun.shift();P.unshift(e)}H(P)}}if(!(0<C)){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)!function(){var e=i.preRun.shift();w.unshift(e)}();H(w),0<C||(i.setStatus?(i.setStatus("Running..."),setTimeout(function(){setTimeout(function(){i.setStatus("")},1),e()},1)):e())}}if(!function(){function e(e){i.asm=e.exports,m=i.asm.g,b(),A.unshift(i.asm.h),C--,i.monitorRunDependencies&&i.monitorRunDependencies(C),0==C&&(null!==E&&(clearInterval(E),E=null),R&&(e=R,R=null,e()))}function t(t){e(t.instance)}function n(e){return(!p&&"function"==typeof fetch?fetch(r,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+r+"'";return e.arrayBuffer()}).catch(function(){return k()}):Promise.resolve().then(function(){return k()})).then(function(e){return WebAssembly.instantiate(e,o)}).then(function(e){return e}).then(e,function(e){h("failed to asynchronously prepare wasm: "+e),I(e)})}var o={a:x};if(C++,i.monitorRunDependencies&&i.monitorRunDependencies(C),i.instantiateWasm)try{return i.instantiateWasm(o,e)}catch(e){h("Module.instantiateWasm callback failed with error: "+e),l(e)}(p||"function"!=typeof WebAssembly.instantiateStreaming||D()||"function"!=typeof fetch?n(t):fetch(r,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,o).then(t,function(e){return h("wasm streaming compile failed: "+e),h("falling back to ArrayBuffer instantiation"),n(t)})})).catch(l)}(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.h).apply(null,arguments)},i._malloc=function(){return(i._malloc=i.asm.i).apply(null,arguments)},i._free=function(){return(i._free=i.asm.j).apply(null,arguments)},i._ten_vad_create=function(){return(i._ten_vad_create=i.asm.k).apply(null,arguments)},i._ten_vad_process=function(){return(i._ten_vad_process=i.asm.l).apply(null,arguments)},i._ten_vad_destroy=function(){return(i._ten_vad_destroy=i.asm.m).apply(null,arguments)},i._ten_vad_get_version=function(){return(i._ten_vad_get_version=i.asm.n).apply(null,arguments)},R=function e(){o||M(),o||(R=e)},i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);0<i.preInit.length;)i.preInit.pop()();return M(),t.ready}})();class a{process(e){if(!this.vadHandle||!this.vadHandlePtr)return console.error("❌ VAD not properly initialized"),null;let t=this.module._malloc(2*this.hopSize),n=this.module._malloc(4),r=this.module._malloc(4);try{let o=Math.min(e.length,this.hopSize),i=new Int16Array(this.module.HEAP16.buffer,t,o);i.set(e.subarray(0,o));for(let e=o;e<this.hopSize;e++)i[e]=0;let a=this.module._ten_vad_process(this.vadHandle,t,this.hopSize,n,r);if(0!==a)return console.warn("⚠️ VAD process failed with code:",a),{isVoice:!1,probability:0};{let e=this.module.getValue(n,"float"),t=this.module.getValue(r,"i32");return{isVoice:1===t,probability:Math.max(0,Math.min(1,e))}}}catch(e){return console.error("❌ VAD process error:",e),{isVoice:!1,probability:0}}finally{this.module._free(t),this.module._free(n),this.module._free(r)}}destroy(){console.log("\uD83D\uDDD1️ Destroying VAD instance"),this.vadHandlePtr&&(this.module._ten_vad_destroy(this.vadHandlePtr),this.module._free(this.vadHandlePtr),this.vadHandlePtr=0,this.vadHandle=0)}constructor(e,t,n){this.module=e,this.hopSize=t,this.vadHandle=0,this.vadHandlePtr=0,this.module.getValue||(this.module.getValue=function(t,n){switch(n){case"i32":return e.HEAP32[t>>2];case"float":return e.HEAPF32[t>>2];default:throw Error("Unsupported type: ".concat(n))}}),console.log("\uD83D\uDD27 Creating VAD with hopSize:",t,"threshold:",n);try{this.vadHandlePtr=e._malloc(4),console.log("\uD83D\uDD27 Allocated vadHandlePtr:",this.vadHandlePtr);let r=e._ten_vad_create(this.vadHandlePtr,t,n);console.log("\uD83D\uDD27 VAD create result:",r),0===r?(this.vadHandle=this.module.getValue(this.vadHandlePtr,"i32"),console.log("✅ VAD created successfully - vadHandle:",this.vadHandle)):(console.error("❌ VAD creation failed with code:",r),this.vadHandlePtr&&(e._free(this.vadHandlePtr),this.vadHandlePtr=0))}catch(e){console.error("❌ VAD creation error:",e)}}}let l=(0,o.createContext)(void 0);function s(e){let{children:t}=e,[n,s]=(0,o.useState)("idle"),[c,u]=(0,o.useState)(!1),[d,f]=(0,o.useState)(!1),[h,p]=(0,o.useState)(!1),[m,g]=(0,o.useState)(null),[v,y]=(0,o.useState)({hopSize:256,threshold:.5,silenceTimeout:30}),[S,_]=(0,o.useState)(),b=(0,o.useRef)(null),w=(0,o.useRef)(null),A=(0,o.useRef)(null),P=(0,o.useRef)(null),C=(0,o.useRef)(null),E=(0,o.useRef)([]),R=(0,o.useRef)(0),I=(0,o.useRef)(!1),D=(0,o.useCallback)(async()=>{try{if("permissions"in navigator){let e=await navigator.permissions.query({name:"microphone"});p("granted"===e.state),"denied"===e.state&&(s("disabled"),g("Microphone permission denied"))}}catch(e){console.warn("Permission API not supported:",e)}},[]),V=(0,o.useCallback)(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0}});return p(!0),s("idle"),g(null),e.getTracks().forEach(e=>e.stop()),!0}catch(e){return p(!1),s("error"),g("Failed to access microphone"),console.error("Microphone permission error:",e),!1}},[]),k=(0,o.useCallback)(async()=>{try{return b.current||(console.log("\uD83C\uDF9B️ Loading VAD module..."),b.current=await i(),console.log("✅ VAD module loaded")),w.current||(w.current=new a(b.current,v.hopSize,v.threshold),console.log("✅ VAD instance created")),!0}catch(e){return console.error("❌ Failed to initialize VAD:",e),g("Failed to initialize voice detection"),!1}},[v]),H=(0,o.useCallback)(()=>{if(0===E.current.length||!S)return;let e=new Int16Array(E.current.length*v.hopSize),t=0;for(let n of E.current)e.set(n,t),t+=n.length;let n=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);S(n),console.log("\uD83C\uDFB5 Audio sent:",n.byteLength,"bytes,",E.current.length,"frames"),E.current=[],R.current=0},[v.hopSize,S]),z=(0,o.useCallback)(e=>{if(!w.current||!I.current)return void console.warn("⚠️ VAD not ready for processing");e.length!==v.hopSize&&console.warn("⚠️ Audio data size mismatch:",e.length,"expected:",v.hopSize);try{let t=Math.min(e.length,v.hopSize),n=new Int16Array(v.hopSize);for(let r=0;r<t;r++){let t=Math.max(-1,Math.min(1,e[r]));n[r]=Math.round(32767*t)}for(let e=t;e<v.hopSize;e++)n[e]=0;.01>Math.random()&&console.log("\uD83C\uDFB5 Processing audio frame:",{originalSize:e.length,processedSize:t,hopSize:v.hopSize});let r=w.current.process(n);if(!r)return void console.warn("⚠️ VAD returned null result");let o=r.isVoice;o?(E.current.push(n),R.current=0,d||(f(!0),s("speaking"),console.log("\uD83D\uDDE3️ Speech started"))):d&&(E.current.push(n),R.current++,R.current>=v.silenceTimeout&&(H(),f(!1),s("listening"),console.log("\uD83D\uDD07 Speech ended, audio sent"))),(o!==d||.005>Math.random())&&console.log("VAD: ".concat(r.probability.toFixed(3)," | Voice: ").concat(r.isVoice," | Buffer: ").concat(E.current.length," frames"))}catch(e){console.error("❌ Error in processAudioFrame:",e)}},[v,d,H]),x=(0,o.useCallback)(async()=>{try{if(!h&&!await V()||!await k())return;A.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});let e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!1}});P.current=e;let t=A.current.createMediaStreamSource(e),n=A.current.createScriptProcessor(v.hopSize,1,1);C.current=n,n.onaudioprocess=e=>{let t=e.inputBuffer.getChannelData(0);z(t)},t.connect(n),n.connect(A.current.destination),I.current=!0,u(!0),s("listening"),g(null),console.log("\uD83C\uDF99️ VAD listening started")}catch(e){g("Failed to start voice detection"),s("error"),console.error("Start listening error:",e)}},[h,V,k,v.hopSize,z]),M=(0,o.useCallback)(()=>{try{I.current=!1,d&&E.current.length>0&&H(),C.current&&(C.current.disconnect(),C.current=null),A.current&&(A.current.close(),A.current=null),P.current&&(P.current.getTracks().forEach(e=>e.stop()),P.current=null),w.current&&(w.current.destroy(),w.current=null),u(!1),f(!1),s("idle"),E.current=[],R.current=0,console.log("⏹️ VAD listening stopped")}catch(e){console.error("Error stopping VAD:",e)}},[d,H]),U=(0,o.useCallback)(async()=>{c?M():await x()},[c,x,M]),L=(0,o.useCallback)(e=>{y(t=>({...t,...e})),console.log("\uD83D\uDD27 VAD config updated:",e)},[]),T=(0,o.useCallback)(e=>{_(()=>e)},[]);return(0,o.useEffect)(()=>{D()},[D]),(0,r.jsx)(l.Provider,{value:{state:n,isListening:c,isSpeaking:d,isRecording:c,hasPermission:h,error:m,vadConfig:v,startListening:x,stopListening:M,toggleListening:U,toggleRecording:U,requestPermission:V,updateVADConfig:L,onAudioData:S,setAudioDataCallback:T},children:t})}function c(){let e=(0,o.useContext)(l);if(void 0===e)throw Error("useMicrophone must be used within a MicrophoneProvider");return e}}}]);